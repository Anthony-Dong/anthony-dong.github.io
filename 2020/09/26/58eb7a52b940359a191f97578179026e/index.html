<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"anthony-dong.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.json"}</script><meta name="description" content="​        学习docker的基本组件、dockerfile、docker命令等！"><meta property="og:type" content="article"><meta property="og:title" content="Docker学习"><meta property="og:url" content="https://anthony-dong.github.io/2020/09/26/58eb7a52b940359a191f97578179026e/index.html"><meta property="og:site_name" content="Anthony-Dong"><meta property="og:description" content="​        学习docker的基本组件、dockerfile、docker命令等！"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://tyut.oss-accelerate.aliyuncs.com/image/2020/10-6/f26bd07bcd6341d88055e81cf95db8a5.jpg"><meta property="og:image" content="https://tyut.oss-accelerate.aliyuncs.com/image/2020/10-6/6150a3fe711347fe892e355e36b6f364.jpg"><meta property="article:published_time" content="2020-09-26T15:20:37.000Z"><meta property="article:modified_time" content="2022-04-24T06:00:48.155Z"><meta property="article:author" content="Anthony-Dong"><meta property="article:tag" content="Docker"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tyut.oss-accelerate.aliyuncs.com/image/2020/10-6/f26bd07bcd6341d88055e81cf95db8a5.jpg"><link rel="canonical" href="https://anthony-dong.github.io/2020/09/26/58eb7a52b940359a191f97578179026e/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Docker学习 | Anthony-Dong</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?899b2a5c34078209c5f30853eaaa7846";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Anthony-Dong</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Anthony-Dong技术博客</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/Anthony-Dong" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://anthony-dong.github.io/2020/09/26/58eb7a52b940359a191f97578179026e/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Anthony-Dong"><meta itemprop="description" content="追寻技术的本质！"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Anthony-Dong"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Docker学习</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-09-26 23:20:37" itemprop="dateCreated datePublished" datetime="2020-09-26T23:20:37+08:00">2020-09-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-04-24 14:00:48" itemprop="dateModified" datetime="2022-04-24T14:00:48+08:00">2022-04-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>15k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>​ 学习docker的基本组件、dockerfile、docker命令等！</p><span id="more"></span><p>官方文章：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p><p>docker 官方镜像地址： <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p><p>推荐阅读丛书 ： <a target="_blank" rel="noopener" href="https://item.jd.com/12013041.html"><strong>Docker实战(博文视点出品)</strong></a> ， <a target="_blank" rel="noopener" href="https://item.jd.com/11909234.html"><strong>第一本Docker书 修订版</strong></a></p><p>docker 快速安装： <code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</code> , 记得用户设置在docker用户组！，推荐在非mac os/windows上玩。</p><h2 id="1、docker-的组成"><a href="#1、docker-的组成" class="headerlink" title="1、docker 的组成"></a>1、docker 的组成</h2><p><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2020/10-6/f26bd07bcd6341d88055e81cf95db8a5.jpg" alt="docker引擎docker引擎"></p><h3 id="1、runc"><a href="#1、runc" class="headerlink" title="1、runc"></a>1、runc</h3><p>runc实质上是一个轻量级的、针对Libcontainer进行了包装的<a target="_blank" rel="noopener" href="https://www.linuxcool.com/">命令</a>行交互工具( Libcontainer取代了早期Docker架构中的LXC )。</p><p>使用很简单，它是运行一个容器最基本的工具，所以我们需要创建容器。</p><p>docker中创建容器是，<code>docker create docker-image-name</code>，但是需要导出到文件系统中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> create the top most bundle directory</span></span><br><span class="line">mkdir /mycontainer</span><br><span class="line">cd /mycontainer</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> create the rootfs directory</span></span><br><span class="line">mkdir rootfs</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">export</span> busybox via Docker into the rootfs directory</span></span><br><span class="line">docker export $(docker create busybox) | tar -C rootfs -xvf -</span><br><span class="line"></span><br><span class="line">runc spec</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> run as root</span></span><br><span class="line">cd /mycontainer</span><br><span class="line">runc run mycontainerid</span><br></pre></td></tr></table></figure><h3 id="2、containerd"><a href="#2、containerd" class="headerlink" title="2、containerd"></a>2、containerd</h3><p>对于docker进行拆分后，容器执行逻辑被重构到一个新的名为containerd (发音为container-dee) 的工具中。它的主要任务是容器的生命周期管理———— start | stop | pause | rm….</p><p>Docker引擎技术栈中，containerd位于daemon和runc所在的OCI层之间。随着时间的推移，它被赋予了更多的功能，如镜像管理。虽然名叫containerd, 但是它并不负责创建容器，而是指挥runc去做。containerd将Docker镜像转换为OCI bundle,并让runc基于此创建一个新的容器。然后，runc与操作系统内核接口进行通信，基于所有必要的工具( Namespace、CGroup 等)来创建容器。容器进程作为runc的子进程启动，启动完毕后，runc 将会退出。</p><p><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2020/10-6/6150a3fe711347fe892e355e36b6f364.jpg" alt="docker引擎docker引擎"></p><p>​ 将所有的用于启动、管理容器的逻辑和代码从daemon中移除，意味着容器运行时与Docker daemon是解耦的，有时称之为“无守护进程的容器(daemonless container)”,如此，对Docker daemon的维护和升级工作不会影响到运行中的容器。</p><h3 id="3、shim"><a href="#3、shim" class="headerlink" title="3、shim"></a>3、shim</h3><p>shim是实现无daemon的容器(用于将运行中的容器与daemon解耦，以便进行daemon升级等操作)不可或缺的工具。containerd 指挥runc来创建新容器。事实上,每次创建容器时它都会fork一个新的runc实例。不过，一旦容器创建完毕，对应的runc进程就会退出。因此，即使运行上百个容器，也无须保持上百个运行中的runc实例。一旦容器进程的父进程runc退出，相关联的containerd-shim 进程就会成为容器的父进程。</p><p>作为容器的父进程，shim 的部分职责如下。</p><ul><li>保持所有STDIN和STDOUT流是开启状态，从而当daemon重启的时候,容器不会因为管道( pipe)的关闭而终止。</li><li>将容器的退出状态反馈给daemon。</li></ul><h3 id="4、daemon"><a href="#4、daemon" class="headerlink" title="4、daemon"></a>4、daemon</h3><p>daemon的主要功能包括镜像管理、镜像构建、REST API、身份验证、安全、核心网络以及编排。</p><h2 id="2、Dockerfile-学习"><a href="#2、Dockerfile-学习" class="headerlink" title="2、Dockerfile 学习"></a>2、Dockerfile 学习</h2><blockquote><p>​ 官方文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p></blockquote><h3 id="1、dockerfile-文件，基本玩法"><a href="#1、dockerfile-文件，基本玩法" class="headerlink" title="1、dockerfile 文件，基本玩法"></a>1、dockerfile 文件，基本玩法</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> anthony-dong <span class="string">&quot;fanhaodong516@gamil.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /opt/project</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /opt/project</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> project.tar.gz .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> run.sh .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [ <span class="string">&quot;/opt/project&quot;</span> ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PROJECT_HOME /opt/project</span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$PROJECT_HOME</span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;run.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t test .</span><br><span class="line"></span><br><span class="line">docker run --rm -it test</span><br></pre></td></tr></table></figure><h3 id="2、CMD-和-ENTRYPOINT-的区别"><a href="#2、CMD-和-ENTRYPOINT-的区别" class="headerlink" title="2、CMD 和 ENTRYPOINT 的区别"></a>2、<code>CMD</code> 和 <code>ENTRYPOINT</code> 的区别</h3><ul><li><code>CMD</code> 和 <code>ENTRYPOINT</code> 的区别，这里其实区别很简单， 可以理解为 在没有启动命令是 <code>ENTRYPOINT</code>+ <code>CMD</code> （启动<code>docker run</code>时运行的默认命令）</li><li>当我们 <code>docker run image_name [cmd1] [cmd2]</code> 时，其实已经把 Dokerfile中配置的<code>CMD</code>命令替换掉了，其实真正执行的是 <code>ENTRYPOINT</code>+<code>[cmd1]</code>+<code>[cmd2]</code> ， 但是这俩<code>CMD</code> 和 <code>ENTRYPOINT</code> 都可以为空</li><li>根据上面可以发现 <code>CMD</code>可以通过 <code>docker run</code>可以替换，那么 <code>ENTRYPOINT</code> 也是可以替换的，可以通过 <code>-entrypoint</code> 指定</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latest</span><br><span class="line">ENTRYPOINT [ <span class="string">&quot;ls&quot;</span>]</span><br><span class="line">CMD [<span class="string">&quot;-al&quot;</span>]</span><br></pre></td></tr></table></figure><p>比如上面找个，我们如果默认执行的话，会是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  kubernetes docker run --rm demo                 </span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Jan 26 12:50 .</span><br><span class="line">// ...</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 14 11:49 opt</span><br><span class="line">dr-xr-xr-x  226 root     root             0 Jan 26 12:50 proc</span><br></pre></td></tr></table></figure><p>但是如果我们添加了参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  kubernetes docker run --rm demo -a</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">//.... </span><br><span class="line">home</span><br></pre></td></tr></table></figure><p>修改 <code>ENTRYPOINT</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  kubernetes docker run --rm --entrypoint env demo</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=<span class="number">4791</span>b485ab53</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure><h3 id="3、AND-和-COPY的区别"><a href="#3、AND-和-COPY的区别" class="headerlink" title="3、AND 和 COPY的区别"></a>3、<code>AND</code> 和 <code>COPY</code>的区别</h3><p>AND 可以是多种source源，支持url/tar/unzip/文件包，所以看需求选择，比如使用tar包会自动解压</p><p>COPY 只能copy文件，所以一般推荐copy</p><h3 id="4、build-失败如何继续，如何调试！！"><a href="#4、build-失败如何继续，如何调试！！" class="headerlink" title="4、build 失败如何继续，如何调试！！"></a>4、build 失败如何继续，如何调试！！</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:centos7</span><br><span class="line"><span class="keyword">USER</span> admin:admin</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;/bin/bash&quot;</span> ]</span></span><br></pre></td></tr></table></figure><p>这个build是可以通过的！！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker build -t test-1 .</span><br><span class="line">Sending build context to Docker daemon  25.09kB</span><br><span class="line">Step 1/3 : FROM centos:centos7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 7e6257c9f8d8</span></span><br><span class="line">Step 2/3 : USER admin:admin</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> f8ed46bdda32</span></span><br><span class="line">Removing intermediate container f8ed46bdda32</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 9611a153742e</span></span><br><span class="line">Step 3/3 : CMD [ &quot;/bin/bash&quot; ]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> abc32bd8e245</span></span><br><span class="line">Removing intermediate container abc32bd8e245</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0f0f0aeeec29</span></span><br><span class="line">Successfully built 0f0f0aeeec29</span><br><span class="line">Successfully tagged test-1:latest</span><br></pre></td></tr></table></figure><p>然后运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker run --rm -it test-1</span><br><span class="line">docker: Error response from daemon: linux spec user: unable to find user admin: no matching entries in passwd file.</span><br></pre></td></tr></table></figure><p>发现这个，我们需要从<code>Step 1/3</code>开始！！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker run --rm -it  7e6257c9f8d8</span><br><span class="line">[root@532c8a693273 /]# useradd admin -p admin -d /home/admin --create-home -s /bin/bash</span><br><span class="line">[root@532c8a693273 /]# su admin</span><br><span class="line">[admin@532c8a693273 /]$ exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>然后我们需要继续改dockerfile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:centos7</span><br><span class="line">RUN useradd admin -p admin -d /home/admin --create-home -s /bin/bash</span><br><span class="line">USER admin:admin</span><br><span class="line">CMD [ &quot;/bin/bash&quot; ]</span><br></pre></td></tr></table></figure><p>继续运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker build -t test-1 .</span><br><span class="line">Sending build context to Docker daemon  25.09kB</span><br><span class="line">Step 1/4 : FROM centos:centos7</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 7e6257c9f8d8</span></span><br><span class="line">Step 2/4 : RUN useradd admin -p admin -d /home/admin --create-home -s /bin/bash</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> f36f10b603bd</span></span><br><span class="line">Removing intermediate container f36f10b603bd</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 843554e160f7</span></span><br><span class="line">Step 3/4 : USER admin:admin</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 796341a1be27</span></span><br><span class="line">Removing intermediate container 796341a1be27</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> ab964ed78d8f</span></span><br><span class="line">Step 4/4 : CMD [ &quot;/bin/bash&quot; ]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 2c67de0242ea</span></span><br><span class="line">Removing intermediate container 2c67de0242ea</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 17a4bc8d7206</span></span><br><span class="line">Successfully built 17a4bc8d7206</span><br><span class="line">Successfully tagged test-1:latest</span><br><span class="line">➜  docker-file-test docker run --rm -it 17a4bc8d7206</span><br><span class="line">[admin@55f84f22acf6 /]$</span><br></pre></td></tr></table></figure><p>这个就是一个简单的过程！！！！！！，这个好处是类似于<code>调试的过程</code></p><p>其实还可以通过 <code>docker run -u</code> 来制定用户，切记一点，别记忆命令！！，要记忆如何学习！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker run -it --rm --user root test-1</span><br><span class="line">[root@6dbeb01f5329 /]#</span><br></pre></td></tr></table></figure><h3 id="5、安装一个Go的环境"><a href="#5、安装一个Go的环境" class="headerlink" title="5、安装一个Go的环境"></a>5、安装一个Go的环境</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:centos7</span><br><span class="line"><span class="keyword">MAINTAINER</span> anthony-dong <span class="string">&quot;fanhaodong516@gamil.com&quot;</span></span><br><span class="line"><span class="comment"># 添加文件地址</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> go1.13.15.linux-amd64.tar.gz /opt</span></span><br><span class="line"><span class="comment"># 项目地址文件,安装工具</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /opt/project \</span></span><br><span class="line"><span class="bash">    &amp;&amp; yum install -y vim \</span></span><br><span class="line"><span class="bash">    &amp;&amp; yum install  -y curl \</span></span><br><span class="line"><span class="bash">    &amp;&amp; yum install  -y git \</span></span><br><span class="line"><span class="bash">    &amp;&amp; yum install  -y wget</span></span><br><span class="line"><span class="comment"># 环境变量    </span></span><br><span class="line"><span class="keyword">ENV</span> GO_HOME <span class="string">&quot;/opt/go&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$GO_HOME/bin</span><br><span class="line"><span class="comment"># export端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span> </span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">10010</span> </span><br><span class="line"><span class="comment"># 直接启动bash</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>然后执行， <code>--tag</code> 可以写成<code>-t</code> ，比如<code>--tag go:1.13</code> 意思就是镜像名称是<code>go</code>，版本是<code>1.13</code>，大致就是这个样子！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --file ./Dockerfile -p  --tag goenv1.13 .</span><br></pre></td></tr></table></figure><p>最后启动需要指定<code>-t</code> ，意思就是 <code>--rm</code>是容器被停止则被删除，<code>-d</code>是deamon启动， <code>-it</code>就是hold住类似于开启一个终端（i是输出，t是终端，然后程序就被hold住了）， <code>-P</code>暴漏端口随机到宿主机上， 最后指定使用的镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -d -it -P goenv1.13</span><br></pre></td></tr></table></figure><p>然后查看一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  test docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                                               NAMES</span><br><span class="line">f67a0f2bcb0e        goenv1.13           &quot;/bin/bash&quot;         21 seconds ago      Up 19 seconds       0.0.0.0:32769-&gt;8080/tcp, 0.0.0.0:32768-&gt;10010/tcp   heuristic_lumiere</span><br></pre></td></tr></table></figure><h3 id="6、多阶段构建"><a href="#6、多阶段构建" class="headerlink" title="6、多阶段构建"></a>6、多阶段构建</h3><blockquote><p>​ Docker v17.05 开始支持多阶段构建 (<code>multistage builds</code>)， 参考：<a target="_blank" rel="noopener" href="https://yeasy.gitbook.io/docker_practice/image/multistage-builds">https://yeasy.gitbook.io/docker_practice/image/multistage-builds</a> , 主要命令就是 <code>COPY --from=builder /data/apps/project/bin/app bin/</code></p><p>但是业务中不推荐，很多时候要去容器里操作！</p></blockquote><p>还是一个Go项目，假如以一个Http-Server 为例子</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  pck tree -L 2</span><br><span class="line">.</span><br><span class="line">├── Dockerfile</span><br><span class="line">├── cmd</span><br><span class="line">│   └── main.go</span><br><span class="line">├── go.mod</span><br><span class="line">└── go.sum</span><br></pre></td></tr></table></figure><p>项目文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;github.com/gin-gonic/gin&quot;</span><br><span class="line">	&quot;log&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.GET(&quot;/echo&quot;, func(context *gin.Context) &#123;</span><br><span class="line">		context.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			&quot;code&quot;:    0,</span><br><span class="line">			&quot;data&quot;:    &quot;hello world&quot;,</span><br><span class="line">			&quot;message&quot;: &quot;success&quot;,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">	log.Fatal(router.Run(&quot;:8080&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Dockerfile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.11+ 默认自动支持Go mod,切记builder的编译和运行的编译内核一致</span></span><br><span class="line">FROM  golang:1.13.15-alpine3.12 as builder</span><br><span class="line"><span class="meta">#</span><span class="bash"> 全局变量，项目名称</span></span><br><span class="line">ARG GOPROXY=https://goproxy.cn,direct</span><br><span class="line">ENV GOPROXY=$&#123;GOPROXY&#125;</span><br><span class="line">WORKDIR /data</span><br><span class="line">COPY . .</span><br><span class="line">RUN go build -v -ldflags &quot;-s -w&quot; -o bin/app cmd/main.go</span><br><span class="line"></span><br><span class="line">FROM alpine:3.12 as runing</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切记环境变量不能共享</span></span><br><span class="line">ARG PROJECT_NAME=project</span><br><span class="line">ARG PROJECT_PORT=8080</span><br><span class="line"></span><br><span class="line">WORKDIR /data/$&#123;PROJECT_NAME&#125;</span><br><span class="line">COPY . .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 含义是 copy上一个镜像的 /data/<span class="variable">$&#123;PROJECT_NAME&#125;</span>/bin/app 文件到当前目录的bin</span></span><br><span class="line">COPY --from=builder /data/bin/app bin/</span><br><span class="line"><span class="meta">#</span><span class="bash"> COPY --from=0 /opt/bin/app .</span></span><br><span class="line">EXPOSE $&#123;PROJECT_PORT&#125;</span><br><span class="line">CMD [ &quot;bin/app&quot; ]</span><br></pre></td></tr></table></figure><p>编译 ：(注意 alpine是不支持 race 的，会编译报错）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t test .</span><br></pre></td></tr></table></figure><p>启动:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  my-docker docker run --rm -p 8080:8080 test  </span><br><span class="line">[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.</span><br><span class="line"></span><br><span class="line">[GIN-debug] [WARNING] Running in &quot;debug&quot; mode. Switch to &quot;release&quot; mode in production.</span><br><span class="line"> - using env:   export GIN_MODE=release</span><br><span class="line"> - using code:  gin.SetMode(gin.ReleaseMode)</span><br><span class="line"></span><br><span class="line">[GIN-debug] GET    /echo                     --&gt; main.main.func1 (3 handlers)</span><br><span class="line">[GIN-debug] Listening and serving HTTP on :8080</span><br></pre></td></tr></table></figure><p>查看大小：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  my-docker docker images</span><br><span class="line">REPOSITORY              TAG                  IMAGE ID            CREATED             SIZE</span><br><span class="line">test                    latest               fdbca700806f        8 minutes ago       17.8MB</span><br><span class="line">alpine                  latest               7731472c3f2a        6 days ago          5.61MB</span><br></pre></td></tr></table></figure><p>其实真实的Go的构建不是这种，一般都有打包机器，无须我们去找机器编译和运行</p><h3 id="7、构建多种系统架构支持的-Docker-镜像"><a href="#7、构建多种系统架构支持的-Docker-镜像" class="headerlink" title="7、构建多种系统架构支持的 Docker 镜像"></a>7、构建多种系统架构支持的 Docker 镜像</h3><p><a target="_blank" rel="noopener" href="https://yeasy.gitbook.io/docker_practice/image/manifest">https://yeasy.gitbook.io/docker_practice/image/manifest</a></p><h2 id="3、Docker-限制资源"><a href="#3、Docker-限制资源" class="headerlink" title="3、Docker 限制资源"></a>3、Docker 限制资源</h2><p>压测程序,不准确，因为数组扩容，是十分消耗内存的，如果内存满了，无法申请内存，那么就不会打印消息！可以使用stress工具来测试CPU和内存。这里我也懒得下载！！</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	ref []<span class="keyword">byte</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(os.Getpid())</span><br><span class="line">	mem, _ := strconv.ParseInt(os.Args[<span class="number">1</span>], <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> mem == <span class="number">0</span> &#123;</span><br><span class="line">			mem = <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">		size := <span class="number">1024</span> * <span class="number">1024</span> * mem</span><br><span class="line">		newSlice(size)</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newSlice</span><span class="params">(size <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	add := <span class="built_in">make</span>([]<span class="keyword">byte</span>, size)</span><br><span class="line">	ref = <span class="built_in">append</span>(ref, add...)                                                        <span class="comment">// 分配size</span></span><br><span class="line">	fmt.Println(fmt.Sprintf(<span class="string">&quot;%s  %v\n&quot;</span>, time.Now().Format(<span class="string">&quot;15:04:05&quot;</span>), os.Getpid())) <span class="comment">// 打印消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面表示：表示在现在的内存是<code>200M</code>，cpu限制是<code>1</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜  go-demo docker run -it --rm --memory  200M  --cpuset-cpus=&quot;1&quot;  --oom-kill-disable -v /Users/dong/go/version/go-1.13.5:/opt/project ce2534430fc2 /bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@17d356297d5f project]# go build -o bin/main study/slice/main2.go</span><br><span class="line"></span><br><span class="line"> // .. 可以发现在45s的卡壳了，也就是内存被限制了</span><br><span class="line">08:52:44  103</span><br><span class="line"></span><br><span class="line">08:52:45  103</span><br><span class="line"></span><br><span class="line">top - 08:52:45 up  5:24,  0 users,  load average: 0.96, 1.45, 1.12</span><br><span class="line">Tasks:   4 total,   1 running,   3 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta">%</span><span class="bash">Cpu(s):  0.3 us,  3.0 sy,  0.0 ni, 93.3 id,  1.0 wa,  0.0 hi,  2.4 si,  0.0 st</span></span><br><span class="line">KiB Mem :  2046748 total,  1592784 free,   324656 used,   129308 buff/cache// 这些信息是假的，不能看</span><br><span class="line">KiB Swap:  1048572 total,   703508 free,   345064 used.  1582140 avail Mem</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</span><br><span class="line">  103 root      20   0  645568 200120     68 S  18.9  9.8   0:01.31 main // 200 m</span><br><span class="line">    1 root      20   0   11836   2400   2400 S   0.0  0.1   0:00.15 bash</span><br><span class="line">   51 root      20   0   11836   2332   2332 S   0.0  0.1   0:00.05 bash</span><br><span class="line">   71 root      20   0   56188   2016   1924 R   0.0  0.1   0:00.03 top</span><br></pre></td></tr></table></figure><p>查看docker容器真实的内存，可以</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker stats 17d356297d5f</span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT   MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">17d356297d5f        cocky_shaw          0.00%               199.4MiB / 200MiB   99.69%              1.18kB / 0B         357MB / 927MB       7</span><br></pre></td></tr></table></figure><h3 id="1、关于内存设置这几个参数的关系"><a href="#1、关于内存设置这几个参数的关系" class="headerlink" title="1、关于内存设置这几个参数的关系"></a>1、关于内存设置这几个参数的关系</h3><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>-m</code>,<code>--memory</code></td><td>内存限制，格式是数字加单位，单位可以为 b,k,m,g。最小为 4M</td></tr><tr><td><code>--memory-swap</code></td><td>内存+交换分区大小总限制。格式同上。必须必<code>-m</code>设置的大</td></tr><tr><td><code>--memory-reservation</code></td><td>内存的软性限制。格式同上</td></tr><tr><td><code>--oom-kill-disable</code></td><td>是否阻止 OOM killer 杀死容器，默认没设置</td></tr><tr><td><code>--oom-score-adj</code></td><td>容器被 OOM killer 杀死的优先级，范围是[-1000, 1000]，默认为 0</td></tr><tr><td><code>--memory-swappiness</code></td><td>用于设置容器的虚拟内存控制行为。值为 0~100 之间的整数</td></tr><tr><td><code>--kernel-memory</code></td><td>核心内存限制。格式同上，最小为 4M</td></tr></tbody></table><p>–memory-swap 值必须比**–memory** 值大，因为：–memory-swap不是交换分区，而是内存加交换分区的总大小</p><h4 id="1-不设置"><a href="#1-不设置" class="headerlink" title="1. 不设置"></a>1. 不设置</h4><p>如果不设置-m,–memory和–memory-swap，容器默认可以用完宿舍机的所有内存和 swap 分区。不过注意，如果容器占用宿主机的所有内存和 swap 分区超过一段时间后，会被宿主机系统杀死（如果没有设置–00m-kill-disable=true的话）。</p><h4 id="2-设置-m-–memory，不设置–memory-swap"><a href="#2-设置-m-–memory，不设置–memory-swap" class="headerlink" title="2. 设置-m,–memory，不设置–memory-swap"></a>2. 设置-m,–memory，不设置–memory-swap</h4><p>给-m或–memory设置一个不小于 4M 的值，假设为 a，不设置–memory-swap，或将–memory-swap设置为 0。这种情况下，容器能使用的内存大小为 a，能使用的交换分区大小也为 a。因为 Docker 默认容器交换分区的大小和内存相同。</p><p>如果在容器中运行一个一直不停申请内存的程序，你会观察到该程序最终能占用的内存大小为 2a。</p><p>比如$ docker run -m 1G ubuntu:16.04，该容器能使用的内存大小为 1G，能使用的 swap 分区大小也为 1G。容器内的进程能申请到的总内存大小为 2G。</p><h4 id="3-设置-m-–memory-a，–memory-swap-b，且b-gt-a"><a href="#3-设置-m-–memory-a，–memory-swap-b，且b-gt-a" class="headerlink" title="3. 设置-m,–memory=a，–memory-swap=b，且b &gt; a"></a>3. 设置-m,–memory=a，–memory-swap=b，且b &gt; a</h4><p>给-m设置一个参数 a，给–memory-swap设置一个参数 b。a 时容器能使用的内存大小，b是容器能使用的 内存大小 + swap 分区大小。所以 b 必须大于 a。b -a 即为容器能使用的 swap 分区大小。</p><p>比如$ docker run -m 1G –memory-swap 3G ubuntu:16.04，该容器能使用的内存大小为 1G，能使用的 swap 分区大小为 2G。容器内的进程能申请到的总内存大小为 3G。</p><h4 id="4-设置-m-–memory-a，–memory-swap-1"><a href="#4-设置-m-–memory-a，–memory-swap-1" class="headerlink" title="4. 设置-m,–memory=a，–memory-swap=-1"></a>4. 设置-m,–memory=a，–memory-swap=-1</h4><p>给-m参数设置一个正常值，而给–memory-swap设置成 -1。这种情况表示限制容器能使用的内存大小为 a，而不限制容器能使用的 swap 分区大小。</p><p>这时候，容器内进程能申请到的内存大小为 a + 宿主机的 swap 大小。</p><h3 id="2、cpu限制"><a href="#2、cpu限制" class="headerlink" title="2、cpu限制"></a>2、cpu限制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker run --help</span><br><span class="line"></span><br><span class="line">Usage:	docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">Run a command in a new container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --add-host list                  Add a custom host-to-IP mapping (host:ip)</span><br><span class="line">  -c, --cpu-shares int                 CPU shares (relative weight)</span><br><span class="line">      --cpus decimal                   Number of CPUs</span><br><span class="line">      --cpuset-cpus string             CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string             MEMs in which to allow execution (0-3, 0,1)</span><br></pre></td></tr></table></figure><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td><code>--cpuset-cpus=&quot;&quot;</code></td><td>允许使用的 CPU 集，值可以为 0-3,0,1</td></tr><tr><td><code>-c</code>,<code>--cpu-shares=0</code></td><td>CPU 共享权值（相对权重）</td></tr><tr><td><code>cpu-period=0</code></td><td>限制 CPU CFS 的周期，范围从 100ms~1s，即[1000, 1000000]</td></tr><tr><td><code>--cpu-quota=0</code></td><td>限制 CPU CFS 配额，必须不小于1ms，即 &gt;= 1000</td></tr><tr><td><code>--cpuset-mems=&quot;&quot;</code></td><td>允许在上执行的内存节点（MEMs），只对 NUMA 系统有效</td></tr></tbody></table><p>关于CFS的概念： <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1da5cfd5cee4">https://www.jianshu.com/p/1da5cfd5cee4</a></p><p>后端基本不需要关注cpu，因为本身不是cpu密集型业务，基本都是io密集型/内存密集型。</p><h2 id="4、docker-push-命令"><a href="#4、docker-push-命令" class="headerlink" title="4、docker push 命令"></a>4、docker push 命令</h2><ul><li>1、docker hub，类似于git一样，比如很多私人仓库，默认是 <a target="_blank" rel="noopener" href="http://hub.docker.com/">hub.docker.com</a>， 比如覆盖则 docker login <a target="_blank" rel="noopener" href="http://aliyun.docker.com/">aliyun.docker.com</a> 等等</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br></pre></td></tr></table></figure><p>输入姓名，输入密码</p><ul><li>2、 查看推送的镜像</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker images </span><br><span class="line"></span><br><span class="line">go1.13.15        latest       ce2534430fc2    26 minutes ago   769MB</span><br></pre></td></tr></table></figure><ul><li>3、第一步需要打tag</li></ul><p>一般是 : docker tag &lt;镜像名称&gt; &lt;用户名&gt;/&lt;镜像名称&gt;:&lt;镜像版本号&gt;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag go1.13.15 fanhaodong/go1.13.15:v1.0</span><br></pre></td></tr></table></figure><ul><li>4、push</li></ul><p>命令： docker push &lt;用户名&gt;/&lt;镜像名称&gt;:&lt;镜像版本号&gt;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push fanhaodong/go1.13.15:v1.0</span><br></pre></td></tr></table></figure><h2 id="5、docker-其他命令"><a href="#5、docker-其他命令" class="headerlink" title="5、docker 其他命令"></a>5、docker 其他命令</h2><h3 id="1、docker-build"><a href="#1、docker-build" class="headerlink" title="1、docker build"></a>1、docker build</h3><p><code>docker build --build-arg arg=value --file Dockerfile_path --tag name:version build_path</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> alpine:latest</span><br><span class="line"><span class="comment"># 变量 = 默认值</span></span><br><span class="line"><span class="keyword">ARG</span> IMG_V=<span class="number">1.0</span> </span><br><span class="line"><span class="keyword">ENV</span> IMG_V=$&#123;IMG_V&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [ <span class="string">&quot;sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;env&quot;</span> ]</span></span><br></pre></td></tr></table></figure><p>执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">➜  docker-file-test docker build --tag test:v1 --file ./Dockerfile --build-arg IMG_V=2.0 .</span><br><span class="line">Sending build context to Docker daemon  20.99kB</span><br><span class="line">Step 1/4 : FROM alpine:latest</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> a24bb4013296</span></span><br><span class="line">Step 2/4 : ARG IMG_V=1.0</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> bd247961f4c5</span></span><br><span class="line">Removing intermediate container bd247961f4c5</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 48608560ae13</span></span><br><span class="line">Step 3/4 : ENV IMG_V=$&#123;IMG_V&#125;</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 0ccb1c5aef84</span></span><br><span class="line">Removing intermediate container 0ccb1c5aef84</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 45d309fc4a52</span></span><br><span class="line">Step 4/4 : CMD [ &quot;sh&quot;,&quot;-c&quot;,&quot;env&quot; ]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 6d266d8d8301</span></span><br><span class="line">Removing intermediate container 6d266d8d8301</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> d4ccf528c0ed</span></span><br><span class="line">Successfully built d4ccf528c0ed</span><br><span class="line">Successfully tagged test:v1</span><br><span class="line"></span><br><span class="line">➜  docker-file-test docker run --rm test:v1</span><br><span class="line">HOSTNAME=59991997b9be</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">IMG_V=2.0</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">PWD=/</span><br></pre></td></tr></table></figure><p>可以看到成功 执行了环境变量！</p><h3 id="2、docker-run"><a href="#2、docker-run" class="headerlink" title="2、docker run"></a>2、docker run</h3><h4 id="传递env"><a href="#传递env" class="headerlink" title="传递env"></a>传递env</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:latesta</span><br><span class="line">CMD [ &quot;sh&quot;,&quot;-c&quot;,&quot;env&quot; ]</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[admin@centos-linux docker-file-test]$ docker build -t test-1 .</span><br><span class="line">Sending build context to Docker daemon  23.04kB</span><br><span class="line">Step 1/2 : FROM alpine:latest</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> a24bb4013296</span></span><br><span class="line">Step 2/2 : CMD [ &quot;sh&quot;,&quot;-c&quot;,&quot;env&quot; ]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 65c81ab9dc1f</span></span><br><span class="line">Removing intermediate container 65c81ab9dc1f</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 027268ad86ee</span></span><br><span class="line">Successfully built 027268ad86ee</span><br><span class="line">Successfully tagged test-1:latest</span><br><span class="line">[admin@centos-linux docker-file-test]$ docker run --env demo=1 test-1</span><br><span class="line">HOSTNAME=d4504e8ef3be</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">demo=1</span><br><span class="line">PWD=/</span><br></pre></td></tr></table></figure><p>传递环境变量，是可以到运行时！</p><h3 id="3、docker-start"><a href="#3、docker-start" class="headerlink" title="3、docker  start"></a>3、docker start</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="shell脚本启动"><a href="#shell脚本启动" class="headerlink" title="shell脚本启动"></a>shell脚本启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取cid</span></span><br><span class="line">CID=$(docker create --rm test-1)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据cid启动</span></span><br><span class="line">docker start $CID</span><br><span class="line"><span class="meta">#</span><span class="bash"> flag</span></span><br><span class="line">echo &quot;start success!!!!&quot;</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[admin@centos-linux docker-file-test]$ bash new.sh</span><br><span class="line">dd9159e2d3da614f6dc7f816300d75ad58c6acf673eb9bea1e8a3f3af60a4137</span><br><span class="line">start success!!!!</span><br></pre></td></tr></table></figure><p>good 启动了 ！！！</p><h3 id="5、挂载"><a href="#5、挂载" class="headerlink" title="5、挂载"></a>5、挂载</h3><p><code>docker run --rm -v /opt test-3</code></p><p>如果容器销毁，宿主机文件也会被销毁！！！！</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">      &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">      &quot;Name&quot;: &quot;79c49a14a84ce8f6ba852e11d91a109ac1c02a6649e83f68b316990404035148&quot;,</span><br><span class="line">      &quot;Source&quot;: &quot;/var/lib/docker/volumes/79c49a14a84ce8f6ba852e11d91a109ac1c02a6649e83f68b316990404035148/_data&quot;,// 宿主机目录</span><br><span class="line">      &quot;Destination&quot;: &quot;/opt&quot;, // 容器目录</span><br><span class="line">      &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">      &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">      &quot;RW&quot;: true,</span><br><span class="line">      &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">&quot;Volumes&quot;: &#123;</span><br><span class="line">      &quot;/home/admin/dong/docker/docker-file-test&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p><code>docker run --rm -v /home/admin/dong/docker/docker-file-te/:/opt test-3</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">        &quot;Source&quot;: &quot;/home/admin/dong/docker/docker-file-test&quot;,</span><br><span class="line">        &quot;Destination&quot;: &quot;/opt&quot;,</span><br><span class="line">        &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">        &quot;RW&quot;: true,</span><br><span class="line">        &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure><h3 id="6、docker-commit"><a href="#6、docker-commit" class="headerlink" title="6、docker commit"></a>6、docker commit</h3><blockquote><p>​ 这个比较适合不会写docker file的人，这里我举个例子，假如现在我们有一个centos:7</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos:7</span><br></pre></td></tr></table></figure><p>其次，我们要安装一个curl命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  /data docker run --rm -it 7e6257c9f8d8  /bin/bash</span><br><span class="line">[root@bcdaea8354a6 /]# yum install -y curl</span><br><span class="line">[root@bcdaea8354a6 /]# curl www.baidu.com</span><br><span class="line">&lt;!DOCTYPE html&gt; // good</span><br></pre></td></tr></table></figure><p>此时我们只需要进行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps -a -l</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">bcdaea8354a6        7e6257c9f8d8        &quot;/bin/bash&quot;         2 minutes ago       Up 2 minutes                            happy_liskov</span><br><span class="line">➜  ~ docker commit bcdaea8354a6  demo-2</span><br><span class="line">sha256:350fbf288cb1a47a29e3d8e441e2814726de6faf54d044a585fb80b7a1f38f83</span><br></pre></td></tr></table></figure><p>这个镜像就OK了，就可以使用 <code>demo-2</code>的镜像了</p></div><div class="reward-container"><div>本人坚持原创技术分享，如果你觉得文章对您有用，请随意打赏! 如果有需要咨询的请发送到我的邮箱!</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="Anthony-Dong 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.png" alt="Anthony-Dong 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>Anthony-Dong</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://anthony-dong.github.io/2020/09/26/58eb7a52b940359a191f97578179026e/" title="Docker学习">https://anthony-dong.github.io/2020/09/26/58eb7a52b940359a191f97578179026e/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Docker/" rel="tag"># Docker</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/03/08/e29180bc3d76b959abec41c7fc18c142/" rel="prev" title="git 日常用法"><i class="fa fa-chevron-left"></i> git 日常用法</a></div><div class="post-nav-item"><a href="/2020/10/06/33ea9e6f1ad28eb266559efefc7ac6a1/" rel="next" title="关于容器化的思考">关于容器化的思考 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81docker-%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-number">1.</span> <span class="nav-text">1、docker 的组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81runc"><span class="nav-number">1.1.</span> <span class="nav-text">1、runc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81containerd"><span class="nav-number">1.2.</span> <span class="nav-text">2、containerd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81shim"><span class="nav-number">1.3.</span> <span class="nav-text">3、shim</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81daemon"><span class="nav-number">1.4.</span> <span class="nav-text">4、daemon</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81Dockerfile-%E5%AD%A6%E4%B9%A0"><span class="nav-number">2.</span> <span class="nav-text">2、Dockerfile 学习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81dockerfile-%E6%96%87%E4%BB%B6%EF%BC%8C%E5%9F%BA%E6%9C%AC%E7%8E%A9%E6%B3%95"><span class="nav-number">2.1.</span> <span class="nav-text">1、dockerfile 文件，基本玩法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81CMD-%E5%92%8C-ENTRYPOINT-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.</span> <span class="nav-text">2、CMD 和 ENTRYPOINT 的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81AND-%E5%92%8C-COPY%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.3.</span> <span class="nav-text">3、AND 和 COPY的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81build-%E5%A4%B1%E8%B4%A5%E5%A6%82%E4%BD%95%E7%BB%A7%E7%BB%AD%EF%BC%8C%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%EF%BC%81%EF%BC%81"><span class="nav-number">2.4.</span> <span class="nav-text">4、build 失败如何继续，如何调试！！</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%80%E4%B8%AAGo%E7%9A%84%E7%8E%AF%E5%A2%83"><span class="nav-number">2.5.</span> <span class="nav-text">5、安装一个Go的环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA"><span class="nav-number">2.6.</span> <span class="nav-text">6、多阶段构建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%E3%80%81%E6%9E%84%E5%BB%BA%E5%A4%9A%E7%A7%8D%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E6%94%AF%E6%8C%81%E7%9A%84-Docker-%E9%95%9C%E5%83%8F"><span class="nav-number">2.7.</span> <span class="nav-text">7、构建多种系统架构支持的 Docker 镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81Docker-%E9%99%90%E5%88%B6%E8%B5%84%E6%BA%90"><span class="nav-number">3.</span> <span class="nav-text">3、Docker 限制资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%85%B3%E4%BA%8E%E5%86%85%E5%AD%98%E8%AE%BE%E7%BD%AE%E8%BF%99%E5%87%A0%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">3.1.</span> <span class="nav-text">1、关于内存设置这几个参数的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%B8%8D%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.1.1.</span> <span class="nav-text">1. 不设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AE%BE%E7%BD%AE-m-%E2%80%93memory%EF%BC%8C%E4%B8%8D%E8%AE%BE%E7%BD%AE%E2%80%93memory-swap"><span class="nav-number">3.1.2.</span> <span class="nav-text">2. 设置-m,–memory，不设置–memory-swap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%AE%BE%E7%BD%AE-m-%E2%80%93memory-a%EF%BC%8C%E2%80%93memory-swap-b%EF%BC%8C%E4%B8%94b-gt-a"><span class="nav-number">3.1.3.</span> <span class="nav-text">3. 设置-m,–memory&#x3D;a，–memory-swap&#x3D;b，且b &gt; a</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%AE%BE%E7%BD%AE-m-%E2%80%93memory-a%EF%BC%8C%E2%80%93memory-swap-1"><span class="nav-number">3.1.4.</span> <span class="nav-text">4. 设置-m,–memory&#x3D;a，–memory-swap&#x3D;-1</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81cpu%E9%99%90%E5%88%B6"><span class="nav-number">3.2.</span> <span class="nav-text">2、cpu限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81docker-push-%E5%91%BD%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">4、docker push 命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81docker-%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="nav-number">5.</span> <span class="nav-text">5、docker 其他命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81docker-build"><span class="nav-number">5.1.</span> <span class="nav-text">1、docker build</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81docker-run"><span class="nav-number">5.2.</span> <span class="nav-text">2、docker run</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E9%80%92env"><span class="nav-number">5.2.1.</span> <span class="nav-text">传递env</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81docker-start"><span class="nav-number">5.3.</span> <span class="nav-text">3、docker start</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8"><span class="nav-number">5.4.</span> <span class="nav-text">shell脚本启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E3%80%81%E6%8C%82%E8%BD%BD"><span class="nav-number">5.5.</span> <span class="nav-text">5、挂载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%E3%80%81docker-commit"><span class="nav-number">5.6.</span> <span class="nav-text">6、docker commit</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Anthony-Dong" src="/images/avatar.png"><p class="site-author-name" itemprop="name">Anthony-Dong</p><div class="site-description" itemprop="description">追寻技术的本质！</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">30</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">42</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/anthony-dong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;anthony-dong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:fanhaodong516@gmail.com" title="E-Mail → mailto:fanhaodong516@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><a href="https://juejin.cn/user/4248168663101320" title="掘金 → https:&#x2F;&#x2F;juejin.cn&#x2F;user&#x2F;4248168663101320" rel="noopener" target="_blank"><i class="fas fa-book fa-fw"></i>掘金</a> </span><span class="links-of-author-item"><a href="mailto:fanhaodong516@163.com" title="国内邮箱 → mailto:fanhaodong516@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>国内邮箱</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Anthony-Dong</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">395k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">6:01</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//tyut.oss-accelerate.aliyuncs.com/image/2022/4-3/medium-zoom.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>document.querySelectorAll("pre.mermaid").length&&NexT.utils.getScript("//tyut.oss-accelerate.aliyuncs.com/image/2022/4-3/mermaid.min.js",()=>{mermaid.initialize({theme:"forest",logLevel:3,flowchart:{curve:"linear"},gantt:{axisFormat:"%m/%d/%Y"},sequence:{actorMargin:50}})},window.mermaid)</script><link rel="stylesheet" href="//tyut.oss-accelerate.aliyuncs.com/image/2022/4-3/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("//tyut.oss-accelerate.aliyuncs.com/image/2022/4-3/gitalk.min.js",()=>{new Gitalk({clientID:"b1c466a9c5677a8d374a",clientSecret:"7cf9512c7e4b46b574e901b18983be7ae5b47d74",repo:"anthony-dong.github.io",owner:"Anthony-Dong",admin:["Anthony-Dong"],id:"120db96931a3ad92d9af9ff72d17b6fa",language:"",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>