<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>Java - Object.wait VS Condition.await ä»¥åŠåœ¨Dubboçš„ä½¿ç”¨ | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/JmBil-MQE/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223360682" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>Java - Object.wait VS Condition.await ä»¥åŠåœ¨Dubboçš„ä½¿ç”¨</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2020-02-16</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/JmBil-MQE/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/Vyew36Twpl/"
								class="tag">JavaåŸºç¡€</a> |
							 <a
								href="https://anthony-dong.github.io/tag/38zE8aaGQ3X/"
								class="tag">JUC</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">3297å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">14 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<p>â€‹	æœ‰äº›äººä¸çŸ¥é“è¿™ä¿©ç©æ„æœ‰å•¥ç”¨, å…¶å®å¤§æœ‰ç”¨å¤„, å¯¹äºæœ‰äº›åŒæ­¥æ“ä½œ, éœ€è¦ä½¿ç”¨å¤§é‡çš„é˜»å¡æ“ä½œ, è¿™ä¸ªç©æ„å¯ä»¥å¾ˆå¥½çš„åšåˆ°é€šçŸ¥æ•ˆæœ. å½“ä½ æ¡ä»¶å¤šæ—¶å€™, ä½ å°±å¯ä»¥ä½¿ç”¨ Conditionäº† .</p>
<h2 id="dubboä¸­ä½¿ç”¨condition">Dubboä¸­ä½¿ç”¨Condition</h2>
<p>æˆ‘ä»¬æ‹¿ä¸ªä¾‹å­æ¥ä¸¾ä¾‹å­.  æ¯”å¦‚ä¸€ä¸ª Dubboæ¡†æ¶ä½ æƒ³è¿‡æ²¡æœ‰. å®¢æˆ·ç«¯å¦‚ä½•æ‹¿åˆ°è¿”å›å€¼çš„ , é‚£ä¹ˆå¦‚ä½•åŠ å…¥è¶…æ—¶, ä¸€ç³»åˆ—çš„é—®é¢˜éƒ½åœ¨è¿™ .  æ‰€ä»¥éœ€è¦æˆ‘ä»¬æ¥æ€è€ƒ .</p>
<p>æˆ‘ç»™å¤§å®¶å±•ç¤ºä¸€å—ä»£ç  : <code>org.apache.dubbo.rpc.protocol.dubbo.DubboInvoker#doInvoke</code></p>
<pre><code class="language-java">@Override
protected Result doInvoke(final Invocation invocation) throws Throwable {
    RpcInvocation inv = (RpcInvocation) invocation;
    // è·å–å½“å‰å®¢æˆ·ç«¯
    ExchangeClient currentClient;
    try {
        // ä¸€å †å‚æ•°è·å–
        boolean isAsync = RpcUtils.isAsync(getUrl(), invocation);
        boolean isAsyncFuture = RpcUtils.isReturnTypeFuture(inv);
        boolean isOneway = RpcUtils.isOneway(getUrl(), invocation);
        int timeout = getUrl().getMethodParameter(methodName, Constants.TIMEOUT_KEY, Constants.DEFAULT_TIMEOUT);
        if (isOneway) {
			// åªæ‰§è¡Œä¸€æ¬¡
            return new RpcResult();
        } else if (isAsync) {
   			// å¼‚æ­¥
            return result;
        } else {
            // åŒæ­¥ , é»˜è®¤å…¶å®æ˜¯åŒæ­¥çš„
            RpcContext.getContext().setFuture(null);
            // å®¢æˆ·ç«¯.get()
            return (Result) currentClient.request(inv, timeout).get();
        }
    } catch (Exception e) {
		// .... ä¸€å †å¼‚å¸¸ 
    } 
}
</code></pre>
<p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ° : <code>org.apache.dubbo.remoting.exchange.support.DefaultFuture#get()</code></p>
<pre><code class="language-java">@Override
public Object get() throws RemotingException {
    return get(timeout);
}
// è·å–ç»“æœ
@Override
public Object get(int timeout) throws RemotingException {
	// æœ‰æ²¡æœ‰ç»“æœ
    if (!isDone()) {
        long start = System.currentTimeMillis();
        // ç±»ä¼¼äºsync obj.waitçš„å†™æ³•
        lock.lock();
        try {
            // æ ¸å¿ƒåœ°æ–¹. å°±æ˜¯è¿™é‡Œ. ä¸æ–­çš„ç­‰å¾…. ç„¶åå¯ä»¥è¾“å…¥ä¸€ä¸ªè¶…æ—¶é—´,å‰ææ˜¯ä½ è¿™ä¸ªé”æ˜¯æ²¡æœ‰å…¶ä»–çº¿ç¨‹æ‹¿åˆ°,è¿™ä¸ªè¶…æ—¶æ—¶é—´æ‰æœ‰æ•ˆ. ä¸ç„¶ä¼šä¸€ç›´ç­‰å¾…åˆ°signalè¢«å”¤é†’,æˆ–è€…çº¿ç¨‹ä¸­æ–­.
            while (!isDone()) {
                done.await(timeout, TimeUnit.MILLISECONDS);
                if (isDone() || System.currentTimeMillis() - start &gt; timeout) {
                    break;
                }
            }
        } catch (InterruptedException e) {
            // æŠ›å‡ºå¼‚å¸¸
        } finally {
            lock.unlock();
        }
        if (!isDone()) {
           // è¶…æ—¶ä¹Ÿæ˜¯æŠ›å‡ºå¼‚å¸¸
        }
    }
    return returnFromResponse();
}
</code></pre>
<p>é‚£ä¹ˆç°åœ¨ç®€å•äº†, ç©¶ç«Ÿæ˜¯è°å¸®åŠ©ä»–å­˜å…¥ç»“æœå‘¢<code>org.apache.dubbo.remoting.exchange.support.DefaultFuture#doReceived</code></p>
<pre><code class="language-java">private void doReceived(Response res) {
    lock.lock();
    try {
        // æ‹¿åˆ°ç»“æœ
        response = res;
        if (done != null) {
            // å”¤é†’
            done.signal();
        }
    } finally {
        // é‡Šæ”¾é”
        lock.unlock();
    }
    // çœ‹çœ‹æœ‰æœ¨æœ‰å›è°ƒ.æœ‰å›è°ƒå°±æ‰§è¡Œå›è°ƒæ–¹æ³•
    if (callback != null) {
        invokeCallback(callback);
    }
}
</code></pre>
<p>æˆ‘ä»¬å†å¾€ä¸Šèµ°å°±åˆ°äº† :   <code>org.apache.dubbo.remoting.transport.dispatcher.connection.ConnectionOrderedChannelHandler#received</code></p>
<p>ç”±äºNettyçš„workerçº¿ç¨‹æœ‰é™, è€Œä¸”workerçº¿ç¨‹,æ¯ä¸ªçº¿ç¨‹åŒæ­¥æ‰§è¡Œ,æ¯”å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªçº¿ç¨‹,é‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯èƒ½å°±ä¼šå› ä¸ºå¤„ç†æ¶ˆæ¯è€Œé˜»å¡. æ‰€ä»¥åˆ†é…ç»™å…¶ä»–çº¿ç¨‹æ± æ¥æ‰§è¡Œ. ä»–å°±å¯ä»¥åªè´Ÿè´£å°†æ¶ˆæ¯è½¬å‘ç»™çº¿ç¨‹æ± æ‰§è¡Œäº†.</p>
<pre><code class="language-java">executor.execute(new ChannelEventRunnable(channel, handler, ChannelState.RECEIVED, message));
</code></pre>
<p>å…¶æ¬¡å°±æ˜¯ <code>org.apache.dubbo.remoting.transport.dispatcher.ChannelEventRunnable</code>  ä»–å®ç°äº†<code>java.lang.Runnable</code> æ¥å£, , æ‰€ä»¥è°ƒç”¨å°±æ˜¯é è¿™ä¸ª.</p>
<pre><code class="language-java">@Override
public void run() {
    if (state == ChannelState.RECEIVED) {
        try {
            // è¿™é‡Œè°ƒç”¨ `org.apache.dubbo.remoting.exchange.support.header.HeaderExchangeHandler`,ç±»ä¼¼ä»¥ä¸€ç§å§”æ´¾æ¨¡å‹,å…¶å®ä¹Ÿå’ŒåŒ…è£…æ¨¡å‹ä¹Ÿåƒ, ä¸€å±‚å±‚åŒ…è£…ä¹Ÿå±äºä¸€å±‚å±‚å§”æ´¾.
            handler.received(channel, message);
        } catch (Exception e) {
			// å¼‚å¸¸
        }
    } else {
        switch (state) {
                /// çœç•¥, æœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹
        }
    }
}
</code></pre>
<p>åŸºæœ¬æµç¨‹å°±æ˜¯è¿™ä¸ª. :</p>
<p>å½“Referenceå¯¹è±¡è°ƒç”¨ä¸€ä¸ªRPCæ—¶ , ä¼šè¢«åŠ¨æ€ä»£ç†åˆ°æ‰§è¡Œ<code>doiovoke</code>æ–¹æ³•é‚£å». ä»–ä¼šä¸æ–­çš„ç­‰å¾….ç­‰åˆ°åˆ°æ‹¿å»ç»“æœ. (è¿™é‡Œä½¿ç”¨åˆ°äº†ReentrantLock+Condition) ,  æ­¤æ—¶æœåŠ¡å™¨åé¦ˆå›æ¶ˆæ¯æ¥äº†. æ­¤æ—¶å°±ä¼šæ‰§è¡Œå§”æ´¾æ¨¡å‹, ä¸æ–­çš„åˆ†å‘ç»™ä¸‹ä¸€çº§ , æœ€åäº¤ç»™ä¸€ä¸ªçº¿ç¨‹æ± å¤„ç† .ç„¶åå†è°ƒç”¨<code>DefaultFuture</code> , å¸®åŠ©ç»“æœèµ‹å€¼,ç„¶åè¿”å›.</p>
<p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜, æˆ‘è¯´è¿‡. å°±æ˜¯å½“ä¸€ä¸ªé”è¢«ä¿©çº¿ç¨‹æ‹¿åˆ°. é‚£ä¹ˆ wait()çš„è¶…æ—¶æ•ˆæœå°±æ²¡æœ‰äº† . å½¢åŒè™šè®¾. é‚£ä¹ˆDubboé‡‡ç”¨äº†ä¸€ä¸ªå¼€å¯ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…. å°†æˆ‘ä»¬çš„<code>DefaultFuture</code>å¯¹è±¡äº¤ç»™å®ƒ  . å¦‚æœå‘ç°è¶…æ—¶ç›´æ¥è¿”å›ä¸€ä¸ªè¶…æ—¶ç»“æœ. æ‰€ä»¥è¿™äº›éƒ½æ˜¯ç»†èŠ‚.  æ›´å¤šç»†èŠ‚è¯·çœ‹ <code>org.apache.dubbo.common.timer.HashedWheelTimer</code> , ä»–ç±»ä¼¼äºä¸€ä¸ªè¡¨ç›˜.æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥ä¸€æ¬¡ . æœ‰æ²¡æœ‰ <code>org.apache.dubbo.common.timer.TimerTask</code> è½å…¥è¡¨ç›˜. å¦‚æœæœ‰å°±æ‰§è¡Œäº†.</p>
<h2 id="objectwait-å’Œ-objectnotify"><code>Object.wait()</code> å’Œ  <code>Object.notify()</code></h2>
<blockquote>
<p>â€‹	å…¶ä¸­ Object.wait() è¿˜æœ‰åŠ å…¥è¶…æ—¶æœºåˆ¶çš„. Object.notify() è¿˜æœ‰ä¸€ä¸ª notifyAll(). ä¸‹é¢éƒ½ä¼šè®² , ä½ è¦ç†è§£äº†ä»–çš„æµç¨‹. å°±æ˜ç™½äº†Conditionäº†.</p>
</blockquote>
<p>æˆ‘ä»¬æ¥ä¸ªç®€å•çš„ä¾‹å­. æ¥ä½“éªŒä¸€ä¸‹ waitæ–¹æ³• .</p>
<pre><code class="language-java">private static String rest = null;

public static void main(String[] args){
    Object lock = new Object();

    // å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹,ç­‰å¾…,ç›´åˆ°restæœ‰ç»“æœ.
    new Thread(() -&gt; {
        synchronized (lock) {
            try {
                while (rest == null) {
                    // è¿™é‡Œä¼šç­‰å¾…æœ‰äººå°†ä»–å”¤é†’,å½“æ‰§è¡Œç¬¬ä¸€æ¬¡æ‰§è¡Œwaitæ–¹æ³•æ—¶, ä»–ä¼šé‡Šæ”¾locké”.ä»£è¡¨å…¶ä»–çº¿ç¨‹å¯ä»¥æ‹¿åˆ°é”äº†
                    lock.wait();
                }
                System.out.println(String.format(&quot;res : %s&quot;,rest));
            } catch (InterruptedException e) {
                //
            }
        }
    }).start();

    // å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹, æ¥æ‰§è¡Œ,ç„¶åå‘Šè¯‰ä»–ç»“æœ.
    new Thread(() -&gt; {
        synchronized (lock) {
            sleep(2000);
            rest = &quot;è¾›è‹¦ä½ äº†,ç­‰äº†2S.&quot;;
            lock.notify();
        }
    }).start();
}
</code></pre>
<p>è¾“å‡º :</p>
<pre><code class="language-java">res : è¾›è‹¦ä½ äº†,ç­‰äº†2S.
</code></pre>
<p>é€šè¿‡ä¸Šè¯‰ä¾‹å­, æˆ‘ä»¬çŸ¥é“. å½“è°ƒç”¨äº† <code>notify</code> ä¼šé‡Šæ”¾ä¸€ä¸ªç­‰å¾…çº¿ç¨‹. é‚£ä¹ˆæˆ‘ä»¬å†å¤šä¸€ä¸ªç­‰å¾…çº¿ç¨‹å‘¢.  æˆ‘ä»¬å°†ä¸Šé¢ä¸¤ä¸ªçº¿ç¨‹runnableå°è£…ä¸€ä¸‹. çœä»£ç ç©ºé—´</p>
<pre><code class="language-java">new Thread(waiter).start();
new Thread(waiter).start();
new Thread(notifier).start();
</code></pre>
<p>è¾“å‡º :</p>
<pre><code class="language-java">thread : Thread-0, res : è¾›è‹¦ä½ äº†,ç­‰äº†2S.
</code></pre>
<p>å‘ç°åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’. å…¶å®è¿™é‡Œä¹Ÿæœ‰å…ˆåé¡ºåºçš„.</p>
<h4 id="æ‰§è¡Œæµç¨‹">æ‰§è¡Œæµç¨‹</h4>
<p>â€‹		åœ¨æ‰§è¡Œ<code>waitæ–¹æ³•</code>ä¹‹å‰ï¼Œå¿…é¡»å»äº‰å¤ºSynchorizedé”,ä¸ç„¶ä¼šæŠ›å‡ºå¼‚å¸¸çš„ <code>IllegalMonitorStateException</code>ï¼Œé¦–å…ˆä¼šæ‰§è¡ŒJVMæŒ‡ä»¤<code>monitorenter</code> ,å¦‚æœå½“å‰çº¿ç¨‹è·å–åˆ°æ­¤å¯¹è±¡(lockå¯¹è±¡),é‚£ä¹ˆlockå¯¹è±¡çš„markwordä¼šè®°å½•è¯¥é”çš„çº¿ç¨‹æŒæœ‰è€…å’Œè®¡æ•°å™¨.åŒæ—¶åœ¨æ‰§è¡ŒLock.wait()çš„æ—¶å€™,æ­¤æ—¶å·²ç»æ˜¯æŒæœ‰é”äº†. æ­¤æ—¶å°±ä¼šæ‰§è¡Œé‡Šæ”¾é”æ“ä½œ . å¯¹äºä¸Šè¯‰é‚£ä¸ªä¾‹å­æ¥è¯´,å°±æ˜¯thread2å¯ä»¥æ‰§è¡Œäº†.</p>
<p>â€‹	  æ€ä¹ˆè¯´è¯´è¿™ä¸ªwaitçº¿ç¨‹å»å“ªäº† ? , åœ¨JVMé‡Œ, æœ‰ä¸€ä¸ª<code>_WaitSet</code> è¿™ä¸ªé›†åˆè¿›è¡Œä¿å­˜, ä»–æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„(å®é™…ä¸Šæ˜¯é˜Ÿåˆ—ç»“æ„, å…ˆè¿›å…ˆå‡º). å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œwaitæ—¶, ç¬¬ä¸€æ­¥å°†ä»–å°è£…æˆä¸€ä¸ªnodeèŠ‚ç‚¹, ç±»ä¼¼äºAQS, ç„¶åå°†è¿™ä¸ªèŠ‚ç‚¹nodeæ·»åŠ åˆ° waitsetä¸­, ç„¶åè°ƒç”¨<code>ObjectMonitor::exit</code> é‡Šæ”¾å½“å‰çš„monitorå¯¹è±¡(localå¯¹è±¡).æœ€ç»ˆè°ƒç”¨<code>park</code>å°†ä»–æŒ‚èµ·. è·ŸAQSå¦‚å‡ºä¸€è¾™.</p>
<p>â€‹	 é‚£ä¹ˆå½“æœ‰çº¿ç¨‹è°ƒç”¨<code>notify</code>æ—¶(å‰æä¹Ÿæ˜¯æ­¤çº¿ç¨‹å¾—å…ˆæ‹¿åˆ°é”,å°±æ˜¯åŠ åŒæ­¥ä»£ç å—äº†), ç„¶ååå‘æ“ä½œäº†, ä»–ä¼šå°†waitsetä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ‹¿å‡ºæ¥. ç„¶åå°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°è£…çš„çº¿ç¨‹æ‰§è¡Œ<code>unpark</code>æ“ä½œ. å¹¶ä¸”å°†å®ƒç§»åˆ° <code>EntrySet</code>ä¸­, ä¹Ÿå°±æ˜¯ç­‰å¾…çº¿ç¨‹çš„é›†åˆä¸­. å½“ä½ é€€å‡º<code>sync(obj){}</code> åŒæ­¥ä»£ç å—æ—¶(å°±ä¼šè°ƒç”¨äº†<code>monitorexit</code>), ä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„é”.</p>
<p>æ­¤æ—¶åˆšåˆšç­‰å¾…çš„çº¿ç¨‹ä¼šåœæ­¢ç­‰å¾… . æ‰€ä»¥å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹.</p>
<p>â€‹	é‚£ä¹ˆè¯´è¯´ <code>notifyAll</code>  , ä»–çš„åšæ³•å°±æ˜¯å°† WaitSeté›†åˆå…¨éƒ¨éå†ä¸€éå…¨éƒ¨é‡Šæ”¾.</p>
<h4 id="objectwaitlong-timeout"><code>Object.wait(long timeout)</code></h4>
<blockquote>
<p>â€‹	ä¸ºä»€ä¹ˆæˆ‘è¦å•ç‹¬æ‹¿å‡ºæ¥, è¶…æ—¶æœ‰å•¥å¥½å¤šçš„ , å› ä¸ºè¿™ä¸ªè¶…æ—¶æ˜¯å‡çš„(å…¶å®ä¸Šé¢é‚£æ®µè¯å¾ˆæ˜ç™½äº†) . å¹¶ä¸æ˜¯è¶…æ—¶äº†ä¸€å®šä¼šè¶…æ—¶.  æˆ‘ä»¬çœ‹çœ‹ä¾‹å­.</p>
</blockquote>
<p>æˆ‘ä»¬å°†åŸæ¥çš„waiteræ”¹æˆä¸€ä¸ªåŠ äº†è¶…æ—¶çš„, è¿™ä¸ªå•ä½æ˜¯ms, æˆ‘ä»¬å†æ¬¡æ‰§è¡Œ.</p>
<pre><code class="language-java">Runnable waiter = () -&gt; {
    synchronized (lock) {
        long start = System.currentTimeMillis();
        try {
            while (rest == null) {
                // è¿™é‡Œä¼šç­‰å¾…æœ‰äººå°†ä»–å”¤é†’,å½“æ‰§è¡Œç¬¬ä¸€æ¬¡æ‰§è¡Œwaitæ–¹æ³•æ—¶, ä»–ä¼šé‡Šæ”¾locké”.ä»£è¡¨å…¶ä»–çº¿ç¨‹å¯ä»¥æ‹¿åˆ°é”äº†
                lock.wait(1000);
                System.out.println(String.format(&quot;thread : %s wait : %dms&quot;, Thread.currentThread().getName(), System.currentTimeMillis() - start));
            }
            System.out.println(String.format(&quot;thread : %s, res : %s , cost : %dms&quot;, Thread.currentThread().getName(), rest, System.currentTimeMillis() - start));
        } catch (InterruptedException e) {
            //
        }
    }
};
</code></pre>
<p>ç„¶åå†æ¬¡è¿è¡Œ, å‘ç°ä»€ä¹ˆ?  èŠ±è´¹äº†</p>
<pre><code class="language-java">thread : Thread-0 wait : 2002ms
thread : Thread-0, res : è¾›è‹¦ä½ äº†,ç­‰äº†2S. , cost : 2016ms
</code></pre>
<p>æ‰€ä»¥ç»“æœæ˜¯å•¥, è¶…æ—¶æœ‰ç”¨å—. æ²¡æœ‰, é‚£ä¹ˆæ˜¯ä¸ºä»€ä¹ˆå‘¢?</p>
<h4 id="åŸå› ">åŸå› </h4>
<p>å› ä¸ºå½“ä½ æ‰§è¡Œ <code>lock.wait(1000)</code> å½“ä½ è¶…æ—¶ç»“æŸ. è¿™é‡Œæ˜¯JVMé‡Œçš„, JVMé‡Œä½ è¶…æ—¶ç»“æŸäº†. é‚£ä¹ˆé¦–å…ˆä½ éœ€è¦å»æ‹¿åˆ°é”. ä½ æ‹¿ä¸åˆ°é”. ä¼šç»§ç»­æ‰§è¡Œ <code>lock.wait(1000)</code>   ,AQSçš„æºç å’ŒJVMæ€æƒ³åŸºæœ¬ä¸€è‡´ . ç›´åˆ°ä½ æ‹¿åˆ°é”. ä½ æ‰ä¼šwaitç»“æŸ, æ‰€ä»¥ä¹Ÿå°±æ˜¯ä¸Šé¢ä¸ºå•¥ ä½ çš„èŠ±è´¹äº†2000ms, è€Œåªç­‰å¾…äº†1000ms.</p>
<h2 id="condition">Condition</h2>
<p>å…¶å®conditionè·Ÿ javaçš„wait-notifyæ€æƒ³æ˜¯ä¸€æ¨¡ä¸€æ ·çš„. æˆ‘å°†å…¶å¯¹åº”çš„æ–¹æ³•å…³è”ä¸€ä¸‹. æºç ä¹Ÿä¸æ˜¯å¤ªéš¾, è®¾è®¡åˆ°å¤§é‡çš„CASåŒæ­¥æ“ä½œ, ä¸€æ¬¡parkå’Œunpackæ“ä½œ, åŸºæœ¬å’ŒJVMå†…éƒ¨æ€æƒ³ä¸€è‡´.  ä¸è¿‡ä»–çš„çµæ´»æ€§é«˜ç‚¹. (éšç€JVMçš„è¿›æ­¥, å…¶å®è¿™ç§æ€§èƒ½å·®è·ä¼šä¸æ–­ç¼©å°, è€Œä¸”ä»£ç æ›´åŠ ç®€ä¾¿, JVMæ§åˆ¶ä¸å®¹æ˜“å‡ºç°é—®é¢˜. æ‰€ä»¥æˆ‘æ¨èæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚å°±ç”¨waitå’Œnotifyè¶³å¤Ÿäº†)</p>
<p>é‚£ä¹ˆConditionæ€ä¹ˆæ¥å‘¢ . æˆ‘ä»¬çœ‹çœ‹ Lockæ¥å£ä»–æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ <code>Condition newCondition();</code></p>
<p><strong>å¯¹ , ä¸€æŠŠé”å¯ä»¥new å¾ˆå¤šä¸ªCondition. è¿™ç‚¹æ˜¯Javaå†…ç½®çš„wait-notifyåšä¸åˆ°çš„. è¿™ä¸ªä¼˜ç‚¹å°±æ˜¯ä¸€æŠŠé”å¯ä»¥æ§åˆ¶å¤šä¸ªCondition, ä¸æ˜¯ä¸€æŠŠé”ä¸€ä¸ªCondition . æ‡‚äº†å§.</strong></p>
<p>å…¶æ¬¡æ˜¯Conditionæœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯ <code>awaitUninterruptibly</code> , æ˜¯ä¸å¯ä¸­æ–­çš„ç­‰å¾…. æˆ‘ä»¬çŸ¥é“Javaå†…ç½®çš„wait-notify,waitæ–¹æ³•å¯ä»¥è¢«æ‰“æ–­çš„.</p>
<p>æˆ‘ä»¬æ¥æ‹¿BlockStackä¸ºä¾‹å­.  æ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„æ•°ç»„ .  ä¹ˆåŠæ³•æ‡’å¾—å†™é˜Ÿåˆ—, å› ä¸ºä¸€ä¸ªå˜é‡ä¾¿å¯ä»¥ç»´æŠ¤å¥½æ ˆ.</p>
<pre><code class="language-java">public class BlockStack {

    final Lock lock = new ReentrantLock();
    // å½“æ»¡äº†.å°±é˜»å¡
    final Condition full = lock.newCondition();

    // å½“ç©ºäº†, ä¹Ÿé˜»å¡.
    final Condition empty = lock.newCondition();

    final Object[] arr;

    public BlockStack(int size) {
        arr = new Object[size];
    }

    // å½“å‰ç´¢å¼•ä½ç½®
    int count = 0;

    public void push(Object val) throws InterruptedException {
        // lockè·å–é”
        lock.lock();
        try {
            // å¦‚æœæ»¡äº†.å°±ä¸€ç›´ç­‰å¾…
            if (count == arr.length) {
                // await-&gt; park()..(ç­‰åˆ«äººunpark).. -&gt;tryacq()è·å–é”-&gt; æ‹¿åˆ°é”æˆåŠŸ-&gt;ç»“æŸwait
                full.await();
            }
            arr[count] = val;
            count++;
            empty.signal();
        } finally {
            // unlock -&gt; release(1)-&gt;é‡Šæ”¾é”
            lock.unlock();
        }
    }

    // å‰”é™¤æ ˆé¡¶
    public Object pop() throws InterruptedException {
        lock.lock();
        try {
            while (count == 0) {
                empty.await();
            }
            // æ­¤æ—¶countå·²ç»+1äº†,æ‰€ä»¥æˆ‘ä»¬æ‹¿ä¸åˆ°åˆšåˆšæ’è¿›å»çš„
            Object obj = arr[--count];
            // æ‰¾åˆ°ä¸€ä¸ªConditioné˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹-&gt;å°†awaitçº¿ç¨‹ä»conditioné˜Ÿåˆ—æ”¾å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­(æ ¸å¿ƒæ–¹æ³•åœ¨AQSçš„eqæ–¹æ³•ä¸­)-&gt;unpark(awaitçº¿ç¨‹)
            full.signal();
            return obj;
        } finally {
            lock.unlock();
        }
    }
}
</code></pre>
<p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ‰§è¡Œæµç¨‹.  å‰ææ˜¯T1 æ¯” T2å…ˆæ‰§è¡Œ</p>
<pre><code class="language-java">public class AQS {

    public static void main(String[] args) {
        final Lock lock = new ReentrantLock();
        final Condition full = lock.newCondition();
        // t1çº¿ç¨‹
        new Thread(() -&gt; {
            lock.lock();
            try {
                full.await();
            } catch (InterruptedException e) {
                //
            } finally {
                lock.unlock();
            }
        },&quot;t1&quot;).start();
        // t2çº¿ç¨‹
         new Thread(() -&gt; {
            lock.lock();
            try {
                // 
                full.signal();
                
            } finally {
                lock.unlock();
            }
       },&quot;t2&quot;).start();
    }
}
</code></pre>
<p>å‡è®¾T1æ‹¿é”çš„æ—¶é—´ ä¼˜äº T2æ‰§è¡Œ. å¦‚æœæ‰§è¡Œæ»¡äº†. å°±ä¼šæ— è„‘çš„awaitä¸‹å»/</p>
<p>park æ“ä½œæ˜¯ å½“å‰çº¿ç¨‹å°†è‡ªå·±æ‰§è¡Œwaiting , ä½ è¯´éš¾ä¸éš¾,çœ‹è¿‡ç§‘å¹»ç‰‡æ²¡æœ‰å°±æ˜¯è‡ªå·±å†°å°è‡ªå·±,æ— ä¼‘æ­¢çš„ç¡çœ ä¸‹å». è·Ÿsleepä¸€æ ·. åªæ˜¯ä»–æ²¡æœ‰æŒ‡å®šæ—¶é—´. è¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªäºº,å°±æ˜¯å¦ä¸€ä¸ªäºº,æŠŠä»–å”¤é†’.å°±æ˜¯unparkæ“ä½œäº†..</p>
<hr>
<p><code>T1.Lock()</code>  -&gt;<code>tryaq()</code> -&gt;<code>t1æ‹¿åˆ°é”</code> -&gt;<code>T1.FULL.await()</code> -&gt; ....</p>
<hr>
<p><code>T2.Lock()</code>  -&gt; <code>tryaq()</code>  -&gt; ç”±äºT1å·²ç»æ‹¿åˆ°é”äº†,è‡ªå·±åªèƒ½é•¿çœ äº† <code>-&gt; (ç¡å“‡ç¡.....)</code> -&gt; <code>(TAG1) å°†è‡ªå·±å”¤é†’äº†</code>-&gt; ç»§ç»­æ“ä½œ, ä¹Ÿå°±æ˜¯èµ°åˆ°äº† <code>T2.FULL.signal</code> .</p>
<hr>
<p><code>T1.FULL.await()</code> -&gt; <code>å°†è‡ªå·±åŠ å…¥åˆ°ä»conditioné˜Ÿåˆ—</code> -&gt; <code>é‡Šæ”¾é”(TAG1)</code> -&gt;  <code>è‡ªå·±park(),é•¿çœ ä¸‹å»</code>  -&gt; (ç¡å“‡ç¡) -&gt; <code>(TAG2)å°†è‡ªå·±å”¤é†’</code> -&gt; <code>ç¬¬ä¸€ä»¶äº‹æ£€æŸ¥è‡ªå·±æ˜¯å¦è¢«ä¸­ç«¯</code>   -&gt;<code>(åˆ¤æ–­headæ˜¯ä¸æ˜¯è‡ªå·±),å†å°è¯•å»è·å–é”</code> -&gt; <code>æ‹¿åˆ°é”è‡ªç„¶å°±ç»“æŸäº†</code>(ä¸­é—´è¿‡ç¨‹unparkå , ä¸ä¸€å®šå®Œäº‹å¤§å‰äº†,å¯èƒ½æ˜¯è¢«æ¨åˆ°äº†åé¢,ä¹Ÿå°±æ˜¯ç»§ç»­park,å…·ä½“å®ç°åœ¨ <code>AQS.acquireQueued</code> )   ----&gt; çœŸæ­£æ‹¿åˆ°é”æ‰ä¼šç»§ç»­æ‰§è¡Œ......</p>
<hr>
<p><code>T2.FULL.signal</code> -&gt; <code>æ‰¾åˆ°conditioné˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹,ç§»é™¤(ä¹Ÿå°±æ˜¯T1çº¿ç¨‹)</code> -&gt;  <code>å°†T1çº¿ç¨‹åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­(æ ¸å¿ƒæ–¹æ³•åœ¨AQSçš„eqæ–¹æ³•ä¸­,çº¿ç¨‹å®‰å…¨æ“ä½œ,æ‰€ä»¥ä¸ä¿è¯T1åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—çš„headéƒ¨åˆ†)</code> , æ‰§è¡Œå®Œæ¯•äº†å°±.</p>
<hr>
<p><code>T2.unlock ()</code> -&gt; <code>release()</code> -&gt; <code>é‡Šæ”¾é”(TAG2)</code>  æ‰§è¡Œå®Œæ¯•.</p>
<hr>
<p><code>T1.unlock</code>  ç»“æŸå®Œæˆ.</p>
<p>**æ‹¿é”çš„è¿‡ç¨‹ : **</p>
<blockquote>
<p>â€‹	æ‹¿é”è¿‡ç¨‹å¾ˆç®€å•, çŠ¶æ€é‡å¦‚æœå¯ä»¥ä¿®æ”¹, å°±æˆåŠŸæ‹¿é”, å°†AQSçš„å ç”¨çº¿ç¨‹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹.</p>
<p>â€‹	å¦‚æœçŠ¶æ€é‡ä¿®æ”¹å¤±è´¥. åŠ å…¥AQSç­‰å¾…é˜Ÿåˆ—. ç„¶åè°ƒç”¨parkæ“ä½œ, å°†è‡ªå·±ç¡çœ .</p>
</blockquote>
<p><strong>é‡Šæ”¾é”çš„æµç¨‹ :</strong></p>
<blockquote>
<p>â€‹	æ³¨æ„è¿™ä¸ªå…¨éƒ¨æ“ä½œæ˜¯å®‰å…¨çš„, ä¹Ÿå°±æ˜¯ä¸éœ€è¦CAS , å°†AQSå ç”¨çº¿ç¨‹è®¾ç½®ä¸ºNULL , é‡ç½®çŠ¶æ€é‡ ,  ç„¶åå»çœ‹ç­‰å¾…é˜Ÿåˆ—, çœ‹çœ‹é‡Œæœ‰æ²¡æœ‰äºº , æœ‰äººç®€å•, ç›´æ¥æŠŠç¬¬ä¸€ä¸ªäººå«èµ·æ¥, (unpacké‚£ä¸ªäºº) , å°±å¥½äº†. å®Œæˆå·¥ä½œè¿”å›.</p>
</blockquote>
<blockquote>
<p>â€‹	æ€»ç»“ : AQSå…¶å®ä¸éš¾, éš¾çš„æ˜¯æ€æƒ³, å¦‚ä½•å®‰å…¨çš„æ’å…¥é˜Ÿåˆ—,åœ¨ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹, å¦‚ä½•å®ç°å…¬å¹³ , å¦‚ä½•é«˜æ•ˆçš„ç»´æŠ¤é˜Ÿåˆ—. è¿™äº›éƒ½æ˜¯éš¾é¢˜.  å½“ä½ æ‡‚äº†AQS å…¶å®Conditionå¹¶ä¸éš¾.</p>
</blockquote>
<h2 id="æ³¨æ„">æ³¨æ„</h2>
<p>**æ³¨æ„ä¸€ç‚¹å°±æ˜¯  :  ** å°±ç®—æ˜¯ <code>Object.wait()</code>å’Œ<code>Condition.await()</code>   æ“ä½œä»–ä»¬éƒ½æ˜¯éœ€è¦æ‹¿åˆ°é”, æ‰èƒ½ç»§ç»­æ‰§è¡Œ, æ‡‚äº†å—, åŠ å…¥è¶…æ—¶ä¹Ÿæ˜¯, éƒ½æ˜¯éœ€è¦å†æ¬¡è·å–é”, è¿™æ ·ä¿è¯äº†å®‰å…¨æ€§.   æ‰€ä»¥è¿™ä¿©æ–¹å¼éƒ½éœ€è¦æ“ä½œä¸­è·å–ä¸¤æ¬¡é”. æ‰€ä»¥æ•ˆç‡å¯èƒ½è€ŒçŸ¥. æ‰€ä»¥ä¸€èˆ¬ç”¨äºåŒæ­¥è·å–æ•°æ®æ—¶ç”¨åˆ°.</p>
<p>è¿™é‡Œåæ§½ä¸€ä¸‹<code>FutureTask.get() æ–¹æ³•</code> , ç«Ÿç„¶ä½¿ç”¨çš„æ˜¯ç©ºè½¬ ,è¿™ä¸ªç©æ„è‡³å°‘ä¸æ¯”ç©ºè½¬å¥½å—.</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#dubbo%E4%B8%AD%E4%BD%BF%E7%94%A8condition">Dubboä¸­ä½¿ç”¨Condition</a></li>
<li><a href="#objectwait-%E5%92%8C-objectnotify"><code>Object.wait()</code> å’Œ  <code>Object.notify()</code></a><br>
*
<ul>
<li><a href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">æ‰§è¡Œæµç¨‹</a></li>
<li><a href="#objectwaitlong-timeout"><code>Object.wait(long timeout)</code></a></li>
<li><a href="#%E5%8E%9F%E5%9B%A0">åŸå› </a></li>
</ul>
</li>
<li><a href="#condition">Condition</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F">æ³¨æ„</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>