<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>Nginx | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/nginx/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223299317" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>Nginx</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-09-10</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/nginx/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/FDJxOVwJI_i/"
								class="tag">linux</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">1593å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">7 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<h2 id="1æ¦‚å¿µ">1.æ¦‚å¿µ:</h2>
<blockquote>
<p>nginxæ˜¯ä¸€æ¬¾è‡ªç”±çš„ã€å¼€æºçš„ã€é«˜æ€§èƒ½çš„HTTPæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼›åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªIMAPã€POP3ã€SMTPä»£ç†æœåŠ¡å™¨ï¼›nginxå¯ä»¥ä½œä¸ºä¸€ä¸ªHTTPæœåŠ¡å™¨è¿›è¡Œç½‘ç«™çš„å‘å¸ƒå¤„ç†ï¼Œå¦å¤–nginxå¯ä»¥ä½œä¸ºåå‘ä»£ç†è¿›è¡Œè´Ÿè½½å‡è¡¡çš„å®ç°ã€‚ æˆ‘ä»¬å°†é™æ€èµ„æºæ”¾åˆ°nginxä¸­ï¼Œé™æ€èµ„æºå¯ä»¥è½¬å‘åˆ°æœåŠ¡å™¨FS, åŠ¨æ€è¯·æ±‚å¯ä»¥ä»£ç†åˆ°tomcatä¹‹ç±»çš„æœåŠ¡å™¨</p>
<p>ç½‘ç«™ http://nginx.org/</p>
</blockquote>
<h2 id="2-å¯¹ä»£ç†æœåŠ¡å™¨è€Œè¨€çš„æ­£å‘ä»£ç†ä¸åå‘ä»£ç†">2. å¯¹ä»£ç†æœåŠ¡å™¨è€Œè¨€çš„æ­£å‘ä»£ç†ä¸åå‘ä»£ç†</h2>
<h4 id="1æ­£å‘ä»£ç†">1.æ­£å‘ä»£ç†</h4>
<figure data-type="image" tabindex="1"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy82MTUyNTk1LWQ3OGJiOWE3NzZiYmUxMmIucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXAlN0NpbWFnZVZpZXcyLzIvdy8xMjQw" alt="image" loading="lazy"></figure>
<pre><code>å®¢æˆ·ç«¯æƒ³è¦è®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä½†æ˜¯å®ƒå¯èƒ½æ— æ³•ç›´æ¥è®¿é—®è¿™å°æœåŠ¡å™¨ï¼Œè¿™æ—¶å€™è¿™å¯æ‰¾ä¸€å°å¯ä»¥è®¿é—®ç›®æ ‡æœåŠ¡å™¨çš„å¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œè€Œè¿™å°æœåŠ¡å™¨å°±è¢«å½“åšæ˜¯ä»£ç†äººçš„è§’è‰² ï¼Œç§°ä¹‹ä¸ºä»£ç†æœåŠ¡å™¨ï¼Œäºæ˜¯å®¢æˆ·ç«¯æŠŠè¯·æ±‚å‘ç»™ä»£ç†æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ˜¯æ¸…æ¥šç›®æ ‡æœåŠ¡å™¨çš„åœ°å€çš„ï¼Œè€Œç›®æ ‡æœåŠ¡å™¨æ˜¯ä¸æ¸…æ¥šæ¥è‡ªå®¢æˆ·ç«¯ï¼Œå®ƒåªçŸ¥é“æ¥è‡ªå“ªä¸ªä»£ç†æœåŠ¡å™¨ï¼Œæ‰€ä»¥æ­£å‘ä»£ç†å¯ä»¥å±è”½æˆ–éšè—å®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy82MTUyNTk1LWYxZTdlZTA5MDdiZjJhMTUucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXAlN0NpbWFnZVZpZXcyLzIvdy8xMjQw" alt="image" loading="lazy"></figure>
<h4 id="2åå‘ä»£ç†">2.åå‘ä»£ç†</h4>
<p>ä»ä¸Šé¢çš„æ­£å‘ä»£ç†ï¼Œä½ ä¼šå¤§æ¦‚çŸ¥é“ä»£ç†æœåŠ¡å™¨æ˜¯ä¸ºå®¢æˆ·ç«¯ä½œä»£ç†äººï¼Œå®ƒæ˜¯ç«™åœ¨å®¢æˆ·ç«¯è¿™è¾¹çš„ã€‚<br>
å…¶å®åå‘ä»£ç†å°±æ˜¯ä»£ç†æœåŠ¡å™¨ä¸ºæœåŠ¡å™¨ä½œä»£ç†äººï¼Œç«™åœ¨æœåŠ¡å™¨è¿™è¾¹ï¼Œå®ƒå°±æ˜¯å¯¹å¤–å±è”½äº†æœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œå¸¸ç”¨çš„åœºæ™¯å°±æ˜¯å¤šå°æœåŠ¡å™¨åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œåƒä¸€äº›å¤§çš„ç½‘ç«™ï¼Œç”±äºè®¿é—®äººæ•°å¾ˆå¤šï¼Œå°±éœ€è¦å¤šå°æœåŠ¡å™¨æ¥è§£å†³äººæ•°å¤šçš„é—®é¢˜ï¼Œè¿™æ—¶è¿™äº›æœåŠ¡å™¨å°±ç”±ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨æ¥ä»£ç†ï¼Œå®¢æˆ·ç«¯å‘æ¥è¯·æ±‚ï¼Œå…ˆç”±åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åæŒ‰ä¸€å®šçš„è§„åˆ™åˆ†å‘åˆ°æ˜ç¡®çš„æœåŠ¡å™¨ï¼Œè€Œå®¢æˆ·ç«¯ä¸çŸ¥é“æ˜¯å“ªå°æœåŠ¡å™¨ã€‚å¸¸å¸¸ç”¨nginxæ¥ä½œåå‘ä»£ç†ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy82MTUyNTk1LWYxZTdlZTA5MDdiZjJhMTUucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXAlN0NpbWFnZVZpZXcyLzIvdy8xMjQw" alt="image" loading="lazy"></figure>
<h2 id="3è´Ÿè½½å‡è¡¡çš„å®ç°">3.è´Ÿè½½å‡è¡¡çš„å®ç°</h2>
<blockquote>
<ul>
<li>è½®è¯¢</li>
<li>æƒé‡</li>
<li>ip_hash</li>
<li>rté€Ÿåº¦</li>
<li>url_hash</li>
</ul>
</blockquote>
<pre><code class="language-shell">// ä¸€èˆ¬é»˜è®¤é‡‡ç”¨çš„è½®è¯¢æ–¹å¼;ä½†æ˜¯ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºip_hash

// 1.è½®è¯¢ï¼ˆé»˜è®¤ï¼‰æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚

// 2.weight æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚
upstream bakend {  
  server 192.168.0.14 weight=10;  
  server 192.168.0.15 weight=10;  
}

// 3.ip_hash  æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚
upstream bakend {  
  ip_hash;  
  server 192.168.0.14:88;  
  server 192.168.0.15:80;  
}

// 4.fair æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚
upstream backend {  
  fair;  
  server server1;  
  server server2;  	  
}

// 5. url_hash æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚
upstream backend {  
  server squid1:3128;  
  server squid2:3128;  
  hash $request_uri;  
  hash_method crc32;  
}
</code></pre>
<h2 id="4nginxé…ç½®nginxconf">4.Nginxé…ç½®(nginx.conf)</h2>
<h3 id="1-åŸºæœ¬æ ¼å¼">1. åŸºæœ¬æ ¼å¼</h3>
<pre><code>	main                                # å…¨å±€é…ç½® mainåªæ˜¯ä¸€ä¸ªä»£è¡¨çš„æ„æ€;å†™çš„æ—¶å€™ä¸ç”¨å¾€ä¸Šå†™main
	 
	events {                            # nginxå·¥ä½œæ¨¡å¼é…ç½®

	}
	http {                              # httpè®¾ç½®
	    server {                        # æœåŠ¡å™¨ä¸»æœºé…ç½®
	        listen       80;
            server_name  localhost;
	        ....
	        location /static{                    # è·¯ç”±é…ç½®
	           alias  /opt/img;
	           index  404.html
             }
	 
	        location path {
	            ....
	        }
	 
	        location otherpath {
	            ....
	        }
	    }	 
	    upstream name {                    # è´Ÿè½½å‡è¡¡é…ç½®
	        ....
	    }
	}
	https{} httpsé…ç½®
</code></pre>
<h3 id="2-åŒºåŸŸä½œç”¨">2. åŒºåŸŸä½œç”¨</h3>
<pre><code>mainï¼šç”¨äºè¿›è¡Œnginxå…¨å±€ä¿¡æ¯çš„é…ç½®
eventsï¼šç”¨äºnginxå·¥ä½œæ¨¡å¼çš„é…ç½®
httpï¼šç”¨äºè¿›è¡Œhttpåè®®ä¿¡æ¯çš„ä¸€äº›é…ç½®
serverï¼šç”¨äºè¿›è¡ŒæœåŠ¡å™¨è®¿é—®ä¿¡æ¯çš„é…ç½®
locationï¼šç”¨äºè¿›è¡Œè®¿é—®è·¯ç”±çš„é…ç½®
upstreamï¼šç”¨äºè¿›è¡Œè´Ÿè½½å‡è¡¡çš„é…ç½®
</code></pre>
<h3 id="3-mainåŒºåŸŸ">3. MainåŒºåŸŸ</h3>
<pre><code class="language-properties"># user nobody nobody;  // å½“å‰æ“ä½œçš„ç”¨æˆ·
worker_processes 2;  // å·¥ä½œçº¿ç¨‹=å½“å‰CPUçš„core
# error_log logs/error.log
# error_log logs/error.log notice
# error_log logs/error.log info
# pid logs/nginx.pid
worker_rlimit_nofile 1024;
</code></pre>
<h3 id="4-events-æ¨¡å—">4. events æ¨¡å—</h3>
<pre><code>event {
    worker_connections 1024;
    multi_accept on;
    use epoll;
}
worker_connections æŒ‡å®šæœ€å¤§å¯ä»¥åŒæ—¶æ¥æ”¶çš„è¿æ¥æ•°é‡,æœ€å¤§è¿æ¥æ•° = worker_connections*worker_processes
multi_accept é…ç½®æŒ‡å®šnginxåœ¨æ”¶åˆ°ä¸€ä¸ªæ–°è¿æ¥é€šçŸ¥åå°½å¯èƒ½å¤šçš„æ¥å—æ›´å¤šçš„è¿æ¥
use epoll é…ç½®æŒ‡å®šäº†çº¿ç¨‹è½®è¯¢çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯linux2.6+ï¼Œä½¿ç”¨epollï¼Œå¦‚æœæ˜¯BSDå¦‚Macè¯·ä½¿ç”¨Kqueue
</code></pre>
<h3 id="5-http-serveråŒºåŸŸ">5. http - serveråŒºåŸŸ</h3>
<h4 id="1-http-é…ç½®">1. http é…ç½®</h4>
<p>é…ç½®ä¸€äº›åª’ä½“ç±»å‹, å·²ç»å‹ç¼©æ–¹å¼ , å’Œè¶…æ—¶ , æ—¥å¿—è®°å½•</p>
<h4 id="2-é™æ€èµ„æºä»£ç†">2. é™æ€èµ„æºä»£ç†</h4>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ , æˆ‘ä»¬æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªå›¾ç‰‡åº“ , æ¯”å¦‚åœ¨ <code>opt/static/img</code> ç›®å½•ä¸‹é¢ ,æˆ‘ä»¬è¦æ±‚æˆ‘ä»¬è®¿é—®<code>http://www.xxx.com/static/a.png</code> å¯ä»¥ä»£ç†åˆ°æˆ‘ä»¬ <code>opt/static/img/a.png</code> , å¯ä»¥è¿™ä¹ˆé…ç½®</p>
<pre><code class="language-java">server {
    listen       80;  // ç›‘å¬çš„ç«¯å£ ,æµè§ˆå™¨åœ¨æœªæŒ‡å®šç«¯å£çš„å‰æä¸‹, é»˜è®¤è®¿é—®çš„æ˜¯80ç«¯å£
    server_name  localhost; //æŒ‡å®šipåœ°å€æˆ–è€…åŸŸåï¼Œå¤šä¸ªé…ç½®ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš” manage.tyut.com

    #charset koi8-r;

    #access_log  logs/host.access.log  main;

    location /static {
      alias opt/static/img;
      index error.png;
    }
}
</code></pre>
<h4 id="3-é…ç½®ä¸ªåˆ«404-é‡å®šå‘">3. é…ç½®ä¸ªåˆ«404 é‡å®šå‘</h4>
<p>è¿˜æ˜¯ä¸Šè¯‰çš„é‚£ä¸ªä»£ç† .æˆ‘ä»¬å¯ä»¥å°†å®ƒè®¿é—® <code>http://www.xxx.com/static</code> ä¸‹é¢æ‰€æœ‰ä¸ºæ‰¾åˆ°çš„èµ„æº,é‡å®šå‘åˆ° <code>opt/static/img/404.html</code> ,</p>
<pre><code class="language-java">location /static {
  alias /opt/test/img/;
  index error.png;
  error_page 404 404.html;
}
</code></pre>
<h4 id="4-é…ç½®å…¨å±€-404">4. é…ç½®å…¨å±€ 404</h4>
<pre><code class="language-shell">error_page  500 502 503 504  /50x.html;
location = /50x.html {
    root   html;
}
</code></pre>
<p>è¿™ä¸ªæ„æ€å°±æ˜¯ , æˆ‘è®¿é—®çš„é”™è¯¯ç å¦‚æœæ˜¯ <code>500 502 503 504</code> ä¹‹ç±»çš„, ä¼šå°†è¯·æ±‚è½¬å‘åˆ° <code>/50x.html</code>ä¸­ , ç„¶åå»å½“å‰ç›®å½•ä¸‹çš„ nginx/htmlæ–‡ä»¶ä¸­æ‰¾ åˆ° <code>50x.html</code>,  å°±æ˜¯è¿™ä¹ˆç©äº†</p>
<pre><code class="language-java">[xxx html]# pwd
/opt/nginx/nginx-1.14.2/html
[xxx html]# ls
50x.html  index.html
</code></pre>
<p>æ¯”å¦‚ 404 å“‡, ä½ ä¹Ÿå¯ä»¥è¿™ä¹ˆé…ç½®</p>
<pre><code class="language-java">error_page  404  /404.html;
location = /404.html {
    root   html;
}
</code></pre>
<p>ç„¶å <code>/opt/nginx/nginx-1.14.2/html</code> ä¸­æ–°å»ºä¸€ä¸ª 404.html æ–‡ä»¶</p>
<h4 id="5-æ­£åˆ™åŒ¹é…">5. æ­£åˆ™åŒ¹é…</h4>
<p>æ­£åˆ™è¡¨è¾¾å¼ä¸­ <code>^</code>è¡¨ç¤ºä»¥ä»€ä¹ˆå¼€å¤´, <code>$</code> ä»¥ä»€ä¹ˆç»“æŸ , <code>*</code>ä»£è¡¨ä»»æ„å­—ç¬¦  <code>~</code> åŒºåˆ†å¤§å°å†™åŒ¹é…</p>
<p><code>~*</code> ä¸åŒºåˆ†å¤§å°å†™åŒ¹é…</p>
<p><code>location ~*.(gif|jpg|jpeg)$</code> åŒ¹é…ä»¥.gifã€.jpg æˆ– .jpeg ç»“å°¾çš„è¯·æ±‚</p>
<pre><code>location ^~/static {
      alias /opt/test/img;
      index index.html;
}
</code></pre>
<h4 id="6-è¯·æ±‚è½¬å‘">6. è¯·æ±‚è½¬å‘</h4>
<pre><code>location / {
    proxy_pass http://www.xxx.com;
    proxy_connect_timeout 1000;
    proxy_read_timeout 1000;
}
</code></pre>
<p>â€‹<br>
upstream www.xxx.com{<br>
server 127.0.0.1:8050 weight=2;<br>
server 127.0.0.1:8060 weight=1;<br>
}</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1%E6%A6%82%E5%BF%B5">1.æ¦‚å¿µ:</a></li>
<li><a href="#2-%E5%AF%B9%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%80%8C%E8%A8%80%E7%9A%84%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">2. å¯¹ä»£ç†æœåŠ¡å™¨è€Œè¨€çš„æ­£å‘ä»£ç†ä¸åå‘ä»£ç†</a><br>
*
<ul>
<li><a href="#1%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86">1.æ­£å‘ä»£ç†</a></li>
<li><a href="#2%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">2.åå‘ä»£ç†</a></li>
</ul>
</li>
<li><a href="#3%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%AE%9E%E7%8E%B0">3.è´Ÿè½½å‡è¡¡çš„å®ç°</a></li>
<li><a href="#4nginx%E9%85%8D%E7%BD%AEnginxconf">4.Nginxé…ç½®(nginx.conf)</a>
<ul>
<li><a href="#1-%E5%9F%BA%E6%9C%AC%E6%A0%BC%E5%BC%8F">1. åŸºæœ¬æ ¼å¼</a></li>
<li><a href="#2-%E5%8C%BA%E5%9F%9F%E4%BD%9C%E7%94%A8">2. åŒºåŸŸä½œç”¨</a></li>
<li><a href="#3-main%E5%8C%BA%E5%9F%9F">3. MainåŒºåŸŸ</a></li>
<li><a href="#4-events-%E6%A8%A1%E5%9D%97">4. events æ¨¡å—</a></li>
<li><a href="#5-http-server%E5%8C%BA%E5%9F%9F">5. http - serveråŒºåŸŸ</a>
<ul>
<li><a href="#1-http-%E9%85%8D%E7%BD%AE">1. http é…ç½®</a></li>
<li><a href="#2-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BB%A3%E7%90%86">2. é™æ€èµ„æºä»£ç†</a></li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E4%B8%AA%E5%88%AB404-%E9%87%8D%E5%AE%9A%E5%90%91">3. é…ç½®ä¸ªåˆ«404 é‡å®šå‘</a></li>
<li><a href="#4-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80-404">4. é…ç½®å…¨å±€ 404</a></li>
<li><a href="#5-%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D">5. æ­£åˆ™åŒ¹é…</a></li>
<li><a href="#6-%E8%AF%B7%E6%B1%82%E8%BD%AC%E5%8F%91">6. è¯·æ±‚è½¬å‘</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>