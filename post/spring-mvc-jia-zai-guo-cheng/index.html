<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>Spring-MVC  æºç åˆ†æ | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/spring-mvc-jia-zai-guo-cheng/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223360682" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>Spring-MVC  æºç åˆ†æ</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-11-15</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/spring-mvc-jia-zai-guo-cheng/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/30KjDURvPf/"
								class="tag">spring</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">2384å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">11 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<blockquote>
<p>â€‹	æˆ‘ä»¬éƒ½çŸ¥é“Spring-Mvcçš„æ­å»ºç¯å¢ƒçš„ç¯èŠ‚, å°±æ˜¯æ³¨å†Œä¸€ä¸ª<code>DispatcherServlet</code> çš„Servlet , ç„¶åservlet-mappingæ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ , æ­¤æ—¶æˆ‘ä»¬æ˜¯å¦å…ˆåº”è¯¥å­¦ä¹ ä¸€ä¸‹Servletå‘¢ ?  å­¦ä¹ ç©Servlet å†çœ‹çœ‹å°±å¾ˆç®€å•äº† ........</p>
</blockquote>
<h2 id="1-servletçš„ç”Ÿå‘½å‘¨æœŸ">1. Servletçš„ç”Ÿå‘½å‘¨æœŸ</h2>
<h3 id="1-ç®€å•çš„demo">1. ç®€å•çš„Demo</h3>
<p>è¿™æ˜¯æˆ‘çš„web.xmlé…ç½®æ–‡ä»¶</p>
<pre><code class="language-xml">  &lt;servlet&gt;
    &lt;servlet-name&gt;myServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.example.web.MyServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath*:springMVC.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;myServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/my&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
</code></pre>
<p>è¿™æ˜¯æˆ‘çš„Servletç±»</p>
<pre><code class="language-java">public class MyServlet extends HttpServlet {
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        System.out.println(&quot;service&quot;);
    }

    @Override
    public void destroy() {
        System.out.println(&quot;destroy&quot;);
    }
    @Override
    public void init(ServletConfig config) throws ServletException {
        String contextConfigLocation = config.getInitParameter(&quot;contextConfigLocation&quot;);
        System.out.println(&quot;InitParameter : &quot; + contextConfigLocation);
        System.out.println(&quot;init&quot;);
    }
}
</code></pre>
<p>ç¬¬ä¸€æ¬¡è¯·æ±‚è¾“å‡ºçš„ç»“æœ :</p>
<pre><code class="language-java">InitParameter : classpath*:springMVC.xml
init
service
</code></pre>
<p>ç¬¬äºŒæ¬¡è¯·æ±‚è¾“å‡ºçš„ç»“æœ :</p>
<pre><code class="language-java">service
</code></pre>
<p>ç¬¬ä¸‰æ¬¡  ..  ä»¥åå‘¢ ?</p>
<pre><code class="language-java">service
</code></pre>
<p>å½“æˆ‘ä»¬æŠŠTomcatæœåŠ¡å™¨å…³é—­å‘¢ ?</p>
<pre><code class="language-java">destroy
</code></pre>
<h3 id="2-é€šè¿‡demoæˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆ">2. é€šè¿‡Demo,æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆ ?</h3>
<h4 id="1-init-æ–¹æ³•">1. init(..) æ–¹æ³•</h4>
<p>ä»–åªä¼šæ‰§è¡Œä¸€æ¬¡ , å°±æ˜¯å½“ç¬¬ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾æˆ–è€…Servletå®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œ .</p>
<p><strong>è¡¥å…… :</strong> <code>&lt;load-on-startup&gt;0&lt;/load-on-startup&gt;</code> è¿™ä¸ªæ ‡ç­¾æ§åˆ¶ç€ServletåŠ è½½çš„æ—¶æœº,é»˜è®¤æ˜¯-1 ,å°±æ˜¯éœ€è¦ç”¨æˆ·å»è®¿é—®æ‰ä¼šåˆå§‹åŒ– , å½“å¤§äºç­‰äº0æ—¶ ,Servletå®¹å™¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šå¸®åŠ©æˆ‘ä»¬åˆå§‹åŒ–</p>
<h4 id="2-service-æ–¹æ³•">2. service() æ–¹æ³•</h4>
<p>ä»–ä¼šåœ¨æ¯æ¬¡è¯·æ±‚åˆ°è¾¾çš„æ—¶å€™éƒ½ä¼šå»æ‰§è¡Œ .</p>
<h4 id="3-destroy-æ–¹æ³•">3. destroy() æ–¹æ³•</h4>
<p>ä»–ä¼šåœ¨Servletå®¹å™¨å…³é—­çš„æ—¶å€™æ‰§è¡Œ ,ä¹Ÿæ˜¯åªä¼šæ‰§è¡Œä¸€æ¬¡</p>
<h4 id="4-æ€»ç»“">4. æ€»ç»“</h4>
<p>é€šè¿‡ä¸Šè¯‰æˆ‘ä»¬çŸ¥é“äº†Servletçš„ç”Ÿå‘½å‘¨æœŸ ,é‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å§ , çœ‹çœ‹<code>DispatcherServlet</code>æ˜¯å¦‚ä½•æ‰§è¡Œçš„</p>
<h2 id="2-dispatcherservlet-çš„æ ¸å¿ƒ">2. DispatcherServlet çš„æ ¸å¿ƒ</h2>
<p>é…ç½®é¡¹ web.xml çš„</p>
<pre><code class="language-xml">  &lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;classpath*:springMVC.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
// æ²¡æœ‰é…ç½®åˆå§‹åŒ–å¯åŠ¨æ˜¯ä¸ºäº†æ–¹ä¾¿Debug åæœŸ
</code></pre>
<p>springMVC.xml é…ç½®</p>
<pre><code class="language-xml">    &lt;!--å¼€å¯æ³¨è§£æ‰«æ--&gt;
    &lt;context:component-scan base-package=&quot;com.example.web&quot;&gt;
        &lt;!--åªæ‰«æcontrolleræ³¨è§£ä¸‹çš„å¯¹è±¡--&gt;
        &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
    &lt;/context:component-scan&gt;


    &lt;!--è§†å›¾è§£æå™¨--&gt;
    &lt;bean id=&quot;internalResourceViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;!--å¼€å¯MVCæ³¨è§£é©±åŠ¨--&gt;
    &lt;mvc:annotation-driven &gt;&lt;/mvc:annotation-driven&gt;
</code></pre>
<p>Controller é…ç½®</p>
<pre><code class="language-java">@Controller
public class TestController {

    @GetMapping(&quot;/get&quot;)
    public String get(){
        return &quot;hello&quot;;
    }
}
</code></pre>
<h3 id="1-è®¤è¯†dispatcherservlet">1. è®¤è¯†DispatcherServlet</h3>
<figure data-type="image" tabindex="1"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/7f83b9b8-07eb-417d-adbb-636f456ad513.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹è“è‰²éƒ¨åˆ† , ä»–ç»§æ‰¿è‡ª <code>FrameworkServlet</code> , ç„¶åFrameworkServletç»§æ‰¿äº†<code>HttpServletBean</code>,ç„¶åå°±åˆ°äº†æˆ‘ä»¬å¸¸è§çš„ <code>HttpServlet</code>å’Œ<code>GenericServlet</code> .</p>
<h3 id="1-init-æ–¹æ³•å¯åŠ¨è¿‡ç¨‹">1. init() æ–¹æ³•å¯åŠ¨è¿‡ç¨‹</h3>
<p>é¦–å…ˆæˆ‘ä»¬å»è®¿é—®<code>http://localhost:8080/get</code></p>
<p>é¦–å…ˆç”±äº <code>HttpServletBean</code>é‡å†™äº† <code>init()</code>æ–¹æ³• , ç¬¬ä¸€æ­¥å°±æ˜¯è·å–æˆ‘ä»¬<code>&lt;init-param&gt;</code>ä¼ å…¥çš„é…ç½®ä¿¡æ¯ .</p>
<figure data-type="image" tabindex="2"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/cbf8dea6-aa18-4232-8e4c-c0e6c3c323b0.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>ç¬¬äºŒæ­¥ : æ‰§è¡Œ init()ä¸­çš„ <code>initServletBean()</code> æ–¹æ³• ,</p>
<figure data-type="image" tabindex="3"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/7f038918-9c33-441b-96b7-1f410faf59f4.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>æ‰€ä»¥ initæ‰§è¡Œå®Œæ¯•ä»¥å ä»¥åŠå°† ApplicationContext æ³¨å†ŒæˆåŠŸäº†  , æ‰€æœ‰çš„å…ƒä¿¡æ¯éƒ½åœ¨é‡Œé¢</p>
<h3 id="2-serviceæ–¹æ³•-æ‰§è¡Œæµç¨‹">2. service()æ–¹æ³• æ‰§è¡Œæµç¨‹</h3>
<h4 id="1-ç¬¬ä¸€æ­¥-æ‰§è¡Œservice-æ–¹æ³•">1. ç¬¬ä¸€æ­¥  æ‰§è¡Œservice() æ–¹æ³•</h4>
<p>æ–¹æ³•çœ‹ä¼¼å¾ˆç®€å• ,å®é™…ä¸ŠåŒ…å«äº†å…¨éƒ¨æµç¨‹ , å°±æ˜¯è¿›å»<code>service()</code> æ–¹æ³•</p>
<figure data-type="image" tabindex="4"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/021f91dd-0154-4b5f-ab69-3feb26322c3d.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="2-ç¬¬äºŒæ­¥-processrequestæ–¹æ³•">2. ç¬¬äºŒæ­¥  processRequest()æ–¹æ³•</h4>
<p>å°±æ˜¯ <code>processRequest()</code> æ–¹æ³•ä¸Š , æˆ‘æµ‹è¯•æœ‰BUGä¸èƒ½ç›´æ¥è¿›å»è¿™ä¸ªæ–¹æ³• , ä¹Ÿä¸æ‡‚ä¸ºå•¥,æˆ‘ä»¬å°±å…ˆçœ‹å§,å…¶ä¸»è¦</p>
<p>é¦–å…ˆå°±æ˜¯è¿™ä¸ª<code>initContextHolders()</code> æ–¹æ³•, æˆ‘ä»¬å»çœ‹æºç ,å‘ç°ä»–çš„æ„æ€å°±æ˜¯ : <strong>å°†LocaleContextå®ä¾‹ä¸å½“å‰çº¿ç¨‹ç›¸å…³è”</strong>,ç±»ä¼¼äºä¸€ç§ç¯å¢ƒ,å°±æ˜¯ä½ åœ¨ä¸­å›½,ä¸­å›½å°±æ˜¯ä¸€ä¸ªç¯å¢ƒ,è¿™é‡Œå¯ä»¥å–åˆ° ä½ æ‰€æœ‰çš„æœ¬åœ°ä¿¡æ¯ ,å¯ä»¥çœ‹çœ‹javaçš„<code>Local</code>ç±»</p>
<p>å…¶æ¬¡å°±æ˜¯è°ƒç”¨ doService() æ–¹æ³• ,ç”±äºä»–æ˜¯æŠ½è±¡ç±»å¹¶æœªå®ç° æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾å­ç±» <code>DispatcherServlet</code>ä»–çš„å®ç°æ–¹æ³•</p>
<figure data-type="image" tabindex="5"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/1fc4501b-3405-4362-92ee-74af97030cc9.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="3-ç¬¬ä¸‰æ­¥-è°ƒç”¨doservice-æ–¹æ³•">3. ç¬¬ä¸‰æ­¥ è°ƒç”¨doService() æ–¹æ³•</h4>
<p>ä¸»è§’å¼€å§‹ <code>DispatcherServlet#doService()</code> ,</p>
<p>é¦–å…ˆå°±æ˜¯å°†æˆ‘ä»¬çš„ ApplicationContext æ³¨å†Œåˆ° requestä¸­ ,æ–¹ä¾¿ä»¥åæ‹¿åˆ°</p>
<p>ç„¶åä»–ä½¿ç”¨äº†ä¸€ç§é€‚é…å™¨æ¨¡å¼ , æ‰§è¡Œäº† doDispatch() æ–¹æ³•</p>
<figure data-type="image" tabindex="6"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/e47e6440-862a-44d5-9c57-f07bc2c5d87e.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/04bf6891-1c3b-48e3-8277-8300571be99a.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="4-ç¬¬å››æ­¥-è°ƒç”¨dodispatchæ–¹æ³•">4. ç¬¬å››æ­¥  è°ƒç”¨doDispatch()æ–¹æ³•</h4>
<p>å¤§è‡´æµç¨‹å°±æ˜¯é€šè¿‡ <code>handlerMappings</code>è·å–<code>HandlerExecutionChain</code>ä¸­çš„<code>handler</code>å¯¹è±¡, ç„¶åæ‹¿<code>handler</code>å¯¹è±¡å»æ‰¾åˆ°ä»–åŒ¹é…çš„<code>HandlerAdapter</code>å¯¹è±¡ ,</p>
<p>è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å°±æ˜¯<code>mappedHandler.applyPreHandle(processedRequest, response)</code>è¿™ä¸ªæ–¹æ³•çš„æ‰§è¡Œå…¶å®å°±æ˜¯æ‰§è¡Œæ‹¦æˆªå™¨<code>HandlerInterceptor</code>, å¦‚æœæ‹¦æˆªäº†ç›´æ¥å°±è¿”å›äº†, æ²¡æœ‰æ‹¦æˆªç»§ç»­è°ƒç”¨<code>HandlerAdapter</code>çš„<code>handle()</code>æ–¹æ³•å»åšåç»­æ“ä½œ.....</p>
<p><code>HandlerMapping</code> æ˜¯ä»€ä¹ˆ ?</p>
<blockquote>
<p>â€‹	Interface to be implemented by objects that define a mapping between requests and handler objects.</p>
<p>å®šä¹‰è¯·æ±‚å’Œå¤„ç†ç¨‹åºå¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³», ä»–å°±ä¸€ä¸ªæ–¹æ³• <code>HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception;</code> è·å– HandlerExecutionChain  ,</p>
</blockquote>
<p><code>HandlerExecutionChain</code> æ˜¯ä»€ä¹ˆ ?</p>
<blockquote>
<p>â€‹	Handler execution chain, consisting of handler object and any handler interceptors. Returned by HandlerMapping's HandlerMapping.getHandler method.</p>
<p>åŒ…å«äº† handlerå¯¹è±¡å’Œæ‹¦æˆªå™¨ , å¯ä»¥é€šè¿‡ <code>HandlerMapping</code>çš„ <code>getHandler ()</code>æ–¹æ³•è·å–</p>
</blockquote>
<p><code>handler</code>æ˜¯ä»€ä¹ˆ ?</p>
<blockquote>
<p>â€‹	HandlerMethod å¯¹è±¡ ,å°±æ˜¯æˆ‘ä»¬çš„Controllerå¯¹è±¡å’Œä»–çš„æ–¹æ³•ç»„æˆçš„ä¸€ä¸ªå¯¹è±¡ , å…ƒä¿¡æ¯</p>
</blockquote>
<p><code>HandlerAdapter</code>æ˜¯ä»€ä¹ˆ ?</p>
<blockquote>
<p>â€‹	MVC framework SPI, allowing parameterization of the core MVC workflow.</p>
<p>MVCæ¡†æ¶SPIï¼Œå…è®¸å‚æ•°åŒ–çš„æ ¸å¿ƒMVCå·¥ä½œæµã€‚ ä¸»è¦æ–¹æ³• <code>ModelAndView handle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception;</code>  æ ¹æ®æ–¹æ³•æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ ä»–çš„ä½œç”¨æ˜¯ä»€ä¹ˆ ,</p>
</blockquote>
<p>æ‰€ä»¥ä¸‰è€…çš„å…³ç³»æ˜¯<code>HandlerMapping</code> æ˜¯ä¸€ä¸ªèœå• , æ¯ä¸ªè¯·æ±‚è¿›æ¥ä¼šæ ¹æ®è¯·æ±‚,å¯ä»¥æ‰¾åˆ°å®ƒå¯¹åº”çš„<code>HandlerExecutionChain</code>è¿›è€Œæ‹¿åˆ°<code>HandlerMethod</code>å¯¹è±¡  ,</p>
<p>å½“æˆ‘ä»¬æ‹¿åˆ° <code>HandlerMethod</code> å¯¹è±¡ , æ­¤æ—¶åšçš„ä¸æ˜¯ç®€å•çš„è°ƒç”¨ ,Method.invoke() å°±å®Œäº† .... ,ä»–ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼ ,æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ <code>HandlerMethod</code> å¯¹è±¡æ‰¾åˆ°ä»–ä½•æ—¶çš„é€‚é…å™¨ <code>HandlerAdapter</code> ,ç„¶åé€‚é…å™¨æ‰§è¡Œä»–çš„ handle æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è¿”å› <code>ModelAndVive</code> .</p>
<figure data-type="image" tabindex="8"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/4f0c6c39-ab9d-4d6d-b319-380587b1a5e1.png?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="5-ç¬¬äº”æ­¥-handler-æ–¹æ³•">5. ç¬¬äº”æ­¥  handler() æ–¹æ³•</h4>
<p>æˆ‘ä»¬è¿›å…¥<code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler())</code> æ–¹æ³•ç»§ç»­æ‰§è¡Œ</p>
<figure data-type="image" tabindex="9"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/8f4d5c3d-1259-476c-acc6-55baf413a537.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦çœ‹çœ‹ä»€ä¹ˆæ˜¯ <code>HandlerMethod</code> ,å®˜æ–¹ç»™çš„æ„æ€æ˜¯ : <strong>æ­¤å¯¹è±¡ç”±æ–¹æ³•å’Œbeanç»„æˆçš„å¤„ç†ç¨‹åºæ–¹æ³•çš„ä¿¡æ¯ ,æä¾›å¯¹æ–¹æ³•å‚æ•°ã€æ–¹æ³•è¿”å›å€¼ã€æ–¹æ³•æ³¨é‡Šç­‰çš„æ–¹ä¾¿è®¿é—®ã€‚å°±æ˜¯æˆ‘ä»¬çš„TestControllerå¯¹è±¡å’Œgetæ–¹æ³• å°è£…äº†èµ·æ¥,ç±»ä¼¼äºå…ƒä¿¡æ¯</strong>.</p>
<h4 id="6-ç¬¬å…­æ­¥-ç»§ç»­è·Ÿè¿›">6. ç¬¬å…­æ­¥ ç»§ç»­è·Ÿè¿›</h4>
<p>æ‰§è¡Œ <code>handleInternal(request, response, (HandlerMethod) handler)</code>æ–¹æ³• ,</p>
<figure data-type="image" tabindex="10"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/1d37604c-c91d-47c3-9d6e-cc1293d633ca.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="7-ç¬¬ä¸ƒæ­¥-ç»§ç»­è·Ÿè¿›">7. ç¬¬ä¸ƒæ­¥  ç»§ç»­è·Ÿè¿›</h4>
<p>æ‰§è¡Œ <code>mav = invokeHandlerMethod(request, response, handlerMethod);</code> æ–¹æ³•æˆ‘ä»¬ç»§ç»­è·Ÿè¿›</p>
<p>ä»£ç å¤ªé•¿ æˆ‘å°±æˆªå–ä¸€éƒ¨åˆ† :é€šè¿‡ HandlerMethodè°ƒç”¨ è¿”å› ModelAndVive</p>
<figure data-type="image" tabindex="11"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/024062cd-ae6f-4aa8-a6bd-940035d17e05.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p><code>invocableMethod.invokeAndHandle(webRequest, mavContainer);</code>æ–¹æ³•æ‰§è¡Œ :</p>
<figure data-type="image" tabindex="12"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/3fdcb64c-021d-49c2-8fff-400491e04675.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p><code>Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</code> æ–¹æ³•æ‰§è¡Œ :</p>
<figure data-type="image" tabindex="13"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/9f391b0d-d375-4eb5-b220-438256a43570.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<h4 id="8-ç¬¬å…«æ­¥-ç»ˆäºæ‰§è¡ŒçœŸæ­£çš„é€»è¾‘äº†">8. ç¬¬å…«æ­¥  ç»ˆäºæ‰§è¡ŒçœŸæ­£çš„é€»è¾‘äº†</h4>
<p><code>Object returnValue = doInvoke(args);</code> ç»ˆäºå®Œæˆäº† ............. æ‰§è¡Œäº†æˆ‘ä»¬çš„å†™çš„æ–¹æ³•</p>
<figure data-type="image" tabindex="14"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/02cc31c0-67f8-4b86-86d2-935ed11f3ec0.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>æ­¤æ—¶å°±å·²ç» è®²æˆ‘ä»¬å†™çš„:</p>
<pre><code class="language-java">    @GetMapping(&quot;/get&quot;)
    public String get(){
        return &quot;hello&quot;;
    }
</code></pre>
<p>è¿”å›äº† , æˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆ :  ç¡®å®ä½¿æˆ‘ä»¬çš„è¿”å›çš„ç»“æœ :</p>
<figure data-type="image" tabindex="15"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/7c9cb801-406a-4496-96e7-ab3f20f05d5b.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>æ­¤åçš„è¿‡ç¨‹å°±æ˜¯ä¸€ä¸ª é€†å‘è¿‡ç¨‹å¾€å›è¿”äº† ....</p>
<h4 id="9-ç¬¬ä¹æ­¥-æ ¹æ®è¿”å›çš„vive-æ¸²æŸ“è§†å›¾">9. ç¬¬ä¹æ­¥  æ ¹æ®è¿”å›çš„vive æ¸²æŸ“è§†å›¾</h4>
<p>åˆ°äº†æˆ‘ä»¬çš„ <code>DispatcherServlet</code> çš„<code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code> è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•äº† ............................... ç„¶åå¼€å§‹æ¸²æŸ“  ... ,æ‰§è¡Œçš„æ˜¯ <code>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</code></p>
<figure data-type="image" tabindex="16"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/edf083c2-7800-44ae-ace0-7486308b623d.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>æ¸²æŸ“è§†å›¾ , è°ƒç”¨å…¶ä»–æ–¹æ³• ç»§ç»­è¿½</p>
<figure data-type="image" tabindex="17"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/4f424a62-dadf-410d-bbc6-26893210a830.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>ç»§ç»­è¿½ :</p>
<figure data-type="image" tabindex="18"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/84e88eeb-3fc5-4bfc-8cc4-34829b09b1d2.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>å°±åˆ°äº†æˆ‘ä»¬é…ç½®çš„è§†å›¾è§£æå™¨ , æ¸²æŸ“å®Œæˆ .</p>
<h4 id="10-ç¬¬åæ­¥-ç»“æŸprocessrequest-æ–¹æ³•å‘å¸ƒäº‹ä»¶">10. ç¬¬åæ­¥  ç»“æŸprocessRequest() æ–¹æ³•,å‘å¸ƒäº‹ä»¶</h4>
<p>ç„¶åæœ€åå°±åˆ°äº†processRequest() æ–¹æ³•çš„ç»ˆç‚¹ ,å‘å¸ƒäº†ä¸€ä¸ªäº‹ä»¶ , å°±å®Œæˆäº†</p>
<figure data-type="image" tabindex="19"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-11-15/6916ae0a-41b6-4f6c-bb7e-b4752d66874b.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>è¿™ä¸ªæœ€åçš„äº‹ä»¶å‘å¸ƒæœ‰ç‚¹éªšå“‡ ,å‘å¸ƒä»¥åå¹¶æ— åµç”¨ ,springæ¡†æ¶ å¹¶æ²¡æœ‰ç›‘å¬è¯¥äº‹ä»¶ .... ,æ­¤æ—¶éœ€è¦æˆ‘ä»¬è‡ªå·±å»ç›‘å¬ , æ‰€ä»¥ä¸‹é¢æˆ‘è‡ªå·±å»å®ç°äº†ä¸€ä¸ªç®€å•çš„ç›‘å¬æµç¨‹ ....</p>
<h3 id="3-destroy-æ–¹æ³•-2">3. destroy() æ–¹æ³•</h3>
<pre><code class="language-java">	@Override
	public void destroy() {
		getServletContext().log(&quot;Destroying Spring FrameworkServlet '&quot; + getServletName() + &quot;'&quot;);
		// Only call close() on WebApplicationContext if locally managed...
		if (this.webApplicationContext instanceof ConfigurableApplicationContext &amp;&amp; !this.webApplicationContextInjected) {
			((ConfigurableApplicationContext) this.webApplicationContext).close();
		}
	}
</code></pre>
<blockquote>
<p>â€‹	Close the WebApplicationContext of this servlet.</p>
</blockquote>
<p>å°±æ˜¯å°† ApplicationContextå…³é—­äº† ..............</p>
<h2 id="3-servletrequesthandledevent-ä½¿ç”¨">3. ServletRequestHandledEvent ä½¿ç”¨</h2>
<p>å†™ä¸€ä¸ª Listener å®ç°è‡ª ApplicationListener ,</p>
<pre><code class="language-java">@Component
public class ServletRequestHandledEventListener implements ApplicationListener&lt;ServletRequestHandledEvent&gt; {

    /**
     * Handle an application event.
     *
     * @param event the event to respond to
     */
    @Override
    public void onApplicationEvent(ServletRequestHandledEvent event) {

        System.out.println(Thread.currentThread().getName()+&quot; æ”¶åˆ°äº‹ä»¶ : &quot; + event);
    }
}
</code></pre>
<p>é…ç½®ä¸€ä¸ªspringçš„ä¸Šä¸‹æ–‡é…ç½® applicationContext.xml</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;


    &lt;!--å¼€å¯æ‰«æ--&gt;
    &lt;context:component-scan base-package=&quot;com.example.listener&quot;&gt;&lt;/context:component-scan&gt;

&lt;/beans&gt;
</code></pre>
<p>æ³¨å…¥åˆ° ç¯å¢ƒä¸­web.xmlä¸­ , ç›‘å¬å™¨å®ç°äº†ServletContextListener,æ‰€ä»¥å½“å®¹å™¨å¯åŠ¨ä¼šè‡ªåŠ¨åŠ è½½</p>
<pre><code class="language-xml">  &lt;!--ç›‘å¬å™¨ , åŠ è½½contextConfigLocationå±æ€§çš„é…ç½®æ–‡ä»¶--&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;!--è®¾æ–½springé…ç½®æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„,ä¸èƒ½æ”¹åå­—--&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
  &lt;/context-param&gt;
</code></pre>
<p>æ‰€ä»¥è¿è¡Œç»“æœ ,å½“æˆ‘ä»¬è®¿é—®  <code>http://localhost:8080/get</code> é“¾æ¥æ—¶ ..</p>
<pre><code class="language-java">http-nio-8080-exec-6 æ”¶åˆ°äº‹ä»¶ : ServletRequestHandledEvent: url=[/get]; client=[0:0:0:0:0:0:0:1]; method=[GET]; servlet=[dispatcherServlet]; session=[B2595F9D400922D5A4EC7FA55162349C]; user=[null]; time=[217ms]; status=[OK]
http-nio-8080-exec-9 æ”¶åˆ°äº‹ä»¶ : ServletRequestHandledEvent: url=[/get]; client=[0:0:0:0:0:0:0:1]; method=[GET]; servlet=[dispatcherServlet]; session=[B2595F9D400922D5A4EC7FA55162349C]; user=[null]; time=[4ms]; status=[OK]
</code></pre>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-servlet%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">1. Servletçš„ç”Ÿå‘½å‘¨æœŸ</a>
<ul>
<li><a href="#1-%E7%AE%80%E5%8D%95%E7%9A%84demo">1. ç®€å•çš„Demo</a></li>
<li><a href="#2-%E9%80%9A%E8%BF%87demo%E6%88%91%E4%BB%AC%E7%9F%A5%E9%81%93%E4%BA%86%E4%BB%80%E4%B9%88">2. é€šè¿‡Demo,æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆ ?</a>
<ul>
<li><a href="#1-init-%E6%96%B9%E6%B3%95">1. init(..) æ–¹æ³•</a></li>
<li><a href="#2-service-%E6%96%B9%E6%B3%95">2. service() æ–¹æ³•</a></li>
<li><a href="#3-destroy-%E6%96%B9%E6%B3%95">3. destroy() æ–¹æ³•</a></li>
<li><a href="#4-%E6%80%BB%E7%BB%93">4. æ€»ç»“</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-dispatcherservlet-%E7%9A%84%E6%A0%B8%E5%BF%83">2. DispatcherServlet çš„æ ¸å¿ƒ</a>
<ul>
<li><a href="#1-%E8%AE%A4%E8%AF%86dispatcherservlet">1. è®¤è¯†DispatcherServlet</a></li>
<li><a href="#1-init-%E6%96%B9%E6%B3%95%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B">1. init() æ–¹æ³•å¯åŠ¨è¿‡ç¨‹</a></li>
<li><a href="#2-service%E6%96%B9%E6%B3%95-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">2. service()æ–¹æ³• æ‰§è¡Œæµç¨‹</a>
<ul>
<li><a href="#1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E6%89%A7%E8%A1%8Cservice-%E6%96%B9%E6%B3%95">1. ç¬¬ä¸€æ­¥  æ‰§è¡Œservice() æ–¹æ³•</a></li>
<li><a href="#2-%E7%AC%AC%E4%BA%8C%E6%AD%A5-processrequest%E6%96%B9%E6%B3%95">2. ç¬¬äºŒæ­¥  processRequest()æ–¹æ³•</a></li>
<li><a href="#3-%E7%AC%AC%E4%B8%89%E6%AD%A5-%E8%B0%83%E7%94%A8doservice-%E6%96%B9%E6%B3%95">3. ç¬¬ä¸‰æ­¥ è°ƒç”¨doService() æ–¹æ³•</a></li>
<li><a href="#4-%E7%AC%AC%E5%9B%9B%E6%AD%A5-%E8%B0%83%E7%94%A8dodispatch%E6%96%B9%E6%B3%95">4. ç¬¬å››æ­¥  è°ƒç”¨doDispatch()æ–¹æ³•</a></li>
<li><a href="#5-%E7%AC%AC%E4%BA%94%E6%AD%A5-handler-%E6%96%B9%E6%B3%95">5. ç¬¬äº”æ­¥  handler() æ–¹æ³•</a></li>
<li><a href="#6-%E7%AC%AC%E5%85%AD%E6%AD%A5-%E7%BB%A7%E7%BB%AD%E8%B7%9F%E8%BF%9B">6. ç¬¬å…­æ­¥ ç»§ç»­è·Ÿè¿›</a></li>
<li><a href="#7-%E7%AC%AC%E4%B8%83%E6%AD%A5-%E7%BB%A7%E7%BB%AD%E8%B7%9F%E8%BF%9B">7. ç¬¬ä¸ƒæ­¥  ç»§ç»­è·Ÿè¿›</a></li>
<li><a href="#8-%E7%AC%AC%E5%85%AB%E6%AD%A5-%E7%BB%88%E4%BA%8E%E6%89%A7%E8%A1%8C%E7%9C%9F%E6%AD%A3%E7%9A%84%E9%80%BB%E8%BE%91%E4%BA%86">8. ç¬¬å…«æ­¥  ç»ˆäºæ‰§è¡ŒçœŸæ­£çš„é€»è¾‘äº†</a></li>
<li><a href="#9-%E7%AC%AC%E4%B9%9D%E6%AD%A5-%E6%A0%B9%E6%8D%AE%E8%BF%94%E5%9B%9E%E7%9A%84vive-%E6%B8%B2%E6%9F%93%E8%A7%86%E5%9B%BE">9. ç¬¬ä¹æ­¥  æ ¹æ®è¿”å›çš„vive æ¸²æŸ“è§†å›¾</a></li>
<li><a href="#10-%E7%AC%AC%E5%8D%81%E6%AD%A5-%E7%BB%93%E6%9D%9Fprocessrequest-%E6%96%B9%E6%B3%95%E5%8F%91%E5%B8%83%E4%BA%8B%E4%BB%B6">10. ç¬¬åæ­¥  ç»“æŸprocessRequest() æ–¹æ³•,å‘å¸ƒäº‹ä»¶</a></li>
</ul>
</li>
<li><a href="#3-destroy-%E6%96%B9%E6%B3%95-2">3. destroy() æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#3-servletrequesthandledevent-%E4%BD%BF%E7%94%A8">3. ServletRequestHandledEvent ä½¿ç”¨</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>