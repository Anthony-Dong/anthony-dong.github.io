<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>JVM - è°ƒä¼˜å‚æ•° | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/jvm-diao-you-can-shu/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223360682" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>JVM - è°ƒä¼˜å‚æ•°</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-11-03</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/jvm-diao-you-can-shu/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/eZB86V-Dzpp/"
								class="tag">jvm</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">3940å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">18 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<blockquote>
<p>â€‹		é¦–å…ˆå£°æ˜ä¸€ä¸‹æˆ‘çš„ JVMç‰ˆæœ¬ ï¼š <code>Java HotSpot(TM) 64-Bit Server VMç‰ˆæœ¬ 25.221-b11</code>   ï¼Œä¸åŒçš„ç‰ˆæœ¬å¯èƒ½ç»“æœä¸ç”¨ï¼Œæœ‰å¾ˆå¤§çš„å·®å¼‚ ã€‚ æˆ‘çš„JDKç‰ˆæœ¬æ˜¯ 1.8 ã€‚</p>
</blockquote>
<h2 id="1-åƒåœ¾å›æ”¶-gc">1. åƒåœ¾å›æ”¶ - GC</h2>
<p>â€‹		Javaçš„ä¸€å¤§ç‰¹è‰²å°±æ˜¯æ”¯æŒè‡ªåŠ¨çš„åƒåœ¾å›æ”¶(Garbage Collection) ç®€ç§°GC . ä½†æ˜¯æœ‰çš„æ—¶å€™å‘¢ , å¦‚æœåƒåœ¾å›æ”¶é¢‘ç¹çš„å‡ºç°, ä¼šå‡ºç°å ç”¨å¤ªé•¿çš„CPUæ—¶é—´, å°±ä¸å¾—ä¸å¼•æˆ‘ä»¬çš„é‡è§†äº† , å°±éœ€è¦ä¸€äº› è·Ÿè¸ªå‚æ•°è¿›è¡ŒæŸ¥çœ‹GC å›æ”¶çš„æ•ˆç‡å’Œæ•ˆæœ .</p>
<p>â€‹		å¯¹äºGCçš„ä¸€äº›ç®—æ³•ä»¥åŠä¸€äº›é…ç½®å‚æ•°,ä¸‹ä¸€ç¯‡æ–‡ç« è®²è§£ , <a href="https://anthony-dong.github.io/post/jvm-gc-hui-shou-suan-fa">åœ°å€</a> : https://anthony-dong.github.io/post/jvm-gc-hui-shou-suan-fa</p>
<p>â€‹		å¸¸ç”¨çš„GC å‚æ•°æœ‰ <code>-XX:+PrintGC</code>   æˆ–è€…æ˜¯ <code>-XX:+PrintGCDetails</code>  , æ›´åŠ è¯¦ç»† <code>-XX:+PrintHeapAtGC</code>  , æˆ–è€…æ‰“å° GCå›æ”¶çš„æ—¶é—´åç§»é‡   <code>-XX:+PrintGCTimeStamps</code>, æ¯æ¬¡GCæ¶ˆè€—æ—¶é—´ <code>-XX:+PrintGCApplicationConcurrentTime</code> ,GCçš„æ—¥å¿—æ–‡ä»¶ä½ç½® :  <code>-Xloggc:log/gc.log</code></p>
<p>â€‹		ä¸‹é¢è¿™æ®µä»£ç æˆ‘ä»¬å°è¯•è¿è¡Œä¸€ä¸‹ . ç®€å•ä½“éªŒä¸€ä¸‹ ï¼š</p>
<pre><code class="language-java">public class TestAllocateStack {

    static class User{
        String name;
    }
    
    private static User user;

    static void allocUser1(){
        user = new User();
        user.name = &quot;name&quot;;
    }
    public static void main(String[] args) {
        long b = System.currentTimeMillis();
        // 2000Wæ¬¡å®ä¾‹åŒ–
        for(int i = 0;i&lt; 20000000;i++){
            allocUser1();
        }
        long e = System.currentTimeMillis();
        System.out.println(&quot;mainè¿›ç¨‹ ç»“æŸ ï¼š&quot;+ (e-b));
        System.out.println(&quot;åˆå§‹åŒ–å †å†…å­˜æœ€å¤§å€¼ : &quot;+Runtime.getRuntime().maxMemory() / 1000 / 1000+&quot;M&quot;);
    }
}

è¿è¡Œæ—¶è¯·è¾“å…¥ä¸€ä¸‹å‚æ•° ï¼š  
-XX:+PrintGCDetails -XX:+PrintGCTimeStamps-XX:+PrintGCApplicationConcurrentTime -XX:+PrintCommandLineFlags
</code></pre>
<p>â€‹		æ—¥å¿—ç»“æœ :</p>
<pre><code class="language-java">// GCæ¶ˆè€—äº† 0.0826751 seconds , ä»0.286å¼€å§‹GC
0.286: Application time: 0.0826751 seconds  
// GC å›æ”¶äº† 81920K - &gt; 952Kçš„å¤§å°
0.287: [GC (Allocation Failure) [PSYoungGen: 81920K-&gt;952K(95232K)] 81920K-&gt;960K(312320K), 0.0012166 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
0.311: Application time: 0.0230909 seconds
0.311: [GC (Allocation Failure) [PSYoungGen: 82872K-&gt;808K(95232K)] 82880K-&gt;816K(312320K), 0.0014887 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
0.334: Application time: 0.0211095 seconds
0.334: [GC (Allocation Failure) [PSYoungGen: 82728K-&gt;760K(95232K)] 82736K-&gt;768K(312320K), 0.0012838 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
mainè¿›ç¨‹ ç»“æŸ ï¼š148
åˆå§‹åŒ–å †å†…å­˜æœ€å¤§å€¼ : 4725M
Heap
// æ–°ç”Ÿä»£æƒ…å†µ
 PSYoungGen      total 95232K, used 75780K [0x0000000756600000, 0x0000000762000000, 0x00000007c0000000)
 // Eden åŒºåŸŸ , é»˜è®¤å’ŒsurvivoråŒºåŸŸçš„æ¯”ä¾‹æ˜¯8:1 çš„å…³ç³»(ä¹Ÿä¸ä¸€å®š,åæ­£æŒºé«˜çš„),å¯ä»¥é€šè¿‡å…¶ä»–å‚æ•°é…ç½®æ¯”ä¾‹
  eden space 81920K, 91% used [0x0000000756600000,0x000000075af43340,0x000000075b600000)
 // Survivor  åŒºåŸŸ     from                    
  from space 13312K, 5% used [0x000000075b600000,0x000000075b6be030,0x000000075c300000)
 // Survivor  åŒºåŸŸ      to                           
  to   space 13312K, 0% used [0x0000000761300000,0x0000000761300000,0x0000000762000000)
// è€å¹´ä»£æƒ…å†µ                              
 ParOldGen       total 217088K, used 8K [0x0000000683200000, 0x0000000690600000, 0x0000000756600000)
  object space 217088K, 0% used [0x0000000683200000,0x0000000683202000,0x0000000690600000)
//  å…ƒæ•°æ®                              
 Metaspace       used 3274K, capacity 4500K, committed 4864K, reserved 1056768K
  class space    used 350K, capacity 388K, committed 512K, reserved 1048576K
0.357: Application time: 0.0222731 seconds
</code></pre>
<p>â€‹		æˆ‘ä»¬å‘ç° , ç³»ç»Ÿç»å†äº† 3æ¬¡GCå›æ”¶ ,  å…¶ä¸­æ¯æ¬¡å›æ”¶äº†å¯¹åº”çš„å†…å­˜ .</p>
<p>â€‹		å¯¹äº<code>[0x0000000756600000,0x000000075af43340,0x000000075b600000)</code>è¿™æ˜¯16è¿›åˆ¶ , ä»£è¡¨ç€åœ°å€å€¼ , æˆ‘ä»¬çŸ¥é“å †å†…å­˜åˆ’åˆ†ä½ç½®ä¼šå¯¹åº”ç€ä¸€ä¸ªä¸ªåœ°å€å€¼ , è¿™å‡ ä¸ªæ•°å­—å°±ä»£è¡¨ç€åœ°å€å€¼ ,  å…¶ä¸­ :</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•° : low_boundary ,  å¯ä»¥ç§°ä¹‹ä¸º low , è¿™æ˜¯commited spaceçš„æœ€ä½åœ°å€è¾¹ç•Œ</p>
<p>ç¬¬äºŒä¸ªå‚æ•° : high, è¿™æ˜¯ commited spaceçš„æœ€é«˜åœ°å€è¾¹ç•Œ</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•° : high_boundary, è¿™æ˜¯ reserved spaceçš„æœ€é«˜åœ°å€è¾¹ç•Œ</p>
<h2 id="2-ç±»çš„åŠ è½½å’Œå¸è½½">2. ç±»çš„åŠ è½½å’Œå¸è½½</h2>
<p>â€‹		JAVAç¨‹åºç¦»ä¸å¼€ç±»çš„åŠ è½½ä¸å¸è½½ , ä¸ºäº†æ›´å¥½çš„äº†è§£ç¨‹åºçš„æ‰§è¡Œ , æœ‰çš„æ—¶å€™çŸ¥é“ç³»ç»ŸåŠ è½½äº†å“ªäº›ç±». åŸºäºåŠ¨æ€ä»£ç†å’ŒAOPç­‰æŠ€æœ¯çš„æ™®éä½¿ç”¨ , ç³»ç»Ÿå¯èƒ½è¿è¡Œæ—¶ç”ŸæˆæŸäº›ç±» ,è¿™äº›ç±»æ¯”è¾ƒéšè”½ ,æ— æ³•ç”¨æ–‡ä»¶ç³»ç»ŸæŸ¥æ‰¾åˆ°, å› æ­¤éœ€è¦ç±»çš„è¿½è¸ª .</p>
<p>â€‹		å¯ä»¥ä½¿ç”¨ å‚æ•° <code>-XX:+TraceClassLoading</code> è·Ÿè¸ªç±»çš„åŠ è½½ å’Œ  <code>-XX:+TraceClassUnloading</code>è·Ÿè¸ªç±»çš„å¸è½½</p>
<pre><code class="language-java">public class TraceClassLoading {
    public static void main(String[] args) throws ClassNotFoundException {
        Class.forName(&quot;com.jvm.trace_class_load.C&quot;);
    }
}
interface InterP{}
interface InterC extends InterP{}

class P implements  InterC{}

class C extends P{}
</code></pre>
<p>æ‰“å°ç»“æœ  .....</p>
<pre><code class="language-java">[Loaded java.lang.Object from C:\Program Files\Java\jdk1.8.0_221\jre\lib\rt.jar]
[Loaded java.io.Serializable from C:\Program Files\Java\jdk1.8.0_221\jre\lib\rt.jar]
.....
.......
[Loaded com.jvm.trace_class_load.TraceClassLoading from file:/D:/%e4%bb%a3%e7%a0%81%e5%ba%93/javase%e5%ad%a6%e4%b9%a0/DevelopmentJAVA/java-jvm-optimize/target/classes/]
[Loaded sun.launcher.LauncherHelper$FXHelper from C:\Program Files\Java\jdk1.8.0_221\jre\lib\rt.jar]
[Loaded java.lang.Class$MethodArray from C:\Program Files\Java\jdk1.8.0_221\jre\lib\rt.jar]
[Loaded java.lang.Void from C:\Program Files\Java\jdk1.8.0_221\jre\lib\rt.jar]
[Loaded com.jvm.trace_class_load.InterP from file:/D:/%e4%bb%a3%e7%a0%81%e5%ba%93/javase%e5%ad%a6%e4%b9%a0/DevelopmentJAVA/java-jvm-optimize/target/classes/]
[Loaded com.jvm.trace_class_load.InterC from file:/D:/%e4%bb%a3%e7%a0%81%e5%ba%93/javase%e5%ad%a6%e4%b9%a0/DevelopmentJAVA/java-jvm-optimize/target/classes/]
[Loaded com.jvm.trace_class_load.P from file:/D:/%e4%bb%a3%e7%a0%81%e5%ba%93/javase%e5%ad%a6%e4%b9%a0/DevelopmentJAVA/java-jvm-optimize/target/classes/]
[Loaded com.jvm.trace_class_load.C from file:/D:/%e4%bb%a3%e7%a0%81%e5%ba%93/javase%e5%ad%a6%e4%b9%a0/DevelopmentJAVA/java-jvm-optimize/target/classes/]    
</code></pre>
<p>æˆ‘ä»¬å‘ç°é¦–å…ˆåŠ è½½çš„ç±»æ˜¯ Object ç±» , æœ€åä¼šåŠ è½½ æˆ‘ä»¬å®ç°çš„ç±»</p>
<h2 id="3-å †å†…å­˜">3. å †å†…å­˜</h2>
<h3 id="1-æœ€å¤§å †-åˆå§‹åŒ–å †">1. æœ€å¤§å † &amp; åˆå§‹åŒ–å †</h3>
<blockquote>
<p>â€‹	 	å½“JVM å¯åŠ¨æ—¶, è™šæ‹Ÿæœºå°±ä¼šåˆ†é…ä¸€å—åˆå§‹å †çš„ç©ºé—´ , å¯ä»¥ä½¿ç”¨å‚æ•°<code>-Xms10m</code> æŒ‡å®šè¿™å—ç©ºé—´çš„å¤§å°(æ­¤æ—¶è®¾ç½®ä¸º10m) , ä¸€èˆ¬æ¥è¯´ , è™šæ‹Ÿæœºä¼šå°½å¯èƒ½çš„ç»´æŒåœ¨åˆå§‹å †çš„ç©ºé—´èŒƒå›´å†…è¿è¡Œ , ä½†æ˜¯å½“åˆå§‹å †æ¶ˆè€—å®Œ,ä¼šå°†å †ç©ºé—´è¿›ä¸€æ­¥çš„æ‹“å±•,å…¶æ‹“å±•ä¸Šé™ä¸º æœ€å¤§å †ç©ºé—´ ,å¯ä»¥é€šè¿‡ <code>-Xmx20m</code> è¿›è¡Œè®¾ç½® (æ­¤æ—¶è®¾ç½®çš„æœ€å¤§å †ç©ºé—´ä¸º20m) .</p>
</blockquote>
<pre><code class="language-java">public class HeapAlloc {
    public static void main(String[] args) {
        System.out.println(&quot;======================================&quot;);

        System.out.println(&quot;åˆå§‹åŒ–&quot;);
        System.out.println(&quot;æœ€å¤§å †ç©ºé—´ : &quot;+Runtime.getRuntime().maxMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;ç©ºé—²å †ç©ºé—´ : &quot;+Runtime.getRuntime().freeMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;åˆå§‹åŒ–å †ç©ºé—´ : &quot;+Runtime.getRuntime().totalMemory()/1024/1024+&quot;M&quot;);

        System.out.println(&quot;======================================&quot;);

        // byte  æ˜¯ ä¸€ä¸ªå­—èŠ‚ , æ‰€ä»¥æ˜¯ 10M
        byte[] b = new byte[2 * 1024 * 1024];
        System.out.println(&quot;åˆ†é…2Mçš„å†…å­˜ç©ºé—´&quot;);
        System.out.println(&quot;æœ€å¤§å †ç©ºé—´ : &quot;+Runtime.getRuntime().maxMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;ç©ºé—²å †ç©ºé—´ : &quot;+Runtime.getRuntime().freeMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;åˆå§‹åŒ–å †ç©ºé—´ : &quot;+Runtime.getRuntime().totalMemory()/1024/1024+&quot;M&quot;);

        System.out.println(&quot;======================================&quot;);

        // byte  æ˜¯ ä¸€ä¸ªå­—èŠ‚ , æ‰€ä»¥æ˜¯ 10M
        byte[] b2 = new byte[5 * 1024 * 1024];
        System.out.println(&quot;åˆ†é…5Mçš„å†…å­˜ç©ºé—´&quot;);
        System.out.println(&quot;æœ€å¤§å †ç©ºé—´ : &quot;+Runtime.getRuntime().maxMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;ç©ºé—²å †ç©ºé—´ : &quot;+Runtime.getRuntime().freeMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;åˆå§‹åŒ–å †ç©ºé—´ : &quot;+Runtime.getRuntime().totalMemory()/1024/1024+&quot;M&quot;);

        System.out.println(&quot;======================================&quot;);
    }
}

è¾“å…¥ä¸€ä¸‹æŒ‡ä»¤è¿è¡Œ : 
-Xmx20m -Xms5m -XX:+PrintCommandLineFlags -XX:+PrintGCDetails
</code></pre>
<p>è¿è¡Œç»“æœ ï¼š</p>
<pre><code class="language-java">-XX:InitialHeapSize=5242880 -XX:MaxHeapSize=20971520 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC 
[GC (Allocation Failure) [PSYoungGen: 1024K-&gt;504K(1536K)] 1024K-&gt;632K(5632K), 0.0009089 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[GC (Allocation Failure) [PSYoungGen: 1518K-&gt;512K(1536K)] 1646K-&gt;927K(5632K), 0.0010350 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
======================================
åˆå§‹åŒ–
// æœ€å¤§å †ç©ºé—´ç”±äºJVMè¿˜è¦ç»™å…¶ä»–ç©ºé—´åˆ†é…å†…å­˜,æ‰€ä»¥å¯èƒ½ä¼šå ç”¨ä¸€éƒ¨åˆ†
æœ€å¤§å †ç©ºé—´ : 18M
ç©ºé—²å †ç©ºé—´ : 4M
åˆå§‹åŒ–å †ç©ºé—´ : 5M
======================================
åˆ†é…2Mçš„å†…å­˜ç©ºé—´
æœ€å¤§å †ç©ºé—´ : 18M
ç©ºé—²å †ç©ºé—´ : 2M
åˆå§‹åŒ–å †ç©ºé—´ : 5M
======================================
åˆ†é…5Mçš„å†…å­˜ç©ºé—´
æœ€å¤§å †ç©ºé—´ : 18M
ç©ºé—²å †ç©ºé—´ : 2M
// ç”±äºåˆå§‹å †ç©ºé—´ä¸å¤Ÿ , ä¼šæ‹“å±•å †ç©ºé—´å¤§å°
åˆå§‹åŒ–å †ç©ºé—´ : 11M
======================================
Heap
 PSYoungGen      total 1536K, used 814K [0x00000000ff980000, 0x00000000ffc80000, 0x0000000100000000)
  eden space 1024K, 29% used [0x00000000ff980000,0x00000000ff9cba50,0x00000000ffa80000)
  from space 512K, 100% used [0x00000000ffb00000,0x00000000ffb80000,0x00000000ffb80000)
  to   space 512K, 0% used [0x00000000ffa80000,0x00000000ffa80000,0x00000000ffb00000)
 ParOldGen       total 9728K, used 7583K [0x00000000fec00000, 0x00000000ff580000, 0x00000000ff980000)
  object space 9728K, 77% used [0x00000000fec00000,0x00000000ff367ef8,0x00000000ff580000)
 Metaspace       used 3258K, capacity 4500K, committed 4864K, reserved 1056768K
  class space    used 350K, capacity 388K, committed 512K, reserved 1048576K

</code></pre>
<h4 id="æ³¨æ„">æ³¨æ„ ï¼š</h4>
<pre><code>	åœ¨å®é™…å·¥ä½œä¸­å¯ä»¥å°† -Xms å’Œ -Xmx çš„å€¼è®¾ç½®ä¸ºç›¸åŒ , è¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºè¿è¡Œæ—¶è¿›è¡Œçš„åƒåœ¾å›æ”¶æ¬¡æ•° , ä»è€Œæé«˜ç¨‹åºæ€§èƒ½ .  æ‰€ä»¥å½“æˆ‘ä»¬å°†ä¿©ä¸ªå‚æ•°å€¼è®¾ç½®ä¸ºç›¸åŒæ—¶ ,ä¸Šè¯‰ä»£ç å°±ä¸ä¼šè¿›è¡ŒGCå›æ”¶äº† ,å¤§å®¶å¯ä»¥è¯•ä¸€è¯•.
</code></pre>
<h3 id="2-æ–°ç”Ÿä»£-è€å¹´ä»£">2. æ–°ç”Ÿä»£ &amp; è€å¹´ä»£</h3>
<blockquote>
<p>â€‹		æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>-Xmn20m</code> è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å° , è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„æ–°ç”Ÿä»£ä¼šå‡å°‘è€å¹´å¸¦çš„å¤§å°, è¿™ä¸ªå‚æ•°å¯¹äºç³»ç»Ÿçš„æ€§èƒ½ä»¥åŠGCè¡Œä¸ºä¼šæœ‰å¾ˆå¤§çš„å½±å“ . æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¯”ä¾‹ , ä¸€èˆ¬æ–°ç”Ÿä»£çš„å¤§å°è®¾ç½®ä¸ºæ•´ä¸ªå †å¤§å°çš„ <code>[1/3,1/4]</code> å·¦å³ .</p>
<p>â€‹		å¯ä»¥é€šè¿‡å‚æ•° <code>-XX:SurvivorRatio=&lt;N&gt;</code>  ç”¨æ¥è®¾ç½®æ–°ç”Ÿä»£ä¸­ edenç©ºé—´å’Œsurvivorç©ºé—´çš„æ¯”ä¾‹å…³ç³» . ä»–ä»¬çš„æ¯”ä¾‹å…³ç³»ä¸€èˆ¬æ˜¯ :  <code>-XX:SurvivorRatio=eden/from=eden/to</code>   , å½“æˆ‘ä»¬äº†è§£äº† GC æœºåˆ¶,å°±çŸ¥é“ å¦‚ä½•é…ç½®è¿™ä¸ªæ¯”ä¾‹äº† .</p>
<p>â€‹		å¯ä»¥é€šè¿‡ <code>-XX:NewRatio=&lt;N&gt;</code> è®¾ç½®æ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹ . ä¸‹é¢æ˜¯ä¸€ä¸ªé»˜è®¤æ¯”ä¾‹ã€‚</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://tyut.oss-cn-beijing.aliyuncs.com/image/2019-11-03/a10d0600-ebb7-46ed-9030-fa03e5887186.png?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<pre><code class="language-java">public class SeriallyAllocateHeap {
    public static void main(String[] args) {
        byte[] menory = null;

        System.out.println(&quot;============= åˆå§‹åŒ–å†…å­˜ç©ºé—´ =========================&quot;);
        System.out.println(&quot;æœ€å¤§å †ç©ºé—´ : &quot;+Runtime.getRuntime().maxMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;ç©ºé—²å †ç©ºé—´ : &quot;+Runtime.getRuntime().freeMemory()/1024/1024+&quot;M&quot;);
        System.out.println(&quot;åˆå§‹åŒ–å †ç©ºé—´ : &quot;+Runtime.getRuntime().totalMemory()/1024/1024+&quot;M&quot;);

        for (int i = 0; i &lt; 5; i++) {
            // åˆ›å»ºä¸€å— 1M å¤§å°çš„ ç©ºé—´
            menory = new byte[2 * 1024 * 1024];
            System.out.println(&quot;==============&quot;+&quot;åˆ†é…ç¬¬&quot;+(i+1)+&quot;æ¬¡&quot;+&quot;========================&quot;);
            System.out.println(&quot;æœ€å¤§å †ç©ºé—´ : &quot;+Runtime.getRuntime().maxMemory()/1024/1024+&quot;M&quot;);
            System.out.println(&quot;ç©ºé—²å †ç©ºé—´ : &quot;+Runtime.getRuntime().freeMemory()/1024/1024+&quot;M&quot;);
            System.out.println(&quot;åˆå§‹åŒ–å †ç©ºé—´ : &quot;+Runtime.getRuntime().totalMemory()/1024/1024+&quot;M&quot;);

        }
        System.out.println(&quot;============= ç»“æŸ =========================&quot;);
    }
}

è¿è¡Œæ—¶è¯·è¾“å…¥ä»¥ä¸‹å‚æ•° : 
-Xmx20m -Xms20m -XX:+PrintGCDetails -XX:+PrintCommandLineFlags -Xmn2m -XX:SurvivorRatio=2
</code></pre>
<p>è¿è¡Œç»“æœ :</p>
<pre><code class="language-java">-XX:InitialHeapSize=20971520 -XX:MaxHeapSize=20971520 -XX:MaxNewSize=2097152 -XX:NewSize=2097152 -XX:+PrintCommandLineFlags -XX:+PrintGCDetails -XX:SurvivorRatio=2 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC 
[GC (Allocation Failure) [PSYoungGen: 1024K-&gt;504K(1536K)] 1024K-&gt;616K(19968K), 0.0008850 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
[GC (Allocation Failure) [PSYoungGen: 1528K-&gt;504K(1536K)] 1640K-&gt;827K(19968K), 0.0008248 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] 
============= åˆå§‹åŒ–å†…å­˜ç©ºé—´ =========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 18M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
==============åˆ†é…ç¬¬1æ¬¡========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 16M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
==============åˆ†é…ç¬¬2æ¬¡========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 14M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
==============åˆ†é…ç¬¬3æ¬¡========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 12M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
==============åˆ†é…ç¬¬4æ¬¡========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 10M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
==============åˆ†é…ç¬¬5æ¬¡========================
æœ€å¤§å †ç©ºé—´ : 19M
ç©ºé—²å †ç©ºé—´ : 8M
åˆå§‹åŒ–å †ç©ºé—´ : 19M
============= ç»“æŸ =========================
Heap
// è¿™é‡Œä¸€å…±æ˜¯ 1536K ,å…¶ä¸­eden ä¸º1024K , from ä¸º 512K ,é‚£ä¹ˆ 1024K/512k = 2 ,1024K+512k=1536K
 PSYoungGen      total 1536K, used 785K [0x00000000ffe00000, 0x0000000100000000, 0x0000000100000000)
  eden space 1024K, 27% used [0x00000000ffe00000,0x00000000ffe466d0,0x00000000fff00000)
  from space 512K, 98% used [0x00000000fff80000,0x00000000ffffe010,0x0000000100000000)
  to   space 512K, 0% used [0x00000000fff00000,0x00000000fff00000,0x00000000fff80000)
 ParOldGen       total 18432K, used 10563K [0x00000000fec00000, 0x00000000ffe00000, 0x00000000ffe00000)
  object space 18432K, 57% used [0x00000000fec00000,0x00000000ff650f38,0x00000000ffe00000)
 Metaspace       used 3244K, capacity 4500K, committed 4864K, reserved 1056768K
  class space    used 350K, capacity 388K, committed 512K, reserved 1048576K
</code></pre>
<h3 id="3-eden-from-to-æ˜¯ä»€ä¹ˆ">3. Eden &amp; From &amp; To æ˜¯ä»€ä¹ˆ</h3>
<figure data-type="image" tabindex="2"><img src="https://tyut.oss-cn-beijing.aliyuncs.com/image/2019-11-02/8226297e-1fe0-4580-811f-bbbc95cc8ed9.jpg" alt="" loading="lazy"></figure>
<p>â€‹				       	<strong>è¿™æ˜¯å†…å­˜åˆ’åˆ†å›¾(JDK 1.8 å°† permanent åŒºåŸŸç§»åˆ°äº†å †å¤–å†…å­˜ ,æ”¹åä¸º Metaspace )</strong></p>
<p>â€‹	 	 1ã€ä¸ºä»€ä¹ˆè¦åˆ†ä»£ ï¼Ÿ</p>
<p>â€‹	  	å…¶å®ä¸åˆ†ä»£å®Œå…¨å¯ä»¥ï¼Œåˆ†ä»£çš„å”¯ä¸€ç†ç”±å°±æ˜¯ä¼˜åŒ–GCæ€§èƒ½ . æˆ‘ä»¬å¯ä»¥æƒ³æƒ³ï¼Œå¦‚æœæ²¡æœ‰åˆ†ä»£ï¼Œé‚£æˆ‘ä»¬æ‰€æœ‰çš„å¯¹è±¡éƒ½åœ¨ä¸€å—ï¼ŒGCçš„æ—¶å€™æˆ‘ä»¬è¦æ‰¾åˆ°å“ªäº›å¯¹è±¡æ²¡ç”¨ï¼Œè¿™æ ·å°±ä¼šå¯¹å †çš„æ‰€æœ‰åŒºåŸŸè¿›è¡Œæ‰«æ , æ­¤æ—¶ä¼šæ¶ˆè€—å¾ˆé•¿çš„æ—¶é—´å»æŸ¥æ‰¾ ã€‚è€Œæˆ‘ä»¬çš„å¾ˆå¤šå¯¹è±¡éƒ½æ˜¯ä¼šæ­»äº¡çš„ ,è€Œä¸”ä¼´éšç€é˜¶æ®µæ€§ï¼Œå¦‚æœåˆ†ä»£çš„è¯ï¼Œæˆ‘ä»¬æŠŠæ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åˆ°æŸä¸€åœ°æ–¹ï¼Œå½“GCçš„æ—¶å€™å…ˆæŠŠè¿™å—å­˜â€œä¼šæ­»äº¡çš„â€å¯¹è±¡çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè¿™æ ·å°±ä¼šè…¾å‡ºå¾ˆå¤§çš„ç©ºé—´å‡ºæ¥ã€‚</p>
<p>â€‹		2ã€å…¶æ¬¡å°±æ˜¯  <code>Eden</code>  , <code>From</code> , <code>To</code>   è¿™ä¸‰ä¸ªåˆ°åº•æ˜¯ä»€ä¹ˆ ?</p>
<p>â€‹		<code>Eden</code>åœ¨è‹±æ–‡ä¸­æ˜¯ ä¼Šç”¸å›­çš„æ„æ€,ä»£è¡¨ç€æ–°ç”Ÿ , è€Œ  <code>From</code> , <code>To</code>  ç©ºé—´ å…¶å®å°±æ˜¯ <code>Survivor</code> åŒºåŸŸ, åœ¨ç”¨<code>Jconsoleå·¥å…·</code> æ—¶ ,å¹¶æ²¡æœ‰è¯´æ˜è¿™ä¸ª  <code>From</code> , <code>To</code>   ç©ºé—´ .æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä¾é é‚£ä¸ªå·¥å…·å»çœ‹ .  ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åˆ°EdenåŒº(ä¸€äº›å¤§å¯¹è±¡ç‰¹æ®Šå¤„ç†) , è¿™äº›å¯¹è±¡ç»è¿‡ç¬¬ä¸€æ¬¡Minor GCåï¼Œå¦‚æœä»ç„¶å­˜æ´»ï¼Œå°†ä¼šè¢«ç§»åˆ°SurvivoråŒºã€‚å¯¹è±¡åœ¨SurvivoråŒºä¸­æ¯ç†¬è¿‡ä¸€æ¬¡Minor GCï¼Œå¹´é¾„å°±ä¼šå¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå°±ä¼šè¢«ç§»åŠ¨åˆ°å¹´è€ä»£ä¸­ã€‚</p>
<p>â€‹		3ã€å…³äºè¯¦ç»†è¿‡ç¨‹ ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« è®²åˆ° ï¼Œ <a href="https://anthony-dong.github.io/post/jvm-gc-hui-shou-suan-fa">åœ°å€</a> ï¼š https://anthony-dong.github.io/post/jvm-gc-hui-shou-suan-fa</p>
<h2 id="4-éå †å†…å­˜">4. éå †å†…å­˜</h2>
<h3 id="1-æ–¹æ³•åŒºå…ƒæ•°æ®åŒº">1. æ–¹æ³•åŒº(å…ƒæ•°æ®åŒº)</h3>
<p>â€‹		æ–¹æ³•åŒºä¸»è¦æ˜¯å­˜æ”¾ç±»çš„å…ƒä¿¡æ¯ , åœ¨JDK 1.6 , 1.7 çš„ç‰ˆæœ¬ä¸­ , å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>-XX:PermSize</code> å’Œ <code>-XX:MaxPermSize</code> é…ç½®æ°¸ä¹…åŒºçš„å¤§å° , ä¸€ä¸ªæ˜¯åˆå§‹çš„,ä¸€ä¸ªæ˜¯æœ€å¤§çš„</p>
<p>â€‹		åœ¨JDK1.8ä¸­ , æ°¸ä¹…åŒºè¢«å½»åº•åˆ é™¤, ä½¿ç”¨äº†æ–°çš„å…ƒæ•°æ®åŒºåŸŸå­˜æ”¾ç±»çš„å…ƒæ•°æ® . é»˜è®¤æƒ…å†µä¸‹ ,å…ƒæ•°æ®åªæ”¶ç³»ç»Ÿå¯ç”¨å†…å­˜çš„é™åˆ¶ , ä½†æ˜¯ä¾æ—§å¯ä»¥ä½¿ç”¨å‚æ•° <code>-XX:MaxMetaspaceSize</code> æŒ‡å®šå…ƒæ•°æ®åŒºåŸŸçš„æœ€å¤§å¯ç”¨å€¼ .</p>
<h3 id="2-æ ˆ">2. æ ˆ</h3>
<p>â€‹		æ ˆæ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„å†…å­˜ç©ºé—´ , åœ¨java è™šæ‹Ÿæœºä¸­å¯ä»¥ä½¿ç”¨<code>-Xss</code>å‚æ•° æŒ‡å®šçº¿ç¨‹çš„æ ˆå¤§å° .</p>
<h3 id="3-ç›´æ¥å†…å­˜">3. ç›´æ¥å†…å­˜</h3>
<p>â€‹    	ç›´æ¥å†…å­˜ä¸»è¦æ˜¯åœ¨NIOä¸­åº”ç”¨å¹¿æ³› , ä½¿ç”¨éå¸¸çš„æ™®é ,ç›´æ¥å†…å­˜å¯ä»¥è·³è¿‡Java å † , ä½¿Java ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®åŸç”Ÿå †ç©ºé—´ , å› æ­¤ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¿«äº†å†…å­˜ç©ºé—´çš„è®¿é—®é€Ÿåº¦ .</p>
<p>â€‹		æœ€å¤§ç›´æ¥å†…å­˜å¯ä»¥ç”¨ <code>-XX:MaxDirectMemorySize</code> è®¾ç½®</p>
<h4 id="ä¼˜åŠ¿">ä¼˜åŠ¿ :</h4>
<p>â€‹		è¯»å†™èƒ½åŠ›,ç›´æ¥å†…å­˜å¦‚æœè¢« server ä¼˜åŒ–å , æ¯”å †å†…å­˜æå‡äº†ä¸€ä¸ªé‡çº§ , ä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•ä»£ç  :</p>
<pre><code class="language-java">public class TestDirectMemory {

    public void directAccess(){
        long start = System.currentTimeMillis();

        ByteBuffer buffer = ByteBuffer.allocateDirect(4000);

        for (int i = 0; i &lt; 10000; i++) {
            for (int j = 0; j &lt; 1000; j++) {
                buffer.put((byte) j);
            }
            buffer.flip();
            while (buffer.hasRemaining()) {
                buffer.get();
            }
            buffer.clear();
        }

        System.out.println(&quot;directAccess : &quot;+(System.currentTimeMillis() - start));
    }


    public void bufferAccess(){
        long start = System.currentTimeMillis();
        ByteBuffer buffer = ByteBuffer.allocate(4000);
        for (int i = 0; i &lt; 100000; i++) {
            for (int j = 0; j &lt; 1000; j++) {
                buffer.put((byte) j);
            }
            buffer.flip();
            while (buffer.hasRemaining()) {
                buffer.get();
            }
            buffer.clear();
        }

        System.out.println(&quot;bufferAccess : &quot;+(System.currentTimeMillis() - start));
    }

    public static void main(String[] args) {
        TestDirectMemory directMemory = new TestDirectMemory();
        directMemory.bufferAccess();
        directMemory.directAccess();

        System.out.println(&quot;=====================&quot;);

        directMemory.bufferAccess();
        directMemory.directAccess();
    }
}

å¯åŠ¨ -server æ¨¡å¼
</code></pre>
<p>æ‰§è¡Œç»“æœ :</p>
<pre><code class="language-java">bufferAccess : 164
directAccess : 46
=====================
bufferAccess : 350
directAccess : 10
</code></pre>
<h4 id="åŠ£åŠ¿">åŠ£åŠ¿ :</h4>
<p>å¯¹äºå†…å­˜ç©ºé—´çš„ç”³è¯·ä¸Š , ç›´æ¥å†…å­˜æ¯«æ— ä¼˜åŠ¿å¯è¨€ ,æ‰€ä»¥è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„</p>
<pre><code class="language-java">public class TestAllocDirectBuffer {

    public void allocDirect() {
        long start = System.currentTimeMillis();
        for (int i = 0; i &lt; 300000; i++) {
            ByteBuffer.allocateDirect(1024);
        }
        System.out.println(&quot;allocDirect : &quot;+(System.currentTimeMillis() - start));
    }


    public void allocBuffer() {
        long start = System.currentTimeMillis();
        for (int i = 0; i &lt; 300000; i++) {
            ByteBuffer.allocate(1024);
        }
        System.out.println(&quot;allocBuffer : &quot;+(System.currentTimeMillis() - start));
    }

    public static void main(String[] args) {
        TestAllocDirectBuffer allocDirectBuffer = new TestAllocDirectBuffer();

        allocDirectBuffer.allocBuffer();
        allocDirectBuffer.allocDirect();

        System.out.println(&quot;===============================&quot;);

        allocDirectBuffer.allocBuffer();
        allocDirectBuffer.allocDirect();
    }
}
å¯åŠ¨ -server æ¨¡å¼
</code></pre>
<p>ç»“æœ :</p>
<pre><code class="language-java">allocBuffer : 114
allocDirect : 313
===============================
allocBuffer : 196
allocDirect : 290
</code></pre>
<h4 id="ç»“è®º">ç»“è®º :</h4>
<p>é€šè¿‡ä¸Šé¢æˆ‘ä»¬å‘ç° ç›´æ¥å†…å­˜é€‚åˆäºç”³è¯·æ¬¡æ•°æ¯”è¾ƒå°‘, è®¿é—®æ¯”è¾ƒé¢‘ç¹çš„åœºåˆ .</p>
<h2 id="5-server-client-æ¨¡å¼">5. Server &amp; Client æ¨¡å¼</h2>
<p>â€‹		ç›®å‰javaçš„è™šæ‹Ÿæœºéƒ½æ˜¯æ”¯æŒ Client  å’Œ Server ä¸¤ç§è¿è¡Œæ¨¡å¼çš„, ä½¿ç”¨ <code>java -version</code> å°±å¯ä»¥çœ‹å‡ºå½“å‰è™šæ‹Ÿæœºæ¨¡å¼</p>
<pre><code class="language-java">C:\WINDOWS\system32&gt;java -version
java version &quot;1.8.0_221&quot;
Java(TM) SE Runtime Environment (build 1.8.0_221-b11)
Java HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)
</code></pre>
<p>â€‹		ä¸ client æ¨¡å¼ç›¸æ¯” ,server æ¨¡å¼å¯åŠ¨æ¯”è¾ƒæ…¢ , å› ä¸ºserver æ¨¡å¼å¯åŠ¨ä¼šæ”¶é›†æ›´å¤šçš„ç³»ç»Ÿæ€§èƒ½ä¿¡æ¯ , ä½¿ç”¨æ›´å¤æ‚çš„ç®—æ³•å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ– , å› æ­¤å½“ç¨‹åºè¿›å…¥ç¨³å®šæœŸä»¥å, serveræ¨¡å¼çš„æ‰§è¡Œé€Ÿåº¦ä¼šè¿œè¿œå¿«äºclientæ¨¡å¼ . ä¸€èˆ¬64ä½ç³»ç»Ÿçš„é»˜è®¤æ˜¯server æ¨¡å¼</p>
<p>â€‹		å…³äºè¿™ä¸¤ç§æ¨¡å¼çš„åŒºåˆ«,å¤§å®¶å¯ä»¥ç½‘ä¸Šæ”¶é›†ä¸€ä¸‹ ,ä¸‹é¢æˆ‘åªæä¾› ä¹¦ä¸Šè®²çš„ .</p>
<p>â€‹		clientæ¨¡å¼ä¸­ CompileThreshold (ç¼–è¯‘ é˜ˆå€¼ ) é»˜è®¤æ˜¯ 1500 ,å½“ç¨‹åºå³å‡½æ•°è¢«è°ƒç”¨ 1500æ¬¡ å ,ä¼šè¿›è¡ŒJITç¼–è¯‘ , è€Œserver æ¨¡å¼ä¸‹ è¿™ä¸ªé˜ˆå€¼æ˜¯ 10000 . æ‰€ä»¥serveræ¨¡å¼æ›´æœ‰å¯èƒ½è§£é‡Šæ‰§è¡Œ,ä½†æ˜¯ä¸€æ—¦ç¼–è¯‘,serveræ¨¡å¼ä¼˜åŒ–æ•ˆæœä¼šè¿œè¿œå¥½äºclientæ¨¡å¼ .</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6-gc">1. åƒåœ¾å›æ”¶ - GC</a></li>
<li><a href="#2-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD">2. ç±»çš„åŠ è½½å’Œå¸è½½</a></li>
<li><a href="#3-%E5%A0%86%E5%86%85%E5%AD%98">3. å †å†…å­˜</a>
<ul>
<li><a href="#1-%E6%9C%80%E5%A4%A7%E5%A0%86-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A0%86">1. æœ€å¤§å † &amp; åˆå§‹åŒ–å †</a>
<ul>
<li><a href="#%E6%B3%A8%E6%84%8F">æ³¨æ„ ï¼š</a></li>
</ul>
</li>
<li><a href="#2-%E6%96%B0%E7%94%9F%E4%BB%A3-%E8%80%81%E5%B9%B4%E4%BB%A3">2. æ–°ç”Ÿä»£ &amp; è€å¹´ä»£</a></li>
<li><a href="#3-eden-from-to-%E6%98%AF%E4%BB%80%E4%B9%88">3. Eden &amp; From &amp; To æ˜¯ä»€ä¹ˆ</a></li>
</ul>
</li>
<li><a href="#4-%E9%9D%9E%E5%A0%86%E5%86%85%E5%AD%98">4. éå †å†…å­˜</a>
<ul>
<li><a href="#1-%E6%96%B9%E6%B3%95%E5%8C%BA%E5%85%83%E6%95%B0%E6%8D%AE%E5%8C%BA">1. æ–¹æ³•åŒº(å…ƒæ•°æ®åŒº)</a></li>
<li><a href="#2-%E6%A0%88">2. æ ˆ</a></li>
<li><a href="#3-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98">3. ç›´æ¥å†…å­˜</a>
<ul>
<li><a href="#%E4%BC%98%E5%8A%BF">ä¼˜åŠ¿ :</a></li>
<li><a href="#%E5%8A%A3%E5%8A%BF">åŠ£åŠ¿ :</a></li>
<li><a href="#%E7%BB%93%E8%AE%BA">ç»“è®º :</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-server-client-%E6%A8%A1%E5%BC%8F">5. Server &amp; Client æ¨¡å¼</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>