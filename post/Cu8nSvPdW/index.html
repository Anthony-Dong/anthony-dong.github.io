<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>Protobuf å­¦ä¹  | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/Cu8nSvPdW/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223342286" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>Protobuf å­¦ä¹ </a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2020-03-31</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/Cu8nSvPdW/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/L-xvm-udt-/"
								class="tag">Google</a> |
							 <a
								href="https://anthony-dong.github.io/tag/lvXRknuC3t/"
								class="tag">ProtoBuf</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">1800å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">8 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<p>å‰æœŸå‡†å¤‡ :  https://github.com/protocolbuffers/protobuf/releases ä¸‹è½½ç¼–è¯‘å™¨. protoc ç¼–è¯‘å™¨.</p>
<p>å®˜æ–¹æ–‡æ¡£ , ä¹Ÿå°±æ˜¯proto3 / proto2æ–‡æ¡£, åœ¨ https://developers.google.com/protocol-buffers/docs/proto3 è¿™é‡Œ, å¦‚æœè‹±æ–‡æ°´å¹³å·®çš„åŒå¿—å‘¢, å¯ä»¥çœ‹çœ‹è¿™ä¸ª  https://www.jianshu.com/p/bdd94a32fbd1 ,  å…¶å®proto3 æ›´åŠ å†™èµ·æ¥æ–¹ä¾¿.</p>
<p>æˆ‘å†™äº†ä¸€ç¯‡æ–‡ç«  https://github.com/Anthony-Dong/protobuf-start  , å°±æ˜¯åŸºæœ¬çš„ä½¿ç”¨.</p>
<blockquote>
<p>â€‹	å…¶ä¸­è¦åŒºåˆ†å¼€ message å’Œ service. å‰è€…æ˜¯åºåˆ—åŒ–, åè€…æä¾›äº†rpcæœåŠ¡.  å¤§éƒ¨åˆ†åœºæ™¯åªéœ€è¦message . åŒæ—¶ç¼–è¯‘service. ä¹Ÿéœ€è¦æ’ä»¶è¿›è¡Œç¼–è¯‘ . æ™®é€šçš„protoc --go_out  --java_out éƒ½ä¸è¡Œ.</p>
</blockquote>
<p>å¦‚æœç© golangçš„ , å¯ä»¥ä½¿ç”¨ <a href="https://github.com/gogo/protobuf">gofast</a>  æ’ä»¶ç¼–è¯‘ . ä¹Ÿä¸é”™. ä½†æ˜¯å’Œå®˜æ–¹è‡ªå¸¦çš„ä¸€äº›åº“å†²çª.  æœ€å¥½åˆ«æ··åˆä½¿ç”¨.</p>
<h2 id="æ–‡ä»¶ç»“æ„">æ–‡ä»¶ç»“æ„</h2>
<h4 id="åŸºæœ¬ç»“æ„">åŸºæœ¬ç»“æ„</h4>
<p>å…¶å®æˆ‘å¤§è‡´è¯´ä¸€ä¸‹protobufæ–‡ä»¶çš„åŸºæœ¬ç»“æ„ .</p>
<p>å†™protobufæ–‡ä»¶ , ä½¿ç”¨vscode å†™æ¯”è¾ƒæ£’  . æœ‰ä»£ç æç¤º, ä¸‹è½½ä¸€ä¸ªæ’ä»¶å°±è¡Œäº†.  æˆ‘è§‰å¾—protobufæ–‡ä»¶æœ€å¥½å’Œä¸šåŠ¡æŠ½ç¦»å‡ºæ¥. åˆ«æ··åœ¨ä¸€èµ·.</p>
<pre><code class="language-java">syntax = &quot;proto3&quot;; // è¯­æ³•ç‰ˆæœ¬

// è¿™ä¸ªå±äºpackage . åˆ«çš„protobufæ–‡ä»¶å¼•ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šè¿™ä¸ª. æœ€å¥½è‡ªå·±ç»™ protobufå®šä¹‰ä¸€ä¸ªpath.
package com.anthony.protobuf;

// Javaé€‰é¡¹
// Javaç±»è¾“å‡ºçš„ç›®çš„åœ°
option java_package = &quot;com.example.grpc.api&quot;;
// è¾“å‡ºçš„Classæ–‡ä»¶. å¦‚æœjava_multiple_files=false,åˆ™åªè¾“å‡ºè¿™ä¸€ä¸ªæ–‡ä»¶
// å¦åˆ™è¾“å‡º ä¸‰ä¸ªæ–‡ä»¶. Builder , RPCDateRequest ,Request ä¸‰ä¸ªæ–‡ä»¶, æ‰€ä»¥ java_outer_classnameä¸èƒ½å’ŒRPCDateRequeståå­—é‡å¤
option java_outer_classname = &quot;Request&quot;;
// ä¸Šé¢è§£é‡Šè¿‡äº†
option java_multiple_files = true;

// Go é€‰é¡¹ , ä¹Ÿæ˜¯å®ƒæŒ‡çš„æ˜¯ç”Ÿæˆåçš„ ,ç›®å½•ä½ç½®. ç›¸å¯¹äºprotocæŒ‡å®šçš„åœ°å€.
option go_package = &quot;github.com/golang/protobuf/ptypes/timestamp&quot;;


// å®šä¹‰æ¶ˆæ¯ , è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå¯¹è±¡å¯ä»¥åµŒå¥— äº’ç›¸å¼•ç”¨.
message RPCDateRequest {
    uint64 id = 1;
    string msg = 2;
}
</code></pre>
<h4 id="å¦‚ä½•ç¼–è¯‘">å¦‚ä½•ç¼–è¯‘</h4>
<blockquote>
<p>â€‹	æœ€å¥½ç†Ÿç»ƒæŒæ¡ç¼–è¯‘å‘½ä»¤ .</p>
</blockquote>
<p>ç¬¬ä¸‰æ­¥. å°±æ˜¯ç¼–è¯‘äº† .  <code>protoc</code> å‘½ä»¤</p>
<pre><code class="language-java">protoc -I=$SRC_DIR --go_out=$DST_DIR $SRC_DIR/addressbook.proto
</code></pre>
<p>ç¬¬ä¸€ä¸ªæ„æ€æ˜¯ :  <code>-I</code> å’Œ <code>--proto_path</code>  å«ä¹‰ä¸€æ ·  . æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¼å…¥åˆ«çš„protoæ–‡ä»¶. æ­¤æ—¶å°±éœ€è¦ä½¿ç”¨è¿™ä¸ªäº† .  è¿™ä¸ªå¯ä»¥æŒ‡å®šå¤šä¸ªè·¯å¾„.</p>
<p>ç¬¬äºŒä¸ªå°±æ˜¯ ,  <code>$DST_DIR</code> æŒ‡å®šçš„æ˜¯ <code>go_package</code>çš„è¾“å‡ºè·¯å¾„. æˆ–è€…<code>java_package</code> è¾“å‡ºè·¯å¾„</p>
<p>ç¬¬ä¸‰ä¸ªå°±æ˜¯.  <code>SRC_DIR</code> æŒ‡çš„æ˜¯ æˆ‘ä»¬protobufæºæ–‡ä»¶çš„åœ°å€.</p>
<p>ç¬¬å››ä¸ªæ¯”å¦‚è¯´ <code>--go_out</code> æŒ‡çš„æ˜¯ goçš„è¾“å‡ºè·¯å¾„.   <code>--go_out=plugins=grpc:</code> è¿™ä¸ªæŒ‡çš„æ˜¯ç”Ÿæˆ grpc ç›¸å…³çš„é…ç½®.</p>
<p>åŸºæœ¬å°±æ˜¯ä¸Šè¯‰å››ä¸ªå‘½ä»¤.</p>
<h2 id="message">Message</h2>
<blockquote>
<p>â€‹	å…¶ä¸­ message æœ‰ä¸‰ä¸ªä¿®é¥°è¯, ä½†æ˜¯åœ¨proto3ä¸­, åªç•™ä¸‹äº†ä¸€ä¸ª, é»˜è®¤ä¸€ä¸ªç¼ºé†’å€¼ .  <code>required</code> è¡¨ç¤ºå¿…é¡»å‡ºç°ä¸€æ¬¡, <code>optional</code>  å‡ºç°é›¶æ¬¡æˆ–è€…ä¸€æ¬¡,  <code>repeated</code> : å‡ºç°é›¶æ¬¡æˆ–è€…å¤šæ¬¡ , å…¶å®å°±æ˜¯æ•°ç»„. ä¹Ÿå°±æ˜¯å‰é¢ä¸‰ä¸ª, ä½†æ˜¯proto3ä¸­åªä¿ç•™äº† ç¬¬ä¸‰ä¸ª<code>repeated</code> .  é»˜è®¤å°±æ˜¯<code>optional</code> ,ä¸éœ€è¦æ˜¾ç¤ºå†™å‡ºæ¥,å†™å‡ºæ¥å°±å¼‚å¸¸äº†.</p>
<p>â€‹	åŒæ—¶proto2æ”¯æŒé»˜è®¤æ¨¡å¼, ä¹Ÿå°±æ˜¯ <code>default</code> å…³é”®å­— , ä½†æ˜¯åœ¨ proto3ä¸­å–æ¶ˆäº†.</p>
</blockquote>
<h4 id="åŸºæœ¬å†™æ³•">åŸºæœ¬å†™æ³•</h4>
<pre><code class="language-java">syntax=&quot;proto3&quot;;

package  com.anthony.protobuf;

// å¼•å…¥å…¶ä»–çš„protobufæ–‡ä»¶
import &quot;google/protobuf/empty.proto&quot;;

option java_multiple_files=true;
option java_package=&quot;com.anthony.api&quot;;
option java_outer_classname=&quot;PeopleApi&quot;;

message People{
    // 1 ,2 ,3 ,4 çš„æ„æ€æ˜¯index , æ‰€ä»¥ä¼ è¾“çš„æ—¶å€™å¯ä»¥ç›´æ¥è€ƒè¿™ä¸ªä¼ è¾“ä½ç½®. è¿™ä¸ªæ˜¯æ­»çš„, åƒä¸‡åˆ«éšæ„æ”¹å˜. 
    // 1-15 å ç”¨ä¸€ä¸ªå­—èŠ‚.  åé¢çš„å ç”¨ä¸¤ä¸ªå­—èŠ‚. æ‰€ä»¥æœ€å¥½ä½¿ç”¨å‰é¢çš„15ä¸ªå­—æ®µ.
    string name=1;
    int32 age=2;
    // æšä¸¾
    enum Gender{
        // è¿™ä¸ªå¿…é¡»ä»0å¼€å§‹
        Female = 0;
        Male = 1;
        Null=2;
    }
    Gender gender=3 ;
    // 0-1ä¸ª ,repeated å…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„.
    // è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–ç±»å‹.
    repeated Hobby hobbies=4;

    // map
    map&lt;string,Salary&gt;  job=5;
}

message Salary{
     int32 salary=1;
}

service PeopleService{
    rpc addUser (People) returns (google.protobuf.Empty){}
}

message Hobby{
    string name=1;
}

message Student{
    
}
</code></pre>
<h4 id="ä¿ç•™å­—-reserved-ç”¨æ³•">ä¿ç•™å­— reserved ç”¨æ³•</h4>
<p>æ¯”å¦‚ æˆ‘çš„ç¬¬ä¸€ä»£ç‰ˆæœ¬ä¸­, æœ‰ä¸€ä¸ªå­—æ®µ, æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µ</p>
<pre><code class="language-java">syntax=&quot;proto2&quot;;

package  com.anthony.protobuf;

option go_package=&quot;api&quot;;

message People{
    required string name=1;
    optional int32 age=2;
    // ç¬¬äºŒä¸ªç‰ˆæœ¬å–æ¶ˆæ‰.
    optional string info=3;
}
</code></pre>
<p>æ‰§è¡Œ <code>protoc -I ./src --go_out=./go_out ./src/com/anthony/protobuf/user.proto</code>ç„¶åæˆ‘ä»¬ä¸ºäº†éªŒè¯. æ­¤æ—¶éœ€è¦ä¿å­˜åˆ°æ–‡ä»¶ä¸­ , è°ƒç”¨è¿™ä¸ªæ–¹æ³•.</p>
<pre><code class="language-go">func write() {
	people := api.People{}
	name := &quot;tom&quot;
	people.Name = &amp;name
	age := int32(20)
	people.Age = &amp;age
	info := &quot;æ˜¯ä¸ªç”·çš„&quot;
	people.Info = &amp;info

	// åºåˆ—åŒ–
	bytes, _ := proto.Marshal(&amp;people)

	// ä¿å­˜åˆ°æ–‡ä»¶ä¸­
	file, e := os.OpenFile(&quot;save.txt&quot;, os.O_CREATE|os.O_WRONLY|os.O_TRUNC, 0644)
	if e != nil {
		log.Fatal(e)
	}
	file.Write(bytes)
	file.Close()
}
</code></pre>
<p>æ­¤æ—¶ä¸‹ä¸€ä»£æ¥äº†, æˆ‘ä»¬èˆå¼ƒæ‰äº† infoå­—æ®µ. æ­¤æ—¶ä¿®æ”¹äº†protoæ–‡ä»¶ .</p>
<pre><code class="language-java">syntax=&quot;proto3&quot;;
package  com.anthony.protobuf;
option go_package=&quot;api&quot;;

message People{
    string name=1;
    int32 age=2;
    // ç¬¬ä¸€ä»£ç‰ˆæœ¬ä¸­çš„.
    // string info=3;
    reserved 3;
}
</code></pre>
<p>æ”¹æˆäº†ä¸Šè¯‰è¿™ä¸ª, ç„¶åç¼–è¯‘</p>
<p>æ­¤æ—¶ è°ƒç”¨è¿™ä¸ªæ–¹æ³•.</p>
<pre><code class="language-go">func read() {
	bytes, _ := ioutil.ReadFile(&quot;save.txt&quot;)
	var rest api.People
	proto.Unmarshal(bytes,&amp;rest)
	fmt.Printf(&quot;%#v\n&quot;,rest)
	marshal, _ := json.Marshal(&amp;rest)
	fmt.Printf(&quot;%s&quot;, marshal)
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code class="language-go">api.People{Name:&quot;tom&quot;, Age:20, XXX_NoUnkeyedLiteral:struct {}{}, XXX_unrecognized:[]uint8{0x1a, 0xc, 0xe6, 0x98, 0xaf, 0xe4, 0xb8, 0xaa, 0xe7, 0x94, 0xb7, 0xe7, 0x9a, 0x84}, XXX_sizecache:0}
{&quot;name&quot;:&quot;tom&quot;,&quot;age&quot;:20}
</code></pre>
<p>è¯´æ˜ä¸ªé—®é¢˜, å®Œå…¨å…¼å®¹çš„.   å…¶å®å°±ç®—æ˜¯ä¸åŠ ä¸Š reserved  . ä¹Ÿæ²¡å•¥äº‹, ä¸ä¿¡ä½ åˆ äº†å®ƒè¯•è¯•.   å¯èƒ½æ˜¯æˆ‘ç†è§£çš„å‡ºå…¥é—®é¢˜.</p>
<p>å®˜æ–¹çš„æ„æ€æ˜¯ : <strong>å¦‚æœåˆ é™¤äº†æŸä¸€ä¸ªå­—æ®µï¼Œprotobufå…è®¸é‡æ–°ä½¿ç”¨è¯¥æ•°å€¼ä½œä¸ºæ–°çš„å±æ€§çš„æ ‡ç­¾ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯å‘åå…¼å®¹ï¼Œè¯»å–æ—§çš„æ•°æ®çš„æ—¶å€™ä¸ä¼šå‡ºç°é—®é¢˜ï¼Œä¸€èˆ¬ä½¿ç”¨reservedæ¥å£°æ˜è¯¥æ•°å€¼ä¸ºä¿ç•™ï¼Œä¸èƒ½è¢«ä½¿ç”¨ã€‚  åæ­£å°±æ˜¯ä¸ªä¿ç•™å­—, æ˜¯ä¸€ç§åè®®, ä¸ºäº†æ‹“å±•ç½¢äº†. å‘Šè¯‰å¯¹æ–¹è¿™ä¸ªæ˜¯ä¿ç•™ä½.</strong></p>
<h4 id="æ”¯æŒjson">æ”¯æŒJSON</h4>
<p>æ‰€ä»¥åæ­£æ¨èä½¿ç”¨ proto3 , åˆæ¬¡ä½¿ç”¨çš„è¯.  åŒæ—¶ä»–è¿˜æ”¯æŒjson. åŸå› æ˜¯å› ä¸º , tagæ ‡ç­¾ä¸­æœ‰ json.</p>
<pre><code class="language-go">type People struct {
	Name                 string   `protobuf:&quot;bytes,1,opt,name=name,proto3&quot; json:&quot;name,omitempty&quot;`
	Age                  int32    `protobuf:&quot;varint,2,opt,name=age,proto3&quot; json:&quot;age,omitempty&quot;`
	XXX_NoUnkeyedLiteral struct{} `json:&quot;-&quot;`
	XXX_unrecognized     []byte   `json:&quot;-&quot;`
	XXX_sizecache        int32    `json:&quot;-&quot;`
}
</code></pre>
<p>Javaå¦‚ä½•åšjsonå‘¢.</p>
<p>éœ€è¦ å¦‚ä¸‹è¿™ä¹ˆåš. ä½¿ç”¨ç¬¬ä¸‰æ–¹æ˜¾ç„¶ä¸å¯èƒ½.  éœ€è¦ä½¿ç”¨ <code>JsonFormat</code> å·¥å…·ç±»</p>
<pre><code class="language-java">public static void main(String[] args) throws InvalidProtocolBufferException {
    NPack hello = NPack.newBuilder().setBody(ByteString.copyFrom(&quot;helloworld&quot;.getBytes()))
            .setUrl(&quot;hello&quot;)
            .setTimeStamp(System.currentTimeMillis()).build();


    // åºåˆ—åŒ–æˆ json
    String print = JsonFormat.printer().print(hello);
    System.out.println(print);


    // ååºåˆ—åŒ–æˆ result
    NPack.Builder result = NPack.newBuilder();
    JsonFormat.parser().merge(print, result);

    NPack build = result.build();
    System.out.println(build);
}
</code></pre>
<h2 id="service">service</h2>
<blockquote>
<p>â€‹	è®°ä½ä¸€ç‚¹å°±è¡Œäº†, service ä¸èƒ½æœ‰æ™®é€šå­—æ®µ, å¿…é¡»æ˜¯ åŒ…è£…ç±»å‹, ä¹Ÿå°±æ˜¯å¿…é¡»æ˜¯message. ä¹Ÿä¸èƒ½è¿”å›å¤šä¸ªå¯¹è±¡.</p>
</blockquote>
<h2 id="ä¹¦å†™è§„èŒƒ">ä¹¦å†™è§„èŒƒ</h2>
<h4 id="messageå­—æ®µ">messageå­—æ®µ</h4>
<p>ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰å‘½å messageï¼Œä¾‹å­ï¼š<strong>SongServerRequest</strong><br>
ä½¿ç”¨ä¸‹åˆ’çº¿å‘½åå­—æ®µï¼Œæ —å­ï¼š<strong>song_name</strong></p>
<pre><code class="language-java">message SongServerRequest {
  required string song_name = 1;
}
</code></pre>
<h4 id="æšä¸¾">æšä¸¾</h4>
<p>ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰å‘½åæšä¸¾ç±»å‹ï¼Œä½¿ç”¨ â€œå¤§å†™_ä¸‹åˆ’çº¿_å¤§å†™â€ çš„æ–¹å¼å‘½åæšä¸¾å€¼ï¼š</p>
<pre><code class="language-java">enum Foo {
  FIRST_VALUE = 0;
  SECOND_VALUE = 1;
}
</code></pre>
<h3 id="service-å­—æ®µ">service å­—æ®µ</h3>
<p>å¦‚æœä½ åœ¨ .proto æ–‡ä»¶ä¸­å®šä¹‰ RPC æœåŠ¡ï¼Œä½ åº”è¯¥ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰å‘½å RPC æœåŠ¡ä»¥åŠå…¶ä¸­çš„ RPC æ–¹æ³•ï¼š</p>
<pre><code class="language-java">service FooService {
  rpc GetSomething(FooRequest) returns (FooResponse);
}
</code></pre>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¤šå†™ , å¤šæ•². åˆ«æŠŠprotobuf ä½œä¸ºrpc.  è€Œæ˜¯å½“åšåºåˆ—åŒ–åè®®. æˆ‘ä»¬å¤§éƒ¨åˆ†åœºæ™¯åªéœ€è¦å®ƒçš„åºåˆ—åŒ–åŠŸèƒ½.</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">æ–‡ä»¶ç»“æ„</a><br>
*
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84">åŸºæœ¬ç»“æ„</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E7%BC%96%E8%AF%91">å¦‚ä½•ç¼–è¯‘</a></li>
</ul>
</li>
<li><a href="#message">Message</a><br>
*
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E5%86%99%E6%B3%95">åŸºæœ¬å†™æ³•</a></li>
<li><a href="#%E4%BF%9D%E7%95%99%E5%AD%97-reserved-%E7%94%A8%E6%B3%95">ä¿ç•™å­— reserved ç”¨æ³•</a></li>
<li><a href="#%E6%94%AF%E6%8C%81json">æ”¯æŒJSON</a></li>
</ul>
</li>
<li><a href="#service">service</a></li>
<li><a href="#%E4%B9%A6%E5%86%99%E8%A7%84%E8%8C%83">ä¹¦å†™è§„èŒƒ</a><br>
*
<ul>
<li><a href="#message%E5%AD%97%E6%AE%B5">messageå­—æ®µ</a></li>
<li><a href="#%E6%9E%9A%E4%B8%BE">æšä¸¾</a></li>
<li><a href="#service-%E5%AD%97%E6%AE%B5">service å­—æ®µ</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>