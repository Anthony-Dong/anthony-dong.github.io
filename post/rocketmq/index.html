<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>Rocket-MQ | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/rocketmq/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223342286" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>Rocket-MQ</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-09-14</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/rocketmq/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/VGFs7LxPgW/"
								class="tag">ä¸­é—´ä»¶</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">3507å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">15 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—">ä¸ºä»€ä¹ˆé€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—</h2>
<ul>
<li>åŸå› åªæœ‰ä¸€ä¸ª è§£è€¦å†™å…¥å’Œå¤„ç†èƒ½åŠ›çš„å·®å¼‚,é¿å…å†™å…¥å¤ªå¤š,å¤„ç†ä¸è¿‡æ¥</li>
<li>å¼‚æ­¥å¤„ç†ç»™æˆ‘å¸¦æ¥ä»€ä¹ˆå¥½å¤„
<ul>
<li>å†™å…¥æ“ä½œå’Œåç»­å¤„ç†è¿›è¡Œè§£è€¦,å¼‚æ­¥å¤„ç†,æ­¤æ—¶ç”¨æˆ·åªç”¨ç‚¹å‡»ä¸€ä¸‹è¯·æ±‚,åç»­çš„è®°å½•æ—¥å¿—,ç»Ÿè®¡ç”¨æˆ·è¡Œä¸º,ä»¥åŠå†™å…¥ç”¨æˆ·ä¿¡æ¯ç­‰,æ“ä½œéƒ½ä¸éœ€è¦ç”¨æˆ·è¿›è¡Œç­‰å¾…,è¿™æ—¶å€™ç”¨æ¶ˆæ¯é˜Ÿåˆ—å°±å¾ˆå¥½</li>
</ul>
</li>
<li>è§£è€¦
<ul>
<li>å½“æˆ‘ä»¬çš„ä¸šåŠ¡è¿›è¡Œæ‹“å±•æ—¶,ä¸ç”¨ä¿®æ”¹åŸæ¥æ¨¡å—çš„ä»£ç ,å¦‚æœåŸæ¥æ˜¯ æ“ä½œAæ¨¡å—,éœ€è¦è°ƒç”¨B,Cæ¨¡å— , å¦‚æœæˆ‘åˆå¢åŠ ä¸€ä¸ªæ¨¡å—æ€ä¹ˆåŠ,æ‰€ä»¥ä½¿ç”¨mq,åªéœ€è¦ä¿è¯æ¶ˆæ¯çš„å¯é æ€§</li>
</ul>
</li>
<li>æˆ‘ä»¬ä¸èƒ½ç›²ç›®çš„ä½¿ç”¨mq,éœ€è¦æƒ³åˆ° å¹‚ç­‰æ“ä½œ å’Œ æ¶ˆæ¯çš„å¯é æ€§ä¿è¯,æœ‰äº›ä¸šåŠ¡å°±æ˜¯å¼ºè€¦åˆ,</li>
</ul>
<h2 id="1é…ç½®ç¯å¢ƒ">1.é…ç½®ç¯å¢ƒ</h2>
<ul>
<li>
<p>å»å®˜ç½‘ä¸‹è½½ <a href="https://rocketmq.apache.org/release_notes/release-notes-4.5.2/">ä¸‹è½½åœ°å€</a></p>
</li>
<li>
<p>ç¯å¢ƒæ­å»º</p>
</li>
<li>
<pre><code class="language-shell"># ä¸Šä¼ å®‰è£…åŒ…
# unzip rocketmq-all-4.4.0-bin-release.zip
# mv rocketmq-all-4.4.0-bin-release rocketmq
# è¿™æ—¶è¿›å»bin ç›®å½•è·Ÿç€ demo èµ°ä¸€éå°±è¡Œäº†,å·²ç»OK äº†
</code></pre>
</li>
<li>
<p>å¿«é€Ÿå¼€å§‹(å®˜ç½‘demoè‡ªå·±è·Ÿç€æ•²)     <a href="https://rocketmq.apache.org/docs/quick-start/">æµ‹è¯•demo</a></p>
</li>
</ul>
<h2 id="2-æ­å»ºæœåŠ¡">2. æ­å»ºæœåŠ¡</h2>
<ul>
<li>
<p>ä¿®æ”¹ conf/2m-2s-sync/broker-a.properties æ–‡ä»¶ (æ–‡ç« æœ€åæœ‰é…ç½®æ–‡ä»¶è¯¦æƒ…)</p>
</li>
<li>
<p>ä¿®æ”¹ conf/2m-2s-sync/broker-b-s.properties æ–‡ä»¶</p>
</li>
<li>
<p>æ³¨æ„ é›†ç¾¤è‡³å°‘ä¸¤å°æœºå™¨,å¦è€…æ— æ³•å¯åŠ¨ (äººå®¶å·²ç»å†™äº† 2m-2säº† )</p>
</li>
<li>
<p>æ–°å»ºç›®å½•</p>
</li>
<li>
<pre><code class="language-shell">[root@iz2zegua78a74kqn8clokfz rocketmq]# mkdir store
[root@iz2zegua78a74kqn8clokfz rocketmq]# cd store/
[root@iz2zegua78a74kqn8clokfz store]# ll
total 0
[root@iz2zegua78a74kqn8clokfz store]# mkdir commitlog
[root@iz2zegua78a74kqn8clokfz store]# mkdir consumequeue
[root@iz2zegua78a74kqn8clokfz store]# mkdir index
[root@iz2zegua78a74kqn8clokfz store]# mkdir checkpoint
[root@iz2zegua78a74kqn8clokfz store]# mkdir abort
</code></pre>
</li>
<li>
<p>è¿›å…¥confç›®å½•æ‰§è¡Œ <code>sed -i 's#${user.home}#/opt/rocketmq#g' *.xml</code> ä¿®æ”¹logbackçš„æ—¥å¿—æ–‡ä»¶ä½ç½®</p>
</li>
<li>
<p>è¿›å…¥ /binç›®å½•ä¸‹  ä¿®æ”¹ <code>runbroker.sh</code> å’Œ <code>runserver.sh</code> æ–‡ä»¶çš„ jvmå†…å­˜å¤§å°,æ ¹æ®ç”µè„‘å†…å­˜å¤§å°åˆ†é…</p>
</li>
<li>
<p>å»ºç«‹mqshutdown è½¯é“¾æ¥ <code>ln -s /opt/rocketmq/bin/mqshutdown /usr/local/bin/mqshutdown</code></p>
</li>
<li>
<p>å•æœºå¯åŠ¨æ—¶å°±ç›´æ¥è¿™æ ·å­å°±è¡Œ</p>
<ul>
<li><code>nohup sh mqnamesrv &amp;</code></li>
<li><code>nohup sh mqbroker -c ../conf/broker.conf -n 47.94.234.232:9876 &amp;</code></li>
<li><code>jps</code> æŸ¥çœ‹è¿›ç¨‹ ,æœ‰ ä¸¤ä¸ª  å°± æˆåŠŸäº† ä¸€ä¸ªæ˜¯ <strong>NamesrvStartup</strong> ,å¦å¤–ä¸€ä¸ªæ˜¯ <strong>BrokerStartup</strong></li>
<li>ç„¶å ç”¨ <code>netstat -nlp |grep LISTEN</code>  æŸ¥çœ‹ç«¯å£,è®°å¾—å¼€æ”¾å…¨éƒ¨è¿™äº›ç«¯å£,ä¸ç„¶æ— æ³•è¿è¡Œ</li>
</ul>
</li>
<li>
<p>å…³é—­</p>
<ul>
<li>mqshutdown namesrv</li>
<li>mqshutdown broker</li>
</ul>
</li>
</ul>
<h2 id="2-rocketmq-ä¸­-ç›¸å…³æ¦‚å¿µ">2. rocketmq ä¸­ ç›¸å…³æ¦‚å¿µ</h2>
<ul>
<li>å›¾</li>
</ul>
<h3 id="1name-server">1.Name Server</h3>
<p>â€‹		å®ƒæ˜¯ä¸€ä¸ªå‡ ä¹æ— çŠ¶æ€èŠ‚ç‚¹(å„ä¸ªnameserveréƒ½ä¸€æ ·ä¸Šé¢çš„ä¿¡æ¯)ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚æ˜¯ä¸“ä¸º RocketMQè®¾è®¡çš„è½»é‡çº§åç§°æœåŠ¡ï¼Œä»£ç å°äº1000è¡Œï¼Œå…·æœ‰ç®€å•ã€å¯é›†ç¾¤æ¨ªåæ‰©å±•ã€æ— çŠ¶æ€ç­‰ç‰¹ç‚¹ã€‚å°†è¦æ”¯æŒçš„ä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢åŠŸèƒ½ä¼šå¼ºä¾èµ– Name Serverã€‚æ‰€ä»¥ä»–æ”¾å¼ƒäº†é€‰æ‹©Zookeeperè¿™ä¸ªç®¡ç†å·¥å…·.</p>
<p>â€‹		Namesrvå‹åŠ›ä¸ä¼šå¤ªå¤§ï¼Œå¹³æ—¶ä¸»è¦å¼€é”€æ˜¯åœ¨<strong>ç»´æŒå¿ƒè·³</strong>å’Œæä¾›<strong>Topic-Broker</strong>çš„å…³ç³»æ•°æ®ã€‚</p>
<p>â€‹		ä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒBrokerå‘Namesrvå‘å¿ƒè·³æ—¶ï¼Œ ä¼šå¸¦ä¸Šå½“å‰è‡ªå·±æ‰€è´Ÿè´£çš„æ‰€æœ‰Topicä¿¡æ¯ï¼Œå¦‚æœTopicä¸ªæ•°å¤ªå¤šï¼ˆä¸‡çº§åˆ«ï¼‰ï¼Œä¼šå¯¼è‡´ä¸€æ¬¡å¿ƒè·³ä¸­ï¼Œå°±Topicçš„æ•°æ®å°±å‡ åMï¼Œç½‘ç»œæƒ…å†µå·®çš„è¯ï¼Œ ç½‘ç»œä¼ è¾“å¤±è´¥ï¼Œå¿ƒè·³å¤±è´¥ï¼Œå¯¼è‡´Namesrvè¯¯è®¤ä¸ºBrokerå¿ƒè·³å¤±è´¥ã€‚</p>
<h3 id="2-broker">2. Broker</h3>
<p>â€‹		Broker éƒ¨ç½²ç›¸å¯¹å¤æ‚ï¼ŒBrokeråˆ†ä¸ºMasterä¸Slaveï¼Œä¸€ä¸ªMasterå¯ä»¥å¯¹åº”å¤šä¸ªSlaveï¼Œä½†æ˜¯ä¸€ä¸ªSlaveåªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼ŒMasterä¸Slaveçš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„BrokerNameï¼Œä¸åŒçš„BrokerIdæ¥å®šä¹‰ï¼ŒBrokerIdä¸º0è¡¨ç¤ºMasterï¼Œé0è¡¨ç¤ºSlaveã€‚</p>
<p>â€‹	 å•ä¸ªBrokerè·Ÿæ‰€æœ‰Namesrvä¿æŒå¿ƒè·³è¯·æ±‚ï¼Œå¿ƒè·³é—´éš”ä¸º30ç§’ï¼Œå¿ƒè·³è¯·æ±‚ä¸­åŒ…æ‹¬å½“å‰Brokeræ‰€æœ‰çš„Topicä¿¡æ¯ã€‚Namesrvä¼šåæŸ¥Broerçš„å¿ƒè·³ä¿¡æ¯ï¼Œ å¦‚æœæŸä¸ªBrokeråœ¨2åˆ†é’Ÿä¹‹å†…éƒ½æ²¡æœ‰å¿ƒè·³ï¼Œåˆ™è®¤ä¸ºè¯¥Brokerä¸‹çº¿.</p>
<p>â€‹	åŒç† ä»–ä»¬ä¹‹é—´å„ç§å…³ç³»éƒ½æ˜¯è¿™ç§å¿ƒè·³æ£€æµ‹æœºåˆ¶,ä¸‹é¢ä¸æè¿°äº†.</p>
<h3 id="3producer">3.Producer</h3>
<p>â€‹		Producer ä¸Name Serveré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼Œä½†ä¸åŒäºä¸Šä¸€æ¬¡ï¼‰å»ºç«‹<strong>é•¿è¿æ¥</strong>ï¼Œæ¯30ç§’ä»Namesrvè·å–Topicè·ŸBrokerçš„æ˜ å°„å…³ç³»ï¼Œæ›´æ–°åˆ°æœ¬åœ°å†…å­˜ä¸­ã€‚å†è·ŸTopicæ¶‰åŠçš„æ‰€æœ‰Brokerå»ºç«‹é•¿è¿æ¥ï¼Œæ¯éš”30ç§’å‘ä¸€æ¬¡å¿ƒè·³ã€‚åœ¨Brokerç«¯ä¹Ÿä¼šæ¯10ç§’æ‰«æä¸€æ¬¡å½“å‰æ³¨å†Œçš„Producerï¼Œå¦‚æœå‘ç°æŸä¸ªProducerè¶…è¿‡2åˆ†é’Ÿéƒ½æ²¡æœ‰å‘å¿ƒè·³ï¼Œåˆ™æ–­å¼€è¿æ¥ã€‚</p>
<p>â€‹		Producer å‘é€æ—¶ï¼Œä¼š<strong>è‡ªåŠ¨è½®è¯¢å½“å‰æ‰€æœ‰å¯å‘é€çš„broker</strong>ï¼Œä¸€æ¡æ¶ˆæ¯å‘é€æˆåŠŸï¼Œä¸‹æ¬¡æ¢å¦å¤–ä¸€ä¸ªbrokerå‘é€ï¼Œä»¥è¾¾åˆ°æ¶ˆæ¯å¹³å‡è½åˆ°æ‰€æœ‰çš„brokerä¸Šã€‚(è¿™ä¸ªç±»ä¼¼ä¸<strong>è´Ÿè½½å‡è¡¡</strong>)</p>
<p>â€‹		å‡å¦‚æŸä¸ªBrokerå®•æœºï¼Œæ„å‘³ç”Ÿäº§è€…æœ€é•¿éœ€è¦30ç§’æ‰èƒ½æ„ŸçŸ¥åˆ°ã€‚åœ¨è¿™æœŸé—´ä¼šå‘å®•æœºçš„Brokerå‘é€æ¶ˆæ¯ã€‚å½“ä¸€æ¡æ¶ˆæ¯å‘é€åˆ°æŸä¸ªBrokerå¤±è´¥åï¼Œä¼šå¾€è¯¥brokerè‡ªåŠ¨å†é‡å‘2æ¬¡ï¼Œå‡å¦‚è¿˜æ˜¯å‘é€å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå‘é€å¤±è´¥å¼‚å¸¸ã€‚ä¸šåŠ¡æ•è·å¼‚å¸¸ï¼Œé‡æ–°å‘é€å³å¯ã€‚å®¢æˆ·ç«¯é‡Œä¼šè‡ªåŠ¨è½®è¯¢å¦å¤–ä¸€ä¸ªBrokeré‡æ–°å‘é€ï¼Œè¿™ä¸ªå¯¹äºç”¨æˆ·æ˜¯é€æ˜çš„ã€‚</p>
<h3 id="4consumer">4.consumer</h3>
<p>â€‹		Consumer ä¸ Name Server é›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä» Name Server å– Topic è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾› Topic æœåŠ¡çš„ Masterã€Slave å»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘ Masterã€Slave å‘é€å¿ƒè·³ã€‚Consumeræ—¢å¯ä»¥ä» Master è®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä» Slave è®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…è§„åˆ™ç”± Broker é…ç½®å†³å®šã€‚</p>
<ul>
<li>
<p>æ¶ˆè´¹ç«¯ æ¥æ”¶æ¶ˆæ¯åˆ†ä¸ºä¸¤ç§æ¨¡å¼ :</p>
<ul>
<li><strong>å¹¿æ’­æ¨¡å¼</strong>  (rocketmqä¼šå°†<strong>æ¶ˆæ¯å‘é€ç»™groupä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…</strong>ï¼Œå¦‚æœè¿™ç§æ¨¡å¼åœ¨å…¬å¸çš„é¡¹ç›®ä¸­ï¼Œä¼šé€ æˆæ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œç†è®ºä¸Šä¼šæœ‰N-1æ¬¡é‡å¤æ¶ˆè´¹ï¼Œé‚£ä¹ˆrocketmqä¸ºä»€ä¹ˆè¿˜ä¼šä¿ç•™è¿™ç§æ¶ˆè´¹æ¨¡å¼å‘¢ï¼Ÿå­˜åœ¨å¿…æœ‰å®ƒçš„é“ç†ï¼Œæ¯”æ–¹è¯´ï¼Œ<strong>å¦‚æœéœ€è¦åŠ¨æ€æ›´ç»†ä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå°†æ–°çš„é…ç½®æ¨é€ç»™groupä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ—¶å€™å¹¿æ’­æ¶ˆè´¹å°±å‘æŒ¥å®ƒçš„ç‹¬åˆ°ä¹‹å¤„äº†</strong>)</li>
<li><strong>é›†ç¾¤æ¶ˆè´¹</strong>(é»˜è®¤æ–¹å¼)  é›†ç¾¤æ¶ˆè´¹æ˜¯ç”¨çš„æœ€å¹¿æ³›çš„ä¸€ç§æ¶ˆè´¹æ¨¡å¼ï¼Œåœ¨é›†ç¾¤æ¶ˆè´¹æ¨¡å¼ä¸‹ï¼ŒåŒä¸€æ¡æ¶ˆæ¯ï¼Œ<strong>åªèƒ½è¢«groupä¸­çš„ä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</strong>ï¼Œè¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ï¼Œè¿™æ˜¯ä¸å¹¿æ’­æ¶ˆè´¹çš„æœ€æ˜æ˜¾åŒºåˆ«ã€‚</li>
</ul>
</li>
<li>
<p>RocketMQä¸­Consumeræœ‰ä¸¤ç§å®ç°ï¼šPushConsumerå’ŒPullConsumerã€‚</p>
<ul>
<li>
<p><strong>PushConsumer</strong>(ç”±brokerè¿›è¡Œæ¨é€)</p>
<p>æ¨é€æ¨¡å¼ï¼ˆè™½ç„¶RocketMQä½¿ç”¨çš„æ˜¯é•¿è½®è¯¢ï¼‰çš„æ¶ˆè´¹è€…ã€‚æ¶ˆæ¯çš„èƒ½åŠæ—¶è¢«æ¶ˆè´¹ã€‚ä½¿ç”¨éå¸¸ç®€å•ï¼Œå†…éƒ¨å·²å¤„ç†å¦‚çº¿ç¨‹æ± æ¶ˆè´¹ã€æµæ§ã€è´Ÿè½½å‡è¡¡ã€å¼‚å¸¸å¤„ç†ç­‰ç­‰çš„å„ç§åœºæ™¯ã€‚</p>
</li>
<li>
<p><strong>PullConsumer</strong>(è‡ªå·±æ‹‰å»,éœ€è¦æ‰‹åŠ¨å¤„ç†)</p>
</li>
<li>
<p>æ‹‰å–æ¨¡å¼çš„æ¶ˆè´¹è€…ã€‚åº”ç”¨ä¸»åŠ¨æ§åˆ¶æ‹‰å–çš„æ—¶æœºï¼Œæ€ä¹ˆæ‹‰å–ï¼Œæ€ä¹ˆæ¶ˆè´¹ç­‰ã€‚ä¸»åŠ¨æƒæ›´é«˜ã€‚ä½†è¦è‡ªå·±å¤„ç†å„ç§åœºæ™¯ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="5group">5.Group</h3>
<p>â€‹	æ ‡è¯†å‘é€åŒä¸€ç±»æ¶ˆæ¯çš„Producerï¼Œé€šå¸¸å‘é€é€»è¾‘ä¸€è‡´ã€‚å‘é€æ™®é€šæ¶ˆæ¯çš„æ—¶å€™ï¼Œä»…æ ‡è¯†ä½¿ç”¨ï¼Œå¹¶æ— ç‰¹åˆ«ç”¨å¤„ã€‚</p>
<p>â€‹	 <strong>RocketMQè¦æ±‚åŒä¸€ä¸ªConsumer Groupçš„æ¶ˆè´¹è€…å¿…é¡»è¦æ‹¥æœ‰ç›¸åŒçš„æ³¨å†Œä¿¡æ¯ï¼Œå³å¿…é¡»è¦å¬ä¸€æ ·çš„topic(å¹¶ä¸”tagä¹Ÿä¸€æ ·)ã€‚</strong></p>
<h3 id="6topic">6.Topic</h3>
<p>â€‹		æ¯ä¸ªä¸»é¢˜å¯è®¾ç½®é˜Ÿåˆ—ä¸ªæ•°ï¼Œè‡ªåŠ¨åˆ›å»ºä¸»é¢˜æ—¶é»˜è®¤æ˜¯4ä¸ªå¤šåˆ—. Brokerä¸Šå­˜Topicä¿¡æ¯ï¼ŒTopicç”±å¤šä¸ªé˜Ÿåˆ—ç»„æˆï¼Œé˜Ÿåˆ—ä¼šå¹³å‡åˆ†æ•£åœ¨å¤šä¸ªBrokerä¸Šã€‚</p>
<h3 id="7-tag">7. tag</h3>
<p>â€‹		RocketMQæ”¯æŒç»™åœ¨å‘é€çš„æ—¶å€™ç»™topicæ‰“tagï¼ŒåŒä¸€ä¸ªtopicçš„æ¶ˆæ¯è™½ç„¶é€»è¾‘ç®¡ç†æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯æ¶ˆè´¹topic1çš„æ—¶å€™ï¼Œå¦‚æœä½ è®¢é˜…çš„æ—¶å€™æŒ‡å®šçš„æ˜¯tagAï¼Œé‚£ä¹ˆtagBçš„æ¶ˆæ¯å°†ä¸ä¼šæŠ•é€’ã€‚</p>
<h3 id="8-message-queue">8. Message Queue</h3>
<p>â€‹		æ¶ˆæ¯ç‰©ç†ç®¡ç†å•ä½ã€‚ä¸€ä¸ªTopicå°†æœ‰è‹¥å¹²ä¸ªQ(é»˜è®¤4æ¡)ã€‚è‹¥TopicåŒæ—¶åˆ›å»ºåœ¨ä¸åŒçš„Brokerï¼Œåˆ™ä¸åŒçš„brokerä¸Šéƒ½æœ‰è‹¥å¹²Qï¼Œæ¶ˆæ¯å°†ç‰©ç†åœ°å­˜å‚¨è½åœ¨ä¸åŒBrokerç»“ç‚¹ä¸Šï¼Œå…·æœ‰æ°´å¹³æ‰©å±•çš„èƒ½åŠ›ã€‚</p>
<h3 id="9-offset">9. offset</h3>
<h3 id="10-æ€»ç»“">10. æ€»ç»“</h3>
<p>â€‹		RocketMQçš„é«˜æ€§èƒ½åœ¨äºé¡ºåºå†™ç›˜(CommitLog)ã€é›¶æ‹·è´å’Œè·³è·ƒè¯»(å°½é‡å‘½ä¸­PageCache)ï¼Œé«˜å¯é æ€§åœ¨äºåˆ·ç›˜å’ŒMaster/Slaveï¼Œå¦å¤–NameServer å…¨éƒ¨æŒ‚æ‰ä¸å½±å“å·²ç»è¿è¡Œçš„Broker,Producer,Consumerã€‚</p>
<p>â€‹	æœ€æ–°ç‰ˆRocketMQå·²ç»å¯ä»¥æ”¯æŒProtobufåè®®ï¼Œä½†æœ¬æ–‡åªæ¢ç©¶é»˜è®¤çš„åŸºäºJSONçš„åè®®ã€‚</p>
<h2 id="3-rocketmq-çš„åŸºæœ¬ç”¨æ³•">3. rocketmq çš„åŸºæœ¬ç”¨æ³•</h2>
<ul>
<li><a href="https://github.com/Anthony-Dong/rocketmq-practice">githubé¡¹ç›®åœ°å€,æ‰€æœ‰demoéƒ½åœ¨é‡Œé¢</a></li>
</ul>
<h3 id="1-å¯¼å…¥mavenåæ ‡">1. å¯¼å…¥mavenåæ ‡</h3>
<pre><code class="language-java">        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
            &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt;
            &lt;version&gt;4.4.0&lt;/version&gt;
        &lt;/dependency&gt;
        
            æœ€å¥½å’Œä½ çš„ rocketmqçš„ç‰ˆæœ¬ä¸€è‡´
</code></pre>
<h3 id="2-æä¾›æ–¹ä»£ç ">2. æä¾›æ–¹ä»£ç </h3>
<pre><code class="language-java">        // 1.åˆ›å»ºç”Ÿæˆè€…å¯¹è±¡
        DefaultMQProducer producer = new DefaultMQProducer(&quot;demo-produce&quot;);
        producer.setVipChannelEnabled(false);
        producer.setNamesrvAddr(&quot;192.168.58.129:9876&quot;);

        //2. å¼€å¯produce
        producer.start();

        //3. åˆ›å»ºæ¶ˆæ¯å¯¹è±¡
        Message message = new Message(&quot;SyncProducer&quot;,//ä¸»é¢˜
                &quot;tag&quot;, //æ ‡ç­¾
                &quot;keys&quot;, //key æ¶ˆæ¯å”¯ä¸€å€¼
                &quot;hello&quot;.getBytes(RemotingHelper.DEFAULT_CHARSET)//å‘é€å†…å®¹
                );

        //4. å‘é€åŒæ­¥æ¶ˆæ¯æ¶ˆæ¯
        SendResult send = producer.send(message);

        //5. å…³é—­è¿æ¥(æœ€å¥½æ•´ä¸€ä¸ªè¿æ¥æ± )
        producer.shutdown();
</code></pre>
<h3 id="3-æ¶ˆè´¹æ–¹ä»£ç ">3. æ¶ˆè´¹æ–¹ä»£ç </h3>
<pre><code class="language-java">
        //1. åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡
        DefaultMQPushConsumer consumer = new DefaultMQPushConsumer(&quot;demo-consumer&quot;);

        // 2. æŒ‡å®š nameserver åœ°å€(åœ°å€ä¹Ÿå¯ä»¥å†™å¤šä¸ª,ç”¨';'éš”å¼€)
        consumer.setNamesrvAddr(&quot;47.94.234.232:9876&quot;);

        // 3. è®¾ç½®ä¸»é¢˜,æŒ‡å®štopic, tag(å¯ä»¥é€‰å¤šä¸ª , ç”¨ ' || ' éš”å¼€)
        consumer.subscribe(&quot;AsyncProducer&quot;, &quot;*&quot;);

        //4. å¼€å¯æ¶ˆæ¯ç›‘å¬,è®¾ç½®å›è°ƒå‡½æ•°,å¤„ç†æ¶ˆæ¯ (è¿™é‡Œä¸åŒºåˆ† å¼‚æ­¥,åŒæ­¥ ,å•å‘å‘é€)
        consumer.registerMessageListener(new MessageListenerConcurrently() {
            @Override
            public ConsumeConcurrentlyStatus consumeMessage(List&lt;MessageExt&gt; list, 		ConsumeConcurrentlyContext consumeConcurrentlyContext) {

                // MessageExt è¿”å›çš„  body æ˜¯ä¸€ä¸ª byte[] éœ€è¦ åšè½¬æ¢
                list.forEach((e)-&gt;{
                    String msg = new String(e.getBody());
                    System.out.println(msg);
                });
                // æŒ‡å®šæ¶ˆè´¹æˆåŠŸåçš„åé¦ˆçŠ¶æ€
                return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
            }
        });
        // 5.å¼€å¯æ¶ˆè´¹
        consumer.start();
</code></pre>
<blockquote>
<p>æˆ‘ä»¬å‘ç°ä»£ç éƒ½æ˜¯æ¨¡å—åŒ–çš„,æ‰€ä»¥åé¢æˆ‘é€‰æ‹©åªæˆªå–ç‰‡æ®µä»£ç ,æ•´ä¸ªdemoä¼šæ”¾åˆ°githubä¸Š</p>
</blockquote>
<h2 id="4-rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€æ–¹å¼">4. rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€æ–¹å¼</h2>
<h3 id="1å‘é€åŒæ­¥æ¶ˆæ¯">1.å‘é€åŒæ­¥æ¶ˆæ¯</h3>
<pre><code>  		4. å‘é€åŒæ­¥æ¶ˆæ¯æ¶ˆæ¯
        SendResult send = producer.send(message);
        
        åŒæ­¥å‘é€æ˜¯æŒ‡æ¶ˆæ¯å‘é€æ–¹å‘å‡ºæ•°æ®åï¼Œä¼šåœ¨æ”¶åˆ°æ¥æ”¶æ–¹å‘å›å“åº”ä¹‹åæ‰å‘ä¸‹ä¸€ä¸ªæ•°æ®åŒ…çš„é€šè®¯æ–¹å¼ã€‚
        æ­¤ç§æ–¹å¼åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œä¾‹å¦‚é‡è¦é€šçŸ¥é‚®ä»¶ã€æŠ¥åçŸ­ä¿¡é€šçŸ¥ã€è¥é”€çŸ­ä¿¡ç³»ç»Ÿç­‰ã€‚
  		   
</code></pre>
<h3 id="2-å‘é€å¼‚æ­¥æ¶ˆæ¯">2. å‘é€å¼‚æ­¥æ¶ˆæ¯</h3>
<pre><code class="language-java">        //4. å‘é€å¼‚æ­¥æ¶ˆæ¯
        // SendCallback æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°
        producer.send(message, new SendCallback() {
            @Override
            public void onSuccess(SendResult sendResult) {
                System.out.println(sendResult);
            }
            
            @Override
            public void onException(Throwable throwable) {
                System.out.println(&quot;å‘é€å¤±è´¥,å‡ºç°å¼‚å¸¸&quot;);
            }
        });
	å¼‚æ­¥å‘é€æ˜¯æŒ‡å‘é€æ–¹å‘å‡ºæ•°æ®åï¼Œä¸ç­‰æ¥æ”¶æ–¹å‘å›å“åº”ï¼Œæ¥ç€å‘é€ä¸‹ä¸ªæ•°æ®åŒ…çš„é€šè®¯æ–¹å¼ã€‚ 	
	 é€šå¸¸ç”¨äºå¯¹å‘é€æ¶ˆæ¯å“åº”æ—¶é—´è¦æ±‚æ›´é«˜/æ›´å¿«çš„åœºæ™¯ï¼š
</code></pre>
<h3 id="3-å‘é€å•å‘æ¶ˆæ¯åªè´Ÿè´£å‘é€ä¸ç®¡æ˜¯å¦æ”¶åˆ°æ— è¿”å›å€¼">3. å‘é€å•å‘æ¶ˆæ¯(åªè´Ÿè´£å‘é€,ä¸ç®¡æ˜¯å¦æ”¶åˆ°,æ— è¿”å›å€¼)</h3>
<pre><code class="language-java">producer.sendOneway(message);
</code></pre>
<h2 id="5-rocketmq-çš„å‘é€æ–¹å¼">5. rocketmq çš„å‘é€æ–¹å¼</h2>
<h3 id="1-å»¶è¿Ÿå‘é€">1. å»¶è¿Ÿå‘é€</h3>
<pre><code class="language-java">  message.setDelayTimeLevel(2);

(messageDelayLevel = &quot;1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h&quot;)
è¿™ä¸ªä¸å¯ä»¥è‡ªå®šä¹‰(custom) åªèƒ½ä»1å¼€å§‹é€‰æ‹©å¯¹äºçš„level
</code></pre>
<h3 id="2-å‘é€æ‰¹é‡æ¶ˆæ¯æ³¨æ„å‘é€çš„å¤§å°å¤ªå¤§æ³¨æ„è¶…æ—¶æ—¶é—´é—®é¢˜">2. å‘é€æ‰¹é‡æ¶ˆæ¯(æ³¨æ„å‘é€çš„å¤§å°,å¤ªå¤§æ³¨æ„è¶…æ—¶æ—¶é—´é—®é¢˜)</h3>
<pre><code class="language-java">   public SendResult send(Collection&lt;Message&gt; msgs)
      
    public SendResult send(Collection&lt;Message&gt; msgs, long timeout)   
      
	public SendResult send(Collection&lt;Message&gt; msgs, MessageQueue messageQueue,long timeout)  é¡ºåºå‘é€å°±éœ€è¦æŒ‡å®šè¿™ä¸ª MessageQueue
    
     //	sendCallback Callback to execute on sending completed, either successful or unsuccessful.
     public void send(Message msg, SendCallback sendCallback)
      
      
      å¤ªå¤šäº†æˆ‘å°±ä¸ä¸¾ä¾‹å­äº†å¤§æ¦‚è¿™äº› 
</code></pre>
<h3 id="3è¿‡æ»¤æ¶ˆæ¯">3.è¿‡æ»¤æ¶ˆæ¯</h3>
<pre><code class="language-java">        1. æ¶ˆè´¹æ–¹
		// 3. è®¾ç½®æ¶ˆæ¯çš„æè¿°,
        // æŒ‡å®štopic, tag(å¯ä»¥é€‰å¤šä¸ª) ,è¿™é‡Œæ‰§è¡Œè¿‡æ»¤æ–¹æ³•
        // 3.1  || è¡¨ç¤ºé€‰æ‹©
        // 3.2  &quot;*&quot;  å…¨éƒ¨çš„tag
        // 3.3  MessageSelector.bySql()  ç‰¹æ®Šé€‰æ‹© sqlè¯­æ³•,å¯ä»¥å» å®˜ç½‘å»çœ‹
        // consumer.subscribe(&quot;FilterTopic&quot;, &quot;tag || tag2&quot;);
        // consumer.subscribe(&quot;FilterTopic&quot;, &quot;*&quot;);
        // MessageSelector.bySql(&quot;key&gt;8&quot;)
		consumer.subscribe(&quot;FilterTopic&quot;, &quot;*&quot;);

		2. æä¾›æ–¹ 
		// è®¾ç½®ç‰¹æ®Šå±æ€§
        message.putUserProperty(&quot;key&quot;, &quot;10&quot;);
</code></pre>
<h3 id="4-é¡ºåºå‘é€é˜Ÿåˆ—æ˜¯å¤šæ¡æ¶ˆè´¹æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ¥æ”¶å¦‚ä½•ä¿è¯">4. é¡ºåºå‘é€(é˜Ÿåˆ—æ˜¯å¤šæ¡,æ¶ˆè´¹æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ¥æ”¶,å¦‚ä½•ä¿è¯)</h3>
<pre><code class="language-java"> 
1. æä¾›æ–¹: ä¸»è¦æ˜¯ä¾é äº†åªå‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­
producer.send(message, new MessageQueueSelector() {
                /**
                 * æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©å™¨ MessageQueueSelector
                 *
                 * @param list      æ¶ˆæ¯é˜Ÿåˆ—é›†åˆ(ä¿è¯é€‰æ‹© ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—)
                 * @param message   æ‰€è¦å‘é€çš„æ¶ˆæ¯
                 * @param o         keyå€¼(è¦ä¿è¯ä½ çš„é¡ºåºé˜Ÿåˆ—æŒæœ‰ä¸€ä¸ªç›¸åŒçš„keyå€¼,æˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯è®¢å•å¯¹è±¡çš„hashå€¼)
                 * @return
                 */
                @Override
                public MessageQueue select(List&lt;MessageQueue&gt; list, Message message, Object o) {
                    int size = list.size();
                    Integer key = (Integer) o;
                    MessageQueue messageQueue = list.get(key % size);
                    return messageQueue;
                }
            }, list.hashCode());

2.æ¶ˆè´¹æ–¹ å•çº¿ç¨‹æ¶ˆè´¹ 

        consumer.registerMessageListener(new MessageListenerOrderly() {
            @Override
            public ConsumeOrderlyStatus consumeMessage(List&lt;MessageExt&gt; list, ConsumeOrderlyContext consumeOrderlyContext) {
                list.forEach((e)-&gt;{
                    System.out.println(&quot;çº¿ç¨‹åç§°: &quot;+Thread.currentThread().getName());
                    System.out.println(&quot;æ¶ˆæ¯&quot;+new String(e.getBody()));
                });
                System.out.println(&quot;å‘é€æˆåŠŸ&quot;);
                return ConsumeOrderlyStatus.SUCCESS;
            }
        });

</code></pre>
<h3 id="5-äº‹åŠ¡æ§åˆ¶">5. äº‹åŠ¡æ§åˆ¶</h3>
<ul>
<li><img src="https://tyut.oss-cn-beijing.aliyuncs.com/image/2019-09-14/114f2cce-77f6-4c4b-9ca5-e1f228b20523.png?x-oss-process=style/template01" alt="" loading="lazy"></li>
</ul>
<pre><code class="language-java">è¿™æ—¶å€™å°±éœ€è¦TransactionMQProducer
TransactionMQProducer producer = new TransactionMQProducer(&quot;demo-produce&quot;);



        // 2. è®¾ç½® äº‹åŠ¡ç›‘å¬å™¨(å¯¹äº‹ç‰©çš„æ§åˆ¶) æ¯å½“å‘é€æ¶ˆæ¯éƒ½ä¼šæ‰§è¡Œè¿™ä¸€æ­¥
        producer.setTransactionListener(new TransactionListener() {
            /**
             *  æ‰§è¡Œçš„ äº‹åŠ¡æ–¹æ³• ,å¦‚æœ çŠ¶æ€ä¸º UNKNOW  ä¼šè°ƒç”¨ checkLocalTransactionè¿›è¡Œåˆ¤æ–­
             * @param message  æ¶ˆæ¯å¯¹è±¡( Half(prepare) message)
             * @param o        o æ˜¯ è‡ªå®šä¹‰çš„æ¶ˆæ¯å‚æ•° ( Custom business parameter)
             * @return  COMMIT_MESSAGE æäº¤
             *          ROLLBACK_MESSAGE  å›æ»š
             *          UNKNOW  æœªå¤„ç†çš„çŠ¶æ€ , ç­‰å¾…checkLocalTransactionè°ƒç”¨
             */
            @Override
            public LocalTransactionState executeLocalTransaction(Message message, Object o) {
                if (StringUtils.equals(message.getTags(), &quot;TAG1&quot;)) {
                    System.out.println(message.getTags());
                    return LocalTransactionState.COMMIT_MESSAGE;
                }
                if (StringUtils.equals(message.getTags(), &quot;TAG2&quot;)) {
                    System.out.println(message.getTags());
                    return LocalTransactionState.ROLLBACK_MESSAGE;
                }
                    System.out.println(message.getTags());
                    return LocalTransactionState.UNKNOW;

            }

            /**
             *
             * è¿›è¡Œå¯¹UNKNOWçŠ¶æ€çš„æ£€æµ‹
             * @param messageExt
             * @return
             */
            @Override
            public LocalTransactionState checkLocalTransaction(MessageExt messageExt) {
                return LocalTransactionState.COMMIT_MESSAGE;
            }
        });

</code></pre>
<h3 id="6-springbootæ•´åˆrocketmq">6. springbootæ•´åˆrocketmq</h3>
<ul>
<li>
<p>https://github.com/apache/rocketmq-spring  ä¸‹è½½åœ°å€è·Ÿç€è·‘ä¸€è¾¹</p>
</li>
<li>
<p>å¦‚æœå¤§å®¶ä¸ä¼šæ•´,æˆ‘ä¼šæŠŠdemoæ•´ä¸ªä¸Šä¼ åˆ°githubä¸Š</p>
<pre><code class="language-shell">mvn clean

mvn package -Dmaven.test.skip=true

mvn install:install-file -Dfile=D:\ä»£ç åº“\alibaba-package\springboot-rocketmq\rocketmq-spring\rocketmq-spring-boot\target\rocketmq-spring-boot-2.0.4-SNAPSHOT.jar  -DgroupId=org.apache.rocketmq -DartifactId=rocketmq-spring-boot-starter  -Dversion=2.0.4-SNAPSHOT -Dpackaging=jar

</code></pre>
</li>
<li>
<p><a href="https://github.com/apache/rocketmq-spring">å¿«é€Ÿå¼€å§‹è·Ÿç€</a>  è·Ÿç€è¿™ä¸ªæ•²ä¸€è¾¹å°±è¡Œäº† æˆ‘çš„demoä¹Ÿæ˜¯è·Ÿç€è¿™ä¸ªèµ°çš„</p>
</li>
<li>
<p>å…³äº<a href="https://blog.csdn.net/prestigeding/article/details/94317946">RocketMQ ACLçš„ä½¿ç”¨æŒ‡å—</a>  ä¸æ‡‚çš„çœ‹ä¸€ä¸‹å…¶å®å°±æ˜¯ä¸€ä¸ªæƒé™æ§åˆ¶(access control list),é»˜è®¤ å¯†ç æ˜¯AK , AS</p>
</li>
</ul>
<h2 id="qa">QA</h2>
<p>å¤§å®¶å¯ä»¥å»å‚è€ƒ  <a href="https://zhuanlan.zhihu.com/rocketmq"> è¿™ä¸ªé“¾æ¥  </a>  ,é‡Œé¢è®²çš„ç›¸å½“è¯¦ç»†</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">ä¸ºä»€ä¹ˆé€‰æ‹©æ¶ˆæ¯é˜Ÿåˆ—</a></li>
<li><a href="#1%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83">1.é…ç½®ç¯å¢ƒ</a></li>
<li><a href="#2-%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1">2. æ­å»ºæœåŠ¡</a></li>
<li><a href="#2-rocketmq-%E4%B8%AD-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5">2. rocketmq ä¸­ ç›¸å…³æ¦‚å¿µ</a>
<ul>
<li><a href="#1name-server">1.Name Server</a></li>
<li><a href="#2-broker">2. Broker</a></li>
<li><a href="#3producer">3.Producer</a></li>
<li><a href="#4consumer">4.consumer</a></li>
<li><a href="#5group">5.Group</a></li>
<li><a href="#6topic">6.Topic</a></li>
<li><a href="#7-tag">7. tag</a></li>
<li><a href="#8-message-queue">8. Message Queue</a></li>
<li><a href="#9-offset">9. offset</a></li>
<li><a href="#10-%E6%80%BB%E7%BB%93">10. æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#3-rocketmq-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">3. rocketmq çš„åŸºæœ¬ç”¨æ³•</a>
<ul>
<li><a href="#1-%E5%AF%BC%E5%85%A5maven%E5%9D%90%E6%A0%87">1. å¯¼å…¥mavenåæ ‡</a></li>
<li><a href="#2-%E6%8F%90%E4%BE%9B%E6%96%B9%E4%BB%A3%E7%A0%81">2. æä¾›æ–¹ä»£ç </a></li>
<li><a href="#3-%E6%B6%88%E8%B4%B9%E6%96%B9%E4%BB%A3%E7%A0%81">3. æ¶ˆè´¹æ–¹ä»£ç </a></li>
</ul>
</li>
<li><a href="#4-rocketmq%E7%9A%84%E4%B8%89%E7%A7%8D%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%96%B9%E5%BC%8F">4. rocketmqçš„ä¸‰ç§æ¶ˆæ¯å‘é€æ–¹å¼</a>
<ul>
<li><a href="#1%E5%8F%91%E9%80%81%E5%90%8C%E6%AD%A5%E6%B6%88%E6%81%AF">1.å‘é€åŒæ­¥æ¶ˆæ¯</a></li>
<li><a href="#2-%E5%8F%91%E9%80%81%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF">2. å‘é€å¼‚æ­¥æ¶ˆæ¯</a></li>
<li><a href="#3-%E5%8F%91%E9%80%81%E5%8D%95%E5%90%91%E6%B6%88%E6%81%AF%E5%8F%AA%E8%B4%9F%E8%B4%A3%E5%8F%91%E9%80%81%E4%B8%8D%E7%AE%A1%E6%98%AF%E5%90%A6%E6%94%B6%E5%88%B0%E6%97%A0%E8%BF%94%E5%9B%9E%E5%80%BC">3. å‘é€å•å‘æ¶ˆæ¯(åªè´Ÿè´£å‘é€,ä¸ç®¡æ˜¯å¦æ”¶åˆ°,æ— è¿”å›å€¼)</a></li>
</ul>
</li>
<li><a href="#5-rocketmq-%E7%9A%84%E5%8F%91%E9%80%81%E6%96%B9%E5%BC%8F">5. rocketmq çš„å‘é€æ–¹å¼</a>
<ul>
<li><a href="#1-%E5%BB%B6%E8%BF%9F%E5%8F%91%E9%80%81">1. å»¶è¿Ÿå‘é€</a></li>
<li><a href="#2-%E5%8F%91%E9%80%81%E6%89%B9%E9%87%8F%E6%B6%88%E6%81%AF%E6%B3%A8%E6%84%8F%E5%8F%91%E9%80%81%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%A4%AA%E5%A4%A7%E6%B3%A8%E6%84%8F%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98">2. å‘é€æ‰¹é‡æ¶ˆæ¯(æ³¨æ„å‘é€çš„å¤§å°,å¤ªå¤§æ³¨æ„è¶…æ—¶æ—¶é—´é—®é¢˜)</a></li>
<li><a href="#3%E8%BF%87%E6%BB%A4%E6%B6%88%E6%81%AF">3.è¿‡æ»¤æ¶ˆæ¯</a></li>
<li><a href="#4-%E9%A1%BA%E5%BA%8F%E5%8F%91%E9%80%81%E9%98%9F%E5%88%97%E6%98%AF%E5%A4%9A%E6%9D%A1%E6%B6%88%E8%B4%B9%E6%98%AF%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E8%A1%8C%E6%8E%A5%E6%94%B6%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81">4. é¡ºåºå‘é€(é˜Ÿåˆ—æ˜¯å¤šæ¡,æ¶ˆè´¹æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ¥æ”¶,å¦‚ä½•ä¿è¯)</a></li>
<li><a href="#5-%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6">5. äº‹åŠ¡æ§åˆ¶</a></li>
<li><a href="#6-springboot%E6%95%B4%E5%90%88rocketmq">6. springbootæ•´åˆrocketmq</a></li>
</ul>
</li>
<li><a href="#qa">QA</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>