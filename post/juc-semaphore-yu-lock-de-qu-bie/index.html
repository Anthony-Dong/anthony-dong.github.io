<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>JUC - Semaphore ä¸ Lockçš„åŒºåˆ« | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/juc-semaphore-yu-lock-de-qu-bie/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223342286" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>JUC - Semaphore ä¸ Lockçš„åŒºåˆ«</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-10-27</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/juc-semaphore-yu-lock-de-qu-bie/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/38zE8aaGQ3X/"
								class="tag">JUC</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">1288å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">6 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<h2 id="ä»‹ç»">ä»‹ç»</h2>
<blockquote>
<p>â€‹	A counting semaphore.  Conceptually, a semaphore maintains a set of permits.</p>
<p>Semaphores are often used to restrict the number of threads than can access some (physical or logical) resource. For example, here is a class that uses a semaphore to control access to a pool of items:</p>
<p>â€‹	ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡.æ¦‚å¿µä¸Šå°†,ä¿¡å·é‡ç»´æŠ¤äº†ä¸€ç³»åˆ—çš„è®¸å¯è¯ . æ–‡æ¡£é‡Œè¿˜è¯´äº†semaphore é€šå¸¸è¢«ç”¨æ¥é™åˆ¶è®¿é—®ä¸€äº›èµ„æºçš„çº¿ç¨‹æ•°é‡. ä¾‹å¦‚ è¿™é‡Œæœ‰ä¸€ä¸ªç±»,å®ƒä½¿ç”¨<code>semaphore</code> å»æ§åˆ¶è®¿é—®itemsçš„æ± å­</p>
</blockquote>
<h2 id="semaphore-ä½¿ç”¨">Semaphore  ä½¿ç”¨</h2>
<h3 id="ç®€å•çœ‹çœ‹ä½¿ç”¨æƒ…å†µ">ç®€å•çœ‹çœ‹ä½¿ç”¨æƒ…å†µ</h3>
<pre><code class="language-java">public class TestSemaphore {

    public static void main(String[] args) {
        final Semaphore semaphore = new Semaphore(2);
        System.out.println(&quot;----------Semaphore-----------&quot;);
        IntStream.range(0, 4).forEach(i -&gt; new Thread(() -&gt; {
            System.out.println(Thread.currentThread().getName() + &quot;  å¼€å§‹&quot;);
            try {
                semaphore.acquire(); // è·å–æ‰€æœ‰è®¸å¯è¯ï¼ŒæŠ½å¹²

                System.out.println(Thread.currentThread().getName() + &quot;  è·å–è®¸å¯è¯&quot;);
                TimeUnit.SECONDS.sleep(3);
                System.out.println(Thread.currentThread().getName() + &quot;  ç­‰å¾…å®Œæ¯•&quot;);
            } catch (InterruptedException e) {
                e.printStackTrace();
            } finally {
                System.out.println(Thread.currentThread().getName() + &quot;  é‡Šæ”¾è®¸å¯è¯&quot;);
                semaphore.release(1);
            }
            System.out.println(Thread.currentThread().getName() + &quot; ç»“æŸ&quot;);
        }, &quot;thread&quot; + (i + 1)).start());
    }

}
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong></p>
<pre><code class="language-java">----------Semaphore-----------
thread1  å¼€å§‹
thread1  è·å–è®¸å¯è¯
thread2  å¼€å§‹
thread2  è·å–è®¸å¯è¯
thread3  å¼€å§‹
thread4  å¼€å§‹
thread1  ç­‰å¾…å®Œæ¯•
thread1  é‡Šæ”¾è®¸å¯è¯
thread3  è·å–è®¸å¯è¯
thread1  ç»“æŸ
thread2  ç­‰å¾…å®Œæ¯•
thread2  é‡Šæ”¾è®¸å¯è¯
thread4  è·å–è®¸å¯è¯
thread2  ç»“æŸ
thread3  ç­‰å¾…å®Œæ¯•
thread3  é‡Šæ”¾è®¸å¯è¯
thread3  ç»“æŸ
thread4  ç­‰å¾…å®Œæ¯•
thread4  é‡Šæ”¾è®¸å¯è¯
thread4  ç»“æŸ
</code></pre>
<p>æˆ‘ä»¬å‘ç°åªæœ‰è·å–è®¸å¯è¯çš„çº¿ç¨‹æ‰å¯ä»¥å»æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡,å½“é‡Šæ”¾è®¸å¯è¯çš„æ—¶å€™,å…¶ä»–çº¿ç¨‹å¯ä»¥å»è·å–è¿™ä¸ªè®¸å¯è¯</p>
<h3 id="semaphore-çš„æ„é€ æ–¹æ³•">Semaphore  çš„æ„é€ æ–¹æ³•</h3>
<pre><code>Semaphore semaphore = new Semaphore(2,false);
</code></pre>
<p>æˆ‘ä»¬å‘ç°ä»–æ˜¯å¯ä»¥ç©¿ä¸¤ä¸ªå‚æ•°çš„ ,ç¬¬ä¸€ä¸ªæ˜¯è®¸å¯è¯çš„æ•°é‡,ç¬¬äºŒä¸ªæ˜¯ æ˜¯å¦å…¬å¹³, falseæ˜¯ä¸å…¬å¹³</p>
<h3 id="semaphore-çš„å¸¸ç”¨æ–¹æ³•">Semaphore  çš„å¸¸ç”¨æ–¹æ³•</h3>
<ul>
<li>semaphore.acquire()</li>
</ul>
<pre><code class="language-java">// Acquires a permit from this semaphore, blocking until one is available, or the thread is {@linkplain Thread#interrupt interrupted}.
semaphore.acquire(); 
</code></pre>
<p><code>semaphore.acquire()</code>è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥è·å–ä¸€ä¸ªpermit , ç›´åˆ°ç­‰åˆ°ä¸€ä¸ªå¯ç”¨çš„permit,æ‰ä¼šé˜»å¡ç»“æŸ,æˆ–è€…è¿™ä¸ªçº¿ç¨‹è¢«æ‰“æ–­.</p>
<ul>
<li>semaphore.release(1);</li>
</ul>
<pre><code class="language-java">// Releases the given number of permits, returning them to the semaphore.
semaphore.release(1);
semaphore.release();  // ä¸ä¼ å‚æ•°é»˜è®¤æ˜¯1 
</code></pre>
<p><code>semaphore.release(1);</code>  è¿™ä¸ªæ–¹æ³•å¯ä»¥æŒ‡å®šä¸€permitçš„å¤§å°, é‡Šæ”¾ç»™å®šæ•°é‡çš„permit,è¿”å›ç»™ smaphore</p>
<ul>
<li>semaphore.drainPermits()</li>
</ul>
<pre><code class="language-java">// Acquires and returns all permits that are immediately available.
semaphore.drainPermits();
</code></pre>
<p><code>semaphore.drainPermits()</code> è¿™ä¸ªæ–¹æ³•å°±æ˜¯ è·å–å¹¶ä¸”å¹¶ä¸”ç«‹é©¬è¿”å›æ‰€ä»¥å¯ç”¨çš„permit . æ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¸éœ€è¦release</p>
<ul>
<li>semaphore.acquireUninterruptibly(5)</li>
</ul>
<pre><code class="language-java">// Acquires the given number of permits from this semaphore,blocking until all are available.
semaphore.acquireUninterruptibly(5);
</code></pre>
<p><code>semaphore.acquireUninterruptibly(5)</code> è¿™ä¸ªæ–¹æ³•çš„å­—é¢æ„æ€å°±æ˜¯è·å–ä¸é—´æ–­çš„ <code>Uninterruptibly</code>æ˜¯ä¸é—´æ–­çš„æ„æ€. æ‰€ä»¥è§£é‡Šå°±æ˜¯ éœ€è¦è·å–ç»™å®šæ•°é‡çš„permit,æ­¢åˆ°è¿™äº›permitéƒ½æ˜¯å¯ç”¨çš„æ‰é˜»å¡ç»“æŸ.</p>
<ul>
<li>semaphore.availablePermits()</li>
</ul>
<pre><code>// Returns the current number of permits available in this semaphore.
semaphore.availablePermits()
</code></pre>
<p><code>semaphore.availablePermits()</code> è¿™ä¸ªæ–¹æ³•ä¼šç«‹åˆ»è¿”å›æ‰€æœ‰å¯ç”¨çš„permit</p>
<h3 id="ä¸Šé¢è®²çš„çš„permit-å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢">ä¸Šé¢è®²çš„çš„<code>permit</code> å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ ?</h3>
<p>æˆ‘ç¿»é˜… æºç å‘ç°</p>
<pre><code class="language-java"> 	/**
     * The synchronization state.
     */
    private volatile int state;
	/**
     * Returns the current value of synchronization state.
     * This operation has memory semantics of a {@code volatile} read.
     * @return current state value
     */
    protected final int getState() {
        return state;
    }
</code></pre>
<p>è¿™çŠ¶æ€ è¡¨ç¤º å½“å‰permitçš„æ•°é‡ ,ä»–ç”¨<code>volatile</code> ä¿®é¥°çš„ç›®çš„å°±æ˜¯ä¸ºäº† è®©å¤šçº¿ç¨‹ä¹‹é—´å¯ä»¥å»å…±äº«è¿™ä¸ªå˜é‡ , ä¿è¯å…¶å¯è§æ€§ . æ ¹æ®æ•°é‡è¿›è¡Œ reduce å’Œ increase ,</p>
<h2 id="å¯¹æ¯”ä¸€ä¸‹-lock">å¯¹æ¯”ä¸€ä¸‹ lock</h2>
<pre><code class="language-java">public class TestLock {

    public static void main(String[] args) {

        final ReentrantLock lock = new ReentrantLock();

        System.out.println(&quot;--------ReentrantLock-----------&quot;);

        IntStream.range(0, 4).forEach(e-&gt;{
            new Thread(()-&gt;{
                System.out.println(Thread.currentThread().getName() + &quot;  å¼€å§‹&quot;);
                lock.lock(); // ä¸€æ¬¡æ‹¿ä¸€æŠŠé”
                try {
                    System.out.println(Thread.currentThread().getName() + &quot;  æ‹¿åˆ°é”&quot;);
                    TimeUnit.SECONDS.sleep(3);
                    System.out.println(Thread.currentThread().getName() + &quot;  ç­‰å¾…å®Œæ¯•&quot;);
                } catch (InterruptedException ex) {
                    ex.printStackTrace();
                } finally {
                    System.out.println(Thread.currentThread().getName() + &quot;  é‡Šæ”¾é”&quot;);
                    lock.unlock();
                }
                System.out.println(Thread.currentThread().getName() + &quot;  ç»“æŸ&quot;);
            }, &quot;thread&quot; + (e + 1)
            ).start();
        });
    }
}
</code></pre>
<p><strong>æ‰§è¡Œç»“æœ</strong></p>
<pre><code class="language-java">--------ReentrantLock-----------
thread1  å¼€å§‹
thread2  å¼€å§‹
thread1  æ‹¿åˆ°é”
thread3  å¼€å§‹
thread4  å¼€å§‹
thread1  ç­‰å¾…å®Œæ¯•
thread1  é‡Šæ”¾é”
thread1  ç»“æŸ
thread2  æ‹¿åˆ°é”
thread2  ç­‰å¾…å®Œæ¯•
thread2  é‡Šæ”¾é”
thread2  ç»“æŸ
thread3  æ‹¿åˆ°é”
thread3  ç­‰å¾…å®Œæ¯•
thread3  é‡Šæ”¾é”
thread3  ç»“æŸ
thread4  æ‹¿åˆ°é”
thread4  ç­‰å¾…å®Œæ¯•
thread4  é‡Šæ”¾é”
thread4  ç»“æŸ
</code></pre>
<p>æˆ‘ä»¬ä¸éš¾å‘ç°  lock , å½“çº¿ç¨‹æ‰§è¡Œlock() æ–¹æ³•æ—¶, åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ.</p>
<pre><code class="language-java">1. Acquires the lock if it is not held by another thread and returns immediately, setting the lock hold count to one.
2. If the current thread already holds the lock then the hold count is incremented by one and the method returns immediately.
3. If the lock is held by another thread then the current thread becomes disabled for thread scheduling purposes and lies dormant until the lock has been acquired, at which time the lock hold count is set to one.    
</code></pre>
<p>æºç ä¸­ lock æ–¹æ³• æœ‰ä¸‰ç§æƒ…å†µ</p>
<ol>
<li>å¦‚æœéœ€æ±‚çš„é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ‰€æŒæœ‰,é‚£ä¹ˆä¹…ç«‹åˆ»è¿”å›å¹¶ä¸”è®¾ç½®æŒæœ‰é”çš„æ•°é‡ä¸º1</li>
<li>å¦‚æœå½“å‰çº¿ç¨‹å·²ç»æŒæœ‰é”,é‚£ä¹ˆæŒæœ‰çš„æ•°é‡åŠ ä¸€,ç„¶åè¿”å›,  å°±æ˜¯ä¸€ä¸ªå¤šæ¬¡æ‰§è¡Œ lock æ–¹æ³•()</li>
<li>å¦‚æœè¿™ä¸ªé” è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰,é‚£ä¹ˆå½“å‰çº¿ç¨‹åˆ™ä¸èƒ½è°ƒåº¦çº¿ç¨‹,ç„¶åä¼‘çœ ,æ­¢åˆ°æœ‰å¯ç”¨çš„é”,åŒæ—¶å°†é”çš„æŒæœ‰æ•°é‡è®¾ç½®ä¸º1.</li>
</ol>
<p>æ‰€ä»¥å‘¢,åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”,è¾¾åˆ°åŒæ­¥æ‰§è¡Œçš„æ•ˆæœ</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%BB%8B%E7%BB%8D">ä»‹ç»</a></li>
<li><a href="#semaphore-%E4%BD%BF%E7%94%A8">Semaphore  ä½¿ç”¨</a>
<ul>
<li><a href="#%E7%AE%80%E5%8D%95%E7%9C%8B%E7%9C%8B%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5">ç®€å•çœ‹çœ‹ä½¿ç”¨æƒ…å†µ</a></li>
<li><a href="#semaphore-%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">Semaphore  çš„æ„é€ æ–¹æ³•</a></li>
<li><a href="#semaphore-%E7%9A%84%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">Semaphore  çš„å¸¸ç”¨æ–¹æ³•</a></li>
<li><a href="#%E4%B8%8A%E9%9D%A2%E8%AE%B2%E7%9A%84%E7%9A%84permit-%E5%AF%B9%E8%B1%A1%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2">ä¸Šé¢è®²çš„çš„<code>permit</code> å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ ?</a></li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E6%AF%94%E4%B8%80%E4%B8%8B-lock">å¯¹æ¯”ä¸€ä¸‹ lock</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>