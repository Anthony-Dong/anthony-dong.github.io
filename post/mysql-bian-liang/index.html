<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dong的个人博客"/><meta charset="UTF-8"/><title>MySQL - 变量 | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/mysql-bian-liang/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >本页面需要浏览器支持（启用）JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >关于</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >友链</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >关于</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >友链</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614224679162" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>MySQL - 变量</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "繁") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "简"
							} else {
								if (document.getElementById("lan").innerText == "簡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "繁"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-11-01</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/mysql-bian-liang/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/ECQCi6IDpNB/"
								class="tag">数据库</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">876字</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">4 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="调整简繁体" style="margin-right:15px;">繁</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<h2 id="1-用户变量-set-语句赋值">1. 用户变量 - set 语句赋值</h2>
<h3 id="1-set-variable-0">1. set @variable = 0 ;</h3>
<pre><code class="language-sql">SET @variable =1 ;
SELECT @variable ;
+-----------+
| @variable |
+-----------+
|         1 |
+-----------+
</code></pre>
<h3 id="2-set-variable-0">2. set @variable := 0 ;</h3>
<pre><code class="language-sql">SET @variable :=1 ;
SELECT @variable as variable;
+----------+
| variable |
+----------+
|        1 |
+----------+
</code></pre>
<h2 id="2-用户变量-select-语句赋值">2. 用户变量 - select 语句赋值</h2>
<h3 id="1-select-variable-0-as-variable">1. SELECT @variable := 0 AS variable ;</h3>
<p>select 语句赋值必须使用 <code>:=</code>   , 中间没有空格</p>
<pre><code class="language-sql">SELECT @variable := 0 AS variable ;

+----------+
| variable |
+----------+
|        0 |
+----------+


必须为 `:=` , 不然无法赋值,不赋值,默认为null,
SELECT @t1 := (@t2 := 1) +@t3 := 4 ,@t1 ,@t2 ,@t3; 
+-----------------------------+------+------+------+
| @t1 := (@t2 := 1) +@t3 := 4 | @t1  | @t2  | @t3  |
+-----------------------------+------+------+------+
|                           5 | 5    | 1    | 4    |
+-----------------------------+------+------+------+


如果我们不用 `:=`
SELECT @t1 = (@t2 = 1) + (@t3 = 4) ,@t1 ,@t2 ,@t3; 
+-----------------------------+------+------+------+
| @t1 = (@t2 = 1) + (@t3 = 4) | @t1  | @t2  | @t3  |
+-----------------------------+------+------+------+
|                        NULL | NULL | NULL | NULL |
+-----------------------------+------+------+------+
</code></pre>
<h3 id="2-小案例做一个排名">2. 小案例,做一个排名</h3>
<pre><code class="language-sql">
CREATE TABLE `students` (
  `sid` int(2) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `score` int(2) NOT NULL,
  PRIMARY KEY (`pid`),
  UNIQUE KEY `name` (`name`)
) ENGINE=InnoDB  DEFAULT CHARSET=latin1;
 
INSERT INTO `students` (`sid`, `name`, `score`) VALUES
(1, 'Samual', 85),
(2, 'Vino', 80),
(3, 'John', 80),
(4, 'Andy', 72),
(5, 'Brian', 71),
(6, 'Dew', 74),
(7, 'Kris', 75),
(8, 'William', 76),
(9, 'George', 73),
(10, 'Peter', 99),
(11, 'Tom', 90),
(12, 'Andre', 60);
</code></pre>
<p><strong>按年龄排名 , 将上面的表, 并显示出排名</strong></p>
<pre><code class="language-sql">SELECT
	s.sid,
	s. NAME,
	s.score,
	@count := @count + 1 AS rank
FROM
	students s,
	(SELECT @count := 0) c
ORDER BY
	s.score DESC
	
即使 set 变量存在于整个会话,但是每次都会赋初始值,所以不会影响下一次的调用. 

+-----+---------+-------+------+
| sid | NAME    | score | rank |
+-----+---------+-------+------+
|  10 | Peter   |    99 |    1 |
|  11 | Tom     |    90 |    2 |
|   1 | Samual  |    85 |    3 |
|   2 | Vino    |    80 |    4 |
|   3 | John    |    80 |    5 |
|   8 | William |    76 |    6 |
|   7 | Kris    |    75 |    7 |
|   6 | Dew     |    74 |    8 |
|   9 | George  |    73 |    9 |
|   4 | Andy    |    72 |   10 |
|   5 | Brian   |    71 |   11 |
|  12 | Andre   |    60 |   12 |
+-----+---------+-------+------+	
</code></pre>
<h2 id="3-局部变量-自定义函数">3. 局部变量   - 自定义函数</h2>
<p>局部变量存在与 begin - end 之间 , 有效期仅仅限制于  begin - end 之间 ,</p>
<p>declare 语句专门用于定义局部变量，可以使用default来说明默认值 , 主要是申明变量的作用.</p>
<p>set 设置不同类型的变量  , set语句既可以用于局部变量的赋值，也可以用于用户变量的申明并赋值。</p>
<pre><code>declare var_name [, var_name]... data_type [ DEFAULT value ];

例如 : 
declare c int default 0;

set c = a + b ; 
</code></pre>
<pre><code class="language-sql">-- 创建程序
CREATE PROCEDURE csum (a INT)

BEGIN
-- 申明变量 , 赋值 
DECLARE sum INT DEFAULT 0;
DECLARE i INT DEFAULT 1;

-- 循环开始
WHILE i &lt;= a DO	
SET sum = sum + i;
SET i = i + 1;
END WHILE;
-- 循环结束

-- 输出结果
SELECT sum;
END;

-- 调用程序
call csum(100);

-- 删除程序
drop procedure if exists csum；
</code></pre>
<p>procedure : 程序的意思 .....</p>
<p>我参考的<a href="https://www.jianshu.com/p/cb0152efac32">链接</a> :  https://www.jianshu.com/p/cb0152efac32</p>
<h2 id="4-set-与-declare-的区别">4. set  与 declare 的区别</h2>
<blockquote>
<p>set 关键字声明的变量 ,可以在一个会话的任何地方声明，作用域是整个会话，称为用户变量</p>
<p>declare关键字声明的变量，只能在存储过程中使用，称为存储过程变量 .</p>
<p>两者的区别是：</p>
<p>​		在调用存储过程时，以declare声明的变量都会被初始化为null。而会话变量（即@开头的变量）则不会被再初始化，在一个会话内，只须初始化一次，之后在会话内都是对上一次计算的结果，就相当于在是这个会话内的全局变量。</p>
</blockquote>
<h2 id="5-系统变量">5. 系统变量</h2>
<h3 id="全局变量">全局变量</h3>
<p>全局变量影响服务器整体操作。当服务器启动时，它将所有全局变量初始化为默认值。</p>
<pre><code class="language-sql">1. 设置全局变量 , 全局变量一般是 @@  
set global var_name = value;  
set @@global.var_name = value; 

2. 查看会话变量 , 通配符 '_ 或  %'
show global variables;   
show global variables like “%var%”;  


select @@global.var_name;
select @@var_name;
</code></pre>
<h3 id="会话变量">会话变量</h3>
<p>服务器为每个连接的客户端维护一系列会话变量</p>
<pre><code class="language-sql">1. 设置会话变量 
set session var_name = value;    
set @@session.var_name = value;  

2. 查看 会话变量 
show session variables;
show session variables like &quot;%var%&quot;;

select @@var_name;
select @@session.var_name;
</code></pre>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F-set-%E8%AF%AD%E5%8F%A5%E8%B5%8B%E5%80%BC">1. 用户变量 - set 语句赋值</a>
<ul>
<li><a href="#1-set-variable-0">1. set @variable = 0 ;</a></li>
<li><a href="#2-set-variable-0">2. set @variable := 0 ;</a></li>
</ul>
</li>
<li><a href="#2-%E7%94%A8%E6%88%B7%E5%8F%98%E9%87%8F-select-%E8%AF%AD%E5%8F%A5%E8%B5%8B%E5%80%BC">2. 用户变量 - select 语句赋值</a>
<ul>
<li><a href="#1-select-variable-0-as-variable">1. SELECT @variable := 0 AS variable ;</a></li>
<li><a href="#2-%E5%B0%8F%E6%A1%88%E4%BE%8B%E5%81%9A%E4%B8%80%E4%B8%AA%E6%8E%92%E5%90%8D">2. 小案例,做一个排名</a></li>
</ul>
</li>
<li><a href="#3-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0">3. 局部变量   - 自定义函数</a></li>
<li><a href="#4-set-%E4%B8%8E-declare-%E7%9A%84%E5%8C%BA%E5%88%AB">4. set  与 declare 的区别</a></li>
<li><a href="#5-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F">5. 系统变量</a>
<ul>
<li><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">全局变量</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E5%8F%98%E9%87%8F">会话变量</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:fanhaodong516@gmail.com" target="blank">Send Email</a>Copyright©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">👁<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>📚<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.github.io ,Github:https://github.com/Anthony-Dong ,Email:fanhaodong516@gmail.com ,有事情欢迎联系. \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>