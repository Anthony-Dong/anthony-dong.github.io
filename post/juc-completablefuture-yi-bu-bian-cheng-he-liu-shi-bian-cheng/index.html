<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon"href="https://anthony-dong.github.io/favicon.ico"type="image/x-icon"/><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"/><meta name="description"content="Anthony-Dongçš„ä¸ªäººåšå®¢"/><meta charset="UTF-8"/><title>JUC - CompletableFuture å¼‚æ­¥ç¼–ç¨‹å’Œæµå¼ç¼–ç¨‹ | Anthony-Dong</title><link href="https://anthony-dong.github.io/styles/main.css"type="text/css"rel="stylesheet"/><script src="https://anthony-dong.github.io/media/js/magnify.min.js"></script>
	<link rel="canonical" href="https://anthony-dong.github.io/post/juc-completablefuture-yi-bu-bian-cheng-he-liu-shi-bian-cheng/" />
</head>
<body>
	<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://anthony-dong.github.io"><img alt="logo" style="display:inline-block;" src="https://anthony-dong.github.io/images/avatar.png"/></a><h1 title="Anthony-Dong" class="weaklink shift"><a  href="/">Anthony-Dong</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div>
<div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/link" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form-1" data-update="1614223299317" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

	<div class="main">
		<div class="main-inner">
			<div class="content">
				<article class="post">
					<script src='https://anthony-dong.github.io/media/js/Valine.min.js'></script><style>.v .vlist .vcard .vh .vmeta .vat{font-size:.8125em;color:#9d7873;cursor:pointer;float:right}.v .vlist .vcard .vhead .vsys{display:none}</style ><script type="text/javascript">new Valine(ValineInfo)</script>
					<h2 class="post_title sm_margin"><a>JUC - CompletableFuture å¼‚æ­¥ç¼–ç¨‹å’Œæµå¼ç¼–ç¨‹</a></h2>
					<script>
						function lan() {
							if (document.getElementById("lan").innerText == "ç¹") {
								var s = document.getElementById("tongwenlet_cn");
								if (s != null) {
									document.body.removeChild(s)
								}
								var s = document.createElement("script");
								s.language = "javascript";
								s.type = "text/javascript";
								s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";
								s.id = "tongwenlet_cn";
								document.body.appendChild(s);
								document.getElementById("lan").innerHTML = "ç®€"
							} else {
								if (document.getElementById("lan").innerText == "ç°¡") {
									var s = document.getElementById("tongwenlet_cn");
									if (s != null) {
										document.body.removeChild(s)
									}
									var s = document.createElement("script");
									s.language = "javascript";
									s.type = "text/javascript";
									s.src = "https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";
									s.id = "tongwenlet_cn";
									document.body.appendChild(s);
									document.getElementById("lan").innerHTML = "ç¹"
								}
							}
						};
					</script>
					<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px">
							2019-12-07</span><i class="iconfont icon-browse"></i>
							<span class="leancloud_visitors" style="margin-right:15px" id="/post/juc-completablefuture-yi-bu-bian-cheng-he-liu-shi-bian-cheng/">views <i class="leancloud-visitors-count" style="font-style: normal"></i></span>
							<span class="weaklink" style="margin-right:15px"><i class="iconfont icon-category"></i> <a
								href="https://anthony-dong.github.io/tag/38zE8aaGQ3X/"
								class="tag">JUC</a></span><i class="iconfont icon-caret-down"></i><span
							style="margin-right:15px">3386å­—</span><i
							class="iconfont icon-naozhong"></i><span
							style="margin-right:15px">16 min read</span><a id="lan"
							href="javascript:void(0);" onclick="lan();" title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
						</section>

						<div style="display:flex">
							<div class="md_block" id="md_block">
								<div class="round-shape-one"></div>
								<blockquote>
<p>â€‹	<code>CompletableFuture</code>ç±»å®ç°äº†<code>Future</code>æ¥å£å’Œ<code>CompletionStage</code> æ¥å£, <code>Future</code>æ¥å£æˆ‘ä»¬å°±ä¸å¤šä»‹ç»äº†, ä»–å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å›è°ƒ,å¹¶ä¸”è°ƒç”¨<code>get</code>æ–¹æ³•æ˜¯é˜»å¡çš„ , è¿™ä¸ªå¹¶ä¸æ˜¯è¿™ä¸ªç±»çš„ç‰¹ç‚¹ , ä»–çš„å…³é”®æ˜¯ <code>CompletionStage</code>è¿™ä¸ªæ¥å£, ä»–æ›´åƒæ˜¯ä¸€ä¸ªä¸€æ®µç¨‹åºæ‰§è¡Œçš„å„ä¸ªé˜¶æ®µ, æ¯ä¸ªé˜¶æ®µæ‰§è¡Œç»“æŸéƒ½ä¼šè¿”å›ä¸€ä¸ªé˜¶æ®µ, æ‰€ä»¥é˜¶æ®µå¯èƒ½ç›¸äº’ä¾èµ–, ä¹Ÿå¯èƒ½ä¸ä¾èµ– , ä¹Ÿæœ‰å„è‡ªæƒ…å†µ ,ä»–æ›´ç¬¦åˆæµå¼ç¼–ç¨‹çš„ç‰¹ç‚¹ ,ç‰¹åˆ«åƒ<code>JavaScript</code>çš„<code>Promise</code>å¯¹è±¡ , ä¸€ç§then , å°±æ˜¯è¿™ç©æ„ , ä¼°è®¡ä½ å¬æ‡‚äº†æˆ‘ä»¬å°±å¼€å§‹å§</p>
<p>â€‹	è¿˜æœ‰è¿™ç©æ„æ˜¯æµå¼ç¼–ç¨‹ ,ä»£è¡¨æ ¹æœ¬æ²¡æœ‰å°¾, åªè¦ä½ ä¸æƒ³ç»“æŸ ....</p>
</blockquote>
<h2 id="1-completionstage">1. CompletionStage</h2>
<blockquote>
<p>â€‹	A stage of a possibly asynchronous computation, that performs an action or computes a value when another CompletionStage completes.</p>
<p>â€‹	å°±æ˜¯ä»£è¡¨ä¸€ä¸ªé˜¶æ®µ, ä¸€ç§æµå¼ç¼–ç¨‹</p>
</blockquote>
<blockquote>
<p>â€‹	The computation performed by a stage may be expressed as <code>a Function, Consumer, or Runnable</code> (using methods with names including apply, accept, or run, respectively) depending on whether it requires arguments and/or produces results. For example,<code>stage.thenApply(x -&gt; square(x)).thenAccept(x -&gt; System.out.print(x)).thenRun(() -&gt; System.out.println())</code> .An additional form (compose) applies functions of stages themselves, rather than their results.</p>
</blockquote>
<p>æˆ‘æ„Ÿè§‰è¿™ä¸€æ®µå°±æ˜¯ä»–è¡¨è¿°çš„ç²¾é«“  : æ ¹æ®æ˜¯å¤Ÿéœ€è¦å‚æ•°å’Œè¿”å›ç»“æœ , ä¸€ä¸ªé˜¶æ®µçš„è®¡ç®—å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæ–¹æ³•, ä¸€ä¸ªæ¶ˆè´¹ , ä¸€ä¸ª runnable ,</p>
<p>å…¶ä¸­ <code>CompletableFuture</code>ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªæ¥å£å»å®ç°çš„</p>
<h2 id="2-completablefuture">2. CompletableFuture</h2>
<blockquote>
<p>â€‹	When two or more threads attempt to complete, completeExceptionally, or cancel a CompletableFuture, only one of them succeeds.  ä»–ä¿è¯äº†å¤šçº¿ç¨‹çš„å®‰å…¨æ€§,å…¶å®å°±æ˜¯è¿™æ®µè¯è¡¨è¿°çš„æ„æ€ ,</p>
</blockquote>
<blockquote>
<p>â€‹	æ„Ÿè§‰å¦‚æœä½ ä½¿ç”¨è¿™ç©æ„å°±ä¸è¦ä½¿ç”¨ <code>Future</code>å¸¦çš„æ–¹æ³•,æ¯”å¦‚<code>get</code></p>
</blockquote>
<h3 id="1-ç®€å•å¼€å§‹">1. ç®€å•å¼€å§‹</h3>
<p>æ¯”å¦‚ä¸¾ä¸ªä¾‹å­ , æˆ‘ä»¬éœ€è¦å»æŸ¥è¯¢ä¸€ä¸‹æ•°æ®åº“å½“å‰ä¸€å…±æœ‰å¤šå°‘æ•°æ® , æ­¤æ—¶æˆ‘ä»¬æŸ¥è¯¢çº¿ç¨‹éœ€è¦å¾ˆè€—æ—¶ ,æˆ‘ä»¬éœ€è¦åšå…¶ä»–äº‹æƒ…,ç„¶åæŸ¥è¯¢å®Œæˆ‘ä»¬è¿˜è¦å¯¹ä»–è¿›è¡Œæ•°æ®åŠ å·¥</p>
<pre><code class="language-java">@Test
public void test3() throws IOException {
    CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;();
    // çº¿ç¨‹ä¸€
    future.thenApply((r) -&gt; r * 10).whenComplete((r, e) -&gt; System.out.println(&quot;æ‹¿åˆ°æœ€ç»ˆæ•°æ® : &quot;+r));

    // çº¿ç¨‹äºŒ
    new Thread(() -&gt; {
        // æ¨¡æ‹Ÿè€—æ—¶
        ThreadUtil.sleep(100);
        System.out.println(&quot;æŸ¥è¯¢åˆ°æ•°æ® 1000 æ¡&quot;);
        future.complete(1000);
    }).start();

    // é˜»å¡ä½ æ‡‚å¾—
    System.in.read();
}

// è¾“å‡º : 
// æŸ¥è¯¢åˆ°æ•°æ® 1000 æ¡
// æ‹¿åˆ°æœ€ç»ˆæ•°æ® : 10000
</code></pre>
<p>è¿™å°±æ˜¯å¼‚æ­¥ , æˆ‘ä»¬è¾“å…¥å’Œè¾“å‡ºæ˜¯ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œ ,</p>
<p>è¿˜æœ‰ä¸€ç§å°±æ˜¯æˆ‘ä»¬å¯èƒ½æŸ¥è¯¢å¤±è´¥äº†,æ²¡æœ‰ç»“æœè¿”å›æ€ä¹ˆåŠå‘¢ ?</p>
<pre><code class="language-java">@Test
public void test3() throws IOException {
    CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;();
    // çº¿ç¨‹ä¸€
    future.thenApply((r) -&gt; r * 10).whenComplete((r, e) -&gt; System.out.println(e.getMessage()));


    // çº¿ç¨‹äºŒ
    new Thread(() -&gt; {
        // æ¨¡æ‹Ÿè€—æ—¶
        ThreadUtil.sleep(100);
        System.out.println(&quot;æŸ¥è¯¢å¤±è´¥ : &quot;+Thread.currentThread().getName());
        future.completeExceptionally(new RuntimeException(&quot;æŸ¥è¯¢å¤±è´¥&quot;));
    }).start();

    // é˜»å¡ä½ æ‡‚å¾—
    System.in.read();
}
// è¾“å‡º
// æŸ¥è¯¢å¤±è´¥ : Thread-0
// java.lang.RuntimeException: æŸ¥è¯¢å¤±è´¥
</code></pre>
<h3 id="2-é™æ€æ–¹æ³•-å®ä¾‹åŒ–">2. é™æ€æ–¹æ³•-å®ä¾‹åŒ–</h3>
<figure data-type="image" tabindex="1"><img src="https://tyut.oss-accelerate.aliyuncs.com/image/2019-12-06/661a03c4-5ef4-4213-bfa1-de2d22a7aaa5.jpg?x-oss-process=style/template01" alt="" loading="lazy"></figure>
<p>æˆ‘ä»¬å¤§è‡´çœ‹çœ‹è¿™å‡ ä¸ªæ–¹æ³• . <code>supply</code> æ˜¯æä¾›ä¸€ä¸ªè¿”å›å€¼ , <code>run</code>æ˜¯æä¾›ä¸€ä¸ªæ— è¿”å›å€¼çš„runæ–¹æ³•, <code>allOf</code> æ˜¯å°†å‡ ä¸ª<code>CompletableFuture</code> åˆå¹¶ , <code>completedFuture</code> æ˜¯å°†ç»“æœç«‹é©¬è¿”å›ä¸€ä¸ªå¸¦æœ‰ç»“æœçš„å¯¹è±¡ ,</p>
<h3 id="3ç«‹å³å®Œæˆ-complete-å’Œ-completeexceptionally-æ–¹æ³•">3.ç«‹å³å®Œæˆ  complete å’Œ completeExceptionally æ–¹æ³•</h3>
<blockquote>
<p>â€‹	<code>complete</code> : If not already completed, sets the value returned by get() and related methods to the given value.</p>
</blockquote>
<p>â€‹	<code>complete</code>æ–¹æ³•å°±æ˜¯å¦‚æœæ­¤é˜¶æ®µ(<code>æ­¤é˜¶æ®µå¾ˆé‡è¦,è¦æ‡‚å¾—é˜¶æ®µæŒ‡çš„æ˜¯å•¥,å› ä¸ºæ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½éœ€è¦ä¸€ä¸ªCompletionStageå¯¹è±¡,è¿™ä¸ªå°±æ˜¯æŒ‡çš„æ­¤é˜¶æ®µ</code>)æ²¡æœ‰å®Œæˆ , ç«‹é©¬è®¾ç½®å€¼å®Œæˆ ,</p>
<blockquote>
<p>â€‹	<code>completeExceptionally</code> : If not already completed, causes invocations of get() and related methods to throw the given exception.</p>
<p>â€‹		true if this invocation caused this CompletableFuture to transition to a completed state, else false</p>
</blockquote>
<p>â€‹	<code>completeExceptionally</code> æ–¹æ³•å°±æ˜¯æ²¡æœ‰å®Œæˆ, ç«‹é©¬æŠ›å‡ºå¼‚å¸¸, å¦‚æœè¿”å›true , è¡¨ç¤ºæˆåŠŸå°†å…¶æ­¤é˜¶æ®µå®Œæˆ, falseè¡¨ç¤ºå¤±è´¥</p>
<pre><code class="language-java">public static void main(String[] args) throws IOException {
    final long start = System.currentTimeMillis();

    final CompletableFuture&lt;String&gt; compute = CompletableFuture.supplyAsync(() -&gt; {
        ThreadUtils.sleep(1000);
        System.out.println(&quot;æˆ‘å°±æ˜¯è¦æ‹–æ‹‰ , è€—æ—¶ : &quot; + (System.currentTimeMillis() - start));
        return &quot;æˆ‘å°±æ˜¯è¦æ‹–æ‹‰&quot;;
    });


    new Thread(() -&gt; {
        CompletableFuture&lt;Void&gt; future = compute.thenAccept(v -&gt; {
            System.out.println(&quot;æ¥æ”¶åˆ°ç»“æœ : &quot; + v + &quot; , è€—æ—¶ : &quot; + (System.currentTimeMillis() - start));
        });
    }).start();

    new Thread(() -&gt; {
        boolean b = compute.complete(&quot;é‚£ä¸ªçƒ‚è´§,å¤ªç£¨å½äº†,æˆ‘å…ˆå°†ä»–ä»»åŠ¡æ„Ÿè§‰ç»“ç®—äº†&quot;);
        System.out.println(&quot;å¿«é€Ÿå®Œæˆæ˜¯å¦æˆåŠŸ : &quot; + b);
    }).start();

	// é˜»å¡
    System.in.read();
}
</code></pre>
<p>å¦‚æœä½ çœ‹æ‡‚æˆ‘ä¸Šé¢å†™çš„æ˜¯ä»€ä¹ˆ , ä½ å°±ç†è§£äº†è¿™ä¸ª <code>CompletionStage</code> ç©¶ç«Ÿåªåšäº†äº›ä»€ä¹ˆ , è¯•ç€çŒœä¸€ä¸‹è¾“å‡ºç»“æœ  ,</p>
<p>è¾“å‡º :</p>
<pre><code class="language-java">æ¥æ”¶åˆ°ç»“æœ : é‚£ä¸ªçƒ‚è´§,å¤ªç£¨å½äº†,æˆ‘å…ˆå°†ä»–ä»»åŠ¡æ„Ÿè§‰ç»“ç®—äº† , è€—æ—¶ : 64
å¿«é€Ÿå®Œæˆæ˜¯å¦æˆåŠŸ : true
æˆ‘å°±æ˜¯è¦æ‹–æ‹‰ , è€—æ—¶ : 1072
</code></pre>
<p>é‚£ä¸ª <code>completeExceptionally</code> ä»–æ˜¯æä¾›ä¸€ä¸ªå¼‚å¸¸ , å¯èƒ½æˆ‘ä¸Šé¢çš„<code>thenAccept</code>æ–¹æ³•æ¥æ”¶ä¸äº†, ä½ å¯ä»¥æ¢å…¶ä»–æ–¹æ³•å»å¤„ç†,</p>
<h3 id="4-æŠ“å–å¼‚å¸¸-exceptionally-æ–¹æ³•">4.  æŠ“å–å¼‚å¸¸ - exceptionally æ–¹æ³•</h3>
<pre><code class="language-java">@Test
public void testException() throws ExecutionException, InterruptedException {

    CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; {
        error();
        return getName();
    }).exceptionally(new Function&lt;Throwable, String&gt;() {
        @Override
        public String apply(Throwable throwable) {
            return &quot;è·å–å¤±è´¥&quot;;
        }
    }).whenComplete(new BiConsumer&lt;String, Throwable&gt;() {
        @Override
        public void accept(String s, Throwable throwable) {
            System.out.println(s);
        }
    });
}

// è¾“å‡º :  è·å–å¤±è´¥
</code></pre>
<h3 id="5-åŠ å·¥-supplyasync-thenapply-thenaccept-æ–¹æ³•">5 åŠ å·¥ - supplyAsync &amp; thenApply &amp; thenAccept æ–¹æ³•</h3>
<p>å¯¹äº<code>CompletableFuture</code> æˆ‘æ„Ÿè§‰ä½ ç†è§£æˆæµå¼ç¼–ç¨‹æ¯”è¾ƒå¥½ , å’Œ<code>Stream</code>å¾ˆç›¸ä¼¼, è¿™ç§ç¼–ç¨‹</p>
<pre><code class="language-java">@Test
public void testOperation() throws IOException {

    CompletableFuture.supplyAsync(new Supplier&lt;String&gt;() {
        @Override
        public String get() {
            // è·å–åå­—
            return getName();
        }
    }).thenApply(new Function&lt;String, Person&gt;() {
        @Override
        public Person apply(String s) {
            // å°è£…å¯¹è±¡
            return new Person(s, System.currentTimeMillis());
        }
    }).thenAccept(new Consumer&lt;Person&gt;() {
        @Override
        public void accept(Person person) {
            // æ¶ˆè´¹å¯¹è±¡
            System.out.println(person);
        }
    });

    System.in.read();
}
// è¾“å‡º : Person{name='tom', timestamp=1575645761277}
</code></pre>
<h3 id="6-åŠ å·¥-whencomplete-æ–¹æ³•">6. åŠ å·¥-  whenComplete æ–¹æ³•</h3>
<p><code>public CompletionStage&lt;T&gt; whenComplete (BiConsumer&lt;? super T, ? super Throwable&gt; action);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage with the same result or exception as this stage, that executes the given action when this stage completes.</p>
<p>â€‹	è¿”å›ä¸Šä¸€é˜¶æ®µçš„ç»“æœæˆ–è€…å¼‚å¸¸ä¿¡æ¯,</p>
</blockquote>
<pre><code class="language-java">@Test
public void testComplete() {

    CompletableFuture.supplyAsync(() -&gt; &quot;Hello CompletableFuture !&quot;)
            .whenComplete(new BiConsumer&lt;String, Throwable&gt;() {
                @Override
                public void accept(String s, Throwable throwable) {
                    System.out.println(s);
                }
            });
}
è¾“å‡º : Hello CompletableFuture !
</code></pre>
<p><strong>æˆ‘ä»¬å‘ç°ä¸ªé—®é¢˜ , <code>accept</code>æ„æ€æ˜¯æ¥æ”¶(è¢«åŠ¨çš„)æ–¹æ³•çš„æ„æ€,å¤ªè‡ªç§äº†è‡ªå·±æ¶ˆè´¹ä¸ç®¡è¿”å› ,  <code>apply</code> æ„æ€æ˜¯ç”³è¯·(ä¸»åŠ¨çš„)æ–¹æ³•æ¯”è¾ƒå¥½,æˆ‘ç”¨äº†æˆ‘è¿˜è¿”å›ä¸€ä¸ªå€¼ , å“ ,çŸ¥é“è¿™ä¸ªå°±å¥½å§äº†</strong></p>
<h3 id="7-åŠ å·¥-handle-æ–¹æ³•">7. åŠ å·¥ - handle æ–¹æ³•</h3>
<p><code>public &lt;U&gt; CompletionStage&lt;U&gt; handle (BiFunction&lt;? super T, Throwable, ? extends U&gt; fn);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when this stage completes either normally or exceptionally, is executed with this stage's result and exception as arguments to the supplied function.</p>
<p>â€‹	è¿”å›ä¸€ä¸ªæ–°çš„é˜¶æ®µ,å½“æ­¤é˜¶æ®µå®Œæˆå¯èƒ½æ˜¯æ­£å¸¸ä¹Ÿå¯èƒ½æ˜¯å¼‚å¸¸ , å°†ä½¿ç”¨æ­¤é˜¶æ®µçš„ç»“æœå’Œå¼‚å¸¸ä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°æ‰§è¡Œã€‚åŒæ—¶å¯ä»¥æœ‰è¿”å›å€¼</p>
</blockquote>
<p>æ‰€ä»¥æ€ä¹ˆè¯´å‘¢  , æˆ‘è§‰å¾—ä»–æ˜¯ <code>whenComplete</code>çš„æ”¹è¿›ç‰ˆæœ¬ , ä»–æœ‰è¿”å›å€¼, ä»–ç»å¯¹æ˜¯ä¸€ä¸ª <code>apply</code>æ–¹æ³•</p>
<pre><code class="language-java">@Test
public void testHandle() throws ExecutionException, InterruptedException {

    String msg = CompletableFuture.supplyAsync(() -&gt; &quot;hello CompletableFuture&quot;)
            .handle(new BiFunction&lt;String, Throwable, String&gt;() {
                @Override
                public String apply(String s, Throwable throwable) {
                    return &quot;æˆ‘æ”¶åˆ°äº† : &quot; + s;
                }
            }).get();

   System.out.println(msg);
}

// è¾“å‡º :  æˆ‘æ”¶åˆ°äº† : hello CompletableFuture
</code></pre>
<h3 id="8-åŠ å·¥-thencompose">8. åŠ å·¥ - thenCompose</h3>
<p><code>public &lt;U&gt; CompletionStage&lt;U&gt; thenCompose (Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn)</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when this stage completes normally, is executed with this stage as the argument to the supplied function.</p>
</blockquote>
<p>å°±æ˜¯ä¸Šä¸€é˜¶æ®µæ­£å¸¸æ‰§è¡Œå®Œæ¯•ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³• è¿”å›ä¸€ä¸ªæ–°çš„é˜¶æ®µ , ä¸è¿‡è¿™ä¸ªé˜¶æ®µæä¾›äº†ä¸€ä¸ª function å‡½æ•° , å¯ä»¥å¯¹ä¸Šä¸€é˜¶æ®µçš„è¿”å›è¿›è¡Œå¤„ç†  , å¹¶ä¸”functionå‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„ <code>CompletionStage</code>å¯¹è±¡å¾—</p>
<pre><code class="language-java">@Test
public void testCompose() throws IOException {

    CompletableFuture.supplyAsync(() -&gt; &quot;tony&quot;)
            .thenCompose(s -&gt; {
                System.out.println(&quot;name : &quot; + s);
                return CompletableFuture.supplyAsync(() -&gt; &quot;hello world&quot;);
            });

	// ä¸ä½¿ç”¨lambda æœ‰çš„æ—¶å€™ç±»å‹æ¨æ–­éœ€è¦è‡ªå·±æ”¹,å¦‚æœä½ æ•²ä½ ç»å¯¹ä¼šé‡è§çš„, è¿˜æ˜¯æ¨èå¤§å®¶ç”¨lambda
    CompletableFuture.supplyAsync(() -&gt; &quot;tony&quot;)
            .thenCompose(new Function&lt;String, CompletionStage&lt;Object&gt;&gt;() {
                @Override
                public CompletionStage&lt;Object&gt; apply(String s) {
                    return CompletableFuture.supplyAsync(() -&gt; &quot;hello world&quot;);
                }
            });

    System.in.read();
}

// è¾“å‡º : 
// name : tony
</code></pre>
<p>ç”±äºä»–ä¸èƒ½å¤„ç†å¼‚å¸¸ä¿¡æ¯ , ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µ</p>
<pre><code class="language-java">@Test
public void testCompose() throws IOException {

    CompletableFuture.supplyAsync(() -&gt; {
        int i = 1 / 0;
        return &quot;tony&quot;;
    }).thenCompose(s -&gt; {
        System.out.println(&quot;name : &quot; + s);
        return CompletableFuture.supplyAsync(() -&gt; &quot;hello world&quot;);
    });


    System.in.read();
}

// è¾“å‡º :  å°±æ²¡æœ‰è¾“å‡ºç»“æœ .. . ..
</code></pre>
<h3 id="9-å–æ¶ˆ-cancel">9.  å–æ¶ˆ - cancel</h3>
<p><code>public boolean cancel(boolean mayInterruptIfRunning)</code></p>
<blockquote>
<p>â€‹	If not already completed, completes this CompletableFuture with a CancellationException. Dependent CompletableFutures that have not already completed will also complete exceptionally, with a CompletionException caused by this CancellationException.</p>
</blockquote>
<blockquote>
<p>â€‹	å‚æ•° : mayInterruptIfRunning â€“ this value has no effect in this implementation because interrupts are not used to control processing.</p>
<p>â€‹	æ„æ€å°±æ˜¯<code>å–æ¶ˆè¯¥é˜¶æ®µæ‰§è¡Œ</code>, å–æ¶ˆå¤±è´¥è¿”å›å¼‚å¸¸, true ä¸ false å¯¹å–æ¶ˆæ²¡æœ‰å½±å“ ,</p>
</blockquote>
<pre><code class="language-java">@Test
public void testCompose() throws IOException {

    CompletableFuture.runAsync(() -&gt; {
        ThreadUtil.sleep(100);
        System.out.println(&quot;æˆ‘æ‰§è¡Œ1&quot;);
    }).thenRun(() -&gt; {
        System.out.println(&quot;æˆ‘æ‰§è¡Œ2&quot;);
    });

    System.in.read();

}

è¾“å‡º : 
// æˆ‘æ‰§è¡Œ1
</code></pre>
<h3 id="10-é¡ºåºåˆå¹¶">10. é¡ºåºåˆå¹¶</h3>
<h4 id="1-thencombine">1. thenCombine</h4>
<p><code>public &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombine (CompletionStage&lt;? extends U&gt; other,BiFunction&lt;? super T,? super U,? extends V&gt; fn);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when this and the other given stage both complete normally, is executed with the two results as arguments to the supplied function.</p>
<p>â€‹	è¿”å›ä¸€ä¸ªæ–°çš„stage , å½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šçš„é˜¶æ®µéƒ½æ­£å¸¸å®Œæˆæ‰§è¡Œ , å°†ç»“æœæä¾›ç»™fnæ–¹æ³•</p>
</blockquote>
<pre><code class="language-java">@Test
public void testCombine() throws IOException {

    CompletableFuture.supplyAsync(() -&gt; getName())
            .thenCombine(CompletableFuture.completedFuture(&quot;tony&quot;)
                    , new BiFunction&lt;String, String, Object&gt;() {
                        @Override
                        public Object apply(String s, String s2) {
                            System.out.println(&quot;s1  : &quot; + s);
                            System.out.println(&quot;s2 : &quot; + s2);
                            return &quot;å®Œæˆ&quot;;
                        }
                    });

    System.in.read();
}

// è¾“å‡º : 
// s1  : tom
// s2 : hello
</code></pre>
<h4 id="2-thenacceptboth">2. thenAcceptBoth</h4>
<p><code>public &lt;U&gt; CompletionStage&lt;Void&gt; thenAcceptBoth (CompletionStage&lt;? extends U&gt; other,BiConsumer&lt;? super T, ? super U&gt; action);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when this and the other given stage both complete normally, is executed with the two results as arguments to the supplied action.</p>
</blockquote>
<p>è¿™ä¸ªå’Œä¸Šé¢ <code>thenCombine</code> çš„åŒºåˆ«å°±æ˜¯ , ä»–ä¸æä¾›è¿”å›å€¼ ,  æ‰€ä»¥å°±ä¸å†™äº† , éƒ½éœ€è¦ä¸¤ä¸ªä»»åŠ¡åŒæ—¶å®Œæˆ</p>
<h4 id="3-runafterboth">3. runAfterBoth</h4>
<p><code>public CompletionStage&lt;Void&gt; runAfterBoth(CompletionStage&lt;?&gt; other,Runnable action);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when this and the other given stage both complete normally, executes the given action.</p>
</blockquote>
<p>è¿™ä¸ªæ˜¯å‰é¢ä¿©é˜¶æ®µå®Œæˆå ,æ‰§è¡Œè¿™ä¸ªæ–¹æ³• , ä¸æä¾›ä¸¤ä¸ªé˜¶æ®µçš„ç»“æœ , æ‰€ä»¥ä¸å±•ç¤ºäº†</p>
<h4 id="4-applytoeither">4. applyToEither</h4>
<p><code>public &lt;U&gt; CompletionStage&lt;U&gt; applyToEither (CompletionStage&lt;? extends T&gt; other,Function&lt;? super T, U&gt; fn);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when either this or the other given stage complete normally, is executed with the corresponding result as argument to the supplied function.</p>
</blockquote>
<p>ä»–å‘¢å°±æ˜¯ å½“ä¸¤ä¸ªä»»åŠ¡æœ‰ä¸€ä¸ªå®Œæˆçš„æ—¶å€™å°±æ‰§è¡Œè¿™ä¸ª , å°†å®Œæˆé‚£ä¸ªé˜¶æ®µçš„è¿”å›å€¼æä¾›ç»™è¿™ä¸ªæ–¹æ³• fn</p>
<pre><code class="language-java">@Test
public void testEither() throws IOException {
    CompletableFuture.supplyAsync(() -&gt; {
        ThreadUtil.sleep(100);
        System.out.println(&quot;stage 1 æ‰§è¡Œ&quot;);
        return &quot;stage 1&quot;;
    }).applyToEither(CompletableFuture.supplyAsync(() -&gt; {
        ThreadUtil.sleep(200);
        System.out.println(&quot;stage 2 æ‰§è¡Œ&quot;);
        return &quot;stage 2&quot;;
    }), new Function&lt;String, Object&gt;() {
        @Override
        public Object apply(String s) {
            System.out.println(&quot;æ”¶åˆ°æœ€å¿«å®Œæˆçš„ä»»åŠ¡ : &quot; + s);
            return null;
        }
    });

    System.in.read();
}

// è¾“å‡º : 
// stage 1 æ‰§è¡Œ
// æ”¶åˆ°æœ€å¿«å®Œæˆçš„ä»»åŠ¡ : stage 1
// stage 2 æ‰§è¡Œ
</code></pre>
<p>è¯´æ˜å°±ç®—æ˜¯æœ‰ä¸€ä¸ªä»»åŠ¡åæ‰§è¡Œ, ä¹Ÿä¼šæ‰§è¡Œçš„, åªä¸è¿‡è¿™ä¸ªæ–¹æ³•æ˜¯åªè¦æœ‰ä¸€ä¸ªä»»åŠ¡æœ‰è¿”å›å€¼å°±ä¼šæ‰§è¡Œ ...</p>
<h4 id="5-accepteither">5. acceptEither</h4>
<p><code>public CompletionStage&lt;Void&gt; acceptEither (CompletionStage&lt;? extends T&gt; other, Consumer&lt;? super T&gt; action);</code></p>
<blockquote>
<p>â€‹	Returns a new CompletionStage that, when either this or the other given stage complete normally, is executed with the corresponding result as argument to the supplied action.</p>
</blockquote>
<p>å½“æœ‰ä¸€ä¸ªä»»åŠ¡æ­£å¸¸å®Œæˆå°±ä¼šæ‰§è¡Œä»– , ä»–æ˜¯ä¸€ä¸ªæ¶ˆè´¹æ–¹æ³•, æ‰€ä»¥ä¸ä¼šæä¾›è¿”å›å€¼ , ä¸å±•ç¤ºäº†</p>
<h4 id="6-runaftereither">6. runAfterEither</h4>
<p><code>public CompletionStage&lt;Void&gt; runAfterEither(CompletionStage&lt;?&gt; other, Runnable action);</code></p>
<blockquote>
<p>Returns a new CompletionStage that, when either this or the other given stage complete normally, executes the given action.</p>
</blockquote>
<p>è¿™ä¸ªå’Œå‰ä¸¤ä¸ªä¸€æ · , éƒ½æ˜¯æœ‰ä¸€ä¸ªæ­£å¸¸å®Œæˆå°±ä¼šæ‰§è¡Œåé¢çš„æ–¹æ³• , ä¸è¿‡ä»–åªæ˜¯ä¸€ä¸ªrunnable æ–¹æ³•, åªæ˜¯ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡ ,</p>
<p>æ‰€ä»¥ä¸å±•ç¤ºäº† ....</p>
<p>åˆ°è¿™é‡ŒåŸºæœ¬ä¸Š <code>CompletionStage</code> çš„æ–¹æ³•éƒ½è®²å®Œäº† , åŸºæœ¬ä¸Šå¤§å®¶çœ‹JavaDoc å°±å¯ä»¥éšä¾¿å†™äº† , ä»–ä¸»è¦æ˜¯å°±æ˜¯ä¸‰ä¸ªæ–¹æ³•ä¸€ä¸ªæ˜¯ åªæä¾›, ä¸€ä¸ªæ˜¯åˆæ¶ˆè´¹åˆæä¾› ,ä¸€ä¸ªåªæ¶ˆè´¹ ,ä¸€ä¸ªæˆ‘ä¹Ÿä¸æ¶ˆè´¹æˆ‘ä¹Ÿä¸æä¾›, å°±æ˜¯è¿™å‡ ä¸ª.</p>
<h3 id="11-å¹¶è¡Œåˆå¹¶">11. å¹¶è¡Œåˆå¹¶</h3>
<blockquote>
<p>allOfæ–¹æ³•æ˜¯å½“æ‰€æœ‰çš„<code>CompletableFuture</code>éƒ½æ‰§è¡Œå®Œå®Œæ¯•åæ‰æ‰§è¡Œä¸‹ä¸€é˜¶æ®µã€‚</p>
<p>anyOfæ–¹æ³•æ˜¯å½“ä»»æ„ä¸€ä¸ª<code>CompletableFuture</code>æ‰§è¡Œå®Œåæ‰§è¡Œä¸‹ä¸€é˜¶æ®µã€‚</p>
</blockquote>
<h4 id="1-allof">1. allOf</h4>
<p>allOf ä¼šå°†æ·»åŠ çš„é˜¶æ®µå…¨éƒ¨æ‰§è¡Œå®Œæ¯•åæ‰æ‰§è¡Œä¸‹ä¸€é˜¶æ®µçš„ä»»åŠ¡ , å…¶ä¸­æ‰€æœ‰é˜¶æ®µéƒ½æ˜¯<code>å¹¶è¡Œæ‰§è¡Œ</code> ;</p>
<pre><code class="language-java">@Test
public void testAddAll() throws IOException {

    CompletableFuture&lt;Void&gt; fun1 = CompletableFuture.runAsync(() -&gt; {
        ThreadUtil.sleep(100);
        System.out.println(&quot;fun1&quot;);
    });

    CompletableFuture&lt;Void&gt; fun2 = CompletableFuture.runAsync(() -&gt; {
        System.out.println(&quot;fun2&quot;);
    });


    CompletableFuture.allOf(fun1, fun2).thenRun(() -&gt; {
        System.out.println(&quot;æ·»åŠ å®Œæ¯•&quot;);
    });

    System.in.read();
}

// è¾“å‡º : 
// fun2
// fun1
// æ·»åŠ å®Œæ¯•	
</code></pre>
<h4 id="2-anyof">2.  anyOf</h4>
<p>anyOf ä¼šå…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œæ¯•å°±ä¼šæ‰§è¡Œä¸‹ä¸€é˜¶æ®µ,å…¶ä¸­æ·»åŠ çš„ä»»åŠ¡éƒ½æ˜¯<code>å¹¶è¡Œæ‰§è¡Œ</code> ;</p>
<pre><code class="language-java">@Test
public void testAddAll() throws IOException {

    CompletableFuture&lt;Void&gt; fun1 = CompletableFuture.runAsync(() -&gt; {
        ThreadUtil.sleep(100);
        System.out.println(&quot;fun1&quot;);
    });

    CompletableFuture&lt;Void&gt; fun2 = CompletableFuture.runAsync(() -&gt; {
        System.out.println(&quot;fun2&quot;);
    });


    CompletableFuture.anyOf(fun1, fun2).thenRun(() -&gt; {
        System.out.println(&quot;æ·»åŠ å®Œæ¯•&quot;);
    });

    System.in.read();
}

è¾“å‡º :
// fun2
// æ·»åŠ å®Œæ¯•
// fun1
</code></pre>
<h4 id="3æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ">3.æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ</h4>
<pre><code class="language-java">@Test
public void testAddAll() throws IOException {

    long start = System.currentTimeMillis();

    CompletableFuture&lt;Void&gt; fun1 = CompletableFuture.runAsync(() -&gt; {
        ThreadUtil.sleep(100);
        System.out.println(&quot;fun1&quot;);
    });

    CompletableFuture&lt;Void&gt; fun2 = CompletableFuture.runAsync(() -&gt; {
        ThreadUtil.sleep(200);
        System.out.println(&quot;fun2&quot;);
    });

    CompletableFuture.allOf(fun1, fun2).thenRun(() -&gt; {
        System.out.println(&quot;æ·»åŠ å®Œæ¯•&quot;);
        System.out.println(System.currentTimeMillis() - start);
    });

    System.in.read();
}
</code></pre>
<p>å¦‚æœè¾“å‡ºæ—¶é—´å°äº300ms å°±è¡¨ç¤ºæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ , è¾“å‡º</p>
<pre><code class="language-java">fun1
fun2
æ·»åŠ å®Œæ¯•
265  // ç¡®å®æ˜¯å¹¶è¡Œæ‰§è¡Œ ...
</code></pre>
<h2 id="3-æ€»ç»“">3. æ€»ç»“</h2>
<p>å¸Œæœ›æˆ‘ä¸Šé¢çš„æ€»ç»“ä½ å¯ä»¥å¯¹äº <code>CompletionStage</code> è¿™ä¸ªæ€æƒ³æœ‰æ–°çš„è®¤è¯† , è¿™ç§æ€æƒ³å¾ˆé‡è¦, æµå¼ç¼–ç¨‹ , æƒ³å¼‚æ­¥æƒ³åŒæ­¥, å…¨åœ¨è‡ªå·±æŠŠæ¡ä¸­ ,  ç¬¬äºŒèŠ‚ä¸»è¦æ˜¯è®²äº†  <code>CompletionStage</code> ä¸­çš„å…¨éƒ¨æ–¹æ³•, å¦‚æœä¸æƒ³çœ‹æˆ‘å†™çš„, å¯ä»¥çœ‹çœ‹æ–‡æ¡£ä¸­çš„è¡¨è¿° , å…¶å®Javaç¼–ç¨‹ä¸­æä¾›äº† å¾ˆå¤šè¿™ç§çš„ä¾‹å­, å¯ä»¥å­¦ä¹ ä¸€ä¸‹ <code>guava</code> çš„ç¼–ç¨‹,æˆ–è€…åŸºäº <code>scala</code>çš„ç¼–ç¨‹</p>

								<span id="footnote"></span>
								<div id="warn"></div>
							</div>
							<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-completionstage">1. CompletionStage</a></li>
<li><a href="#2-completablefuture">2. CompletableFuture</a>
<ul>
<li><a href="#1-%E7%AE%80%E5%8D%95%E5%BC%80%E5%A7%8B">1. ç®€å•å¼€å§‹</a></li>
<li><a href="#2-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95-%E5%AE%9E%E4%BE%8B%E5%8C%96">2. é™æ€æ–¹æ³•-å®ä¾‹åŒ–</a></li>
<li><a href="#3%E7%AB%8B%E5%8D%B3%E5%AE%8C%E6%88%90-complete-%E5%92%8C-completeexceptionally-%E6%96%B9%E6%B3%95">3.ç«‹å³å®Œæˆ  complete å’Œ completeExceptionally æ–¹æ³•</a></li>
<li><a href="#4-%E6%8A%93%E5%8F%96%E5%BC%82%E5%B8%B8-exceptionally-%E6%96%B9%E6%B3%95">4.  æŠ“å–å¼‚å¸¸ - exceptionally æ–¹æ³•</a></li>
<li><a href="#5-%E5%8A%A0%E5%B7%A5-supplyasync-thenapply-thenaccept-%E6%96%B9%E6%B3%95">5 åŠ å·¥ - supplyAsync &amp; thenApply &amp; thenAccept æ–¹æ³•</a></li>
<li><a href="#6-%E5%8A%A0%E5%B7%A5-whencomplete-%E6%96%B9%E6%B3%95">6. åŠ å·¥-  whenComplete æ–¹æ³•</a></li>
<li><a href="#7-%E5%8A%A0%E5%B7%A5-handle-%E6%96%B9%E6%B3%95">7. åŠ å·¥ - handle æ–¹æ³•</a></li>
<li><a href="#8-%E5%8A%A0%E5%B7%A5-thencompose">8. åŠ å·¥ - thenCompose</a></li>
<li><a href="#9-%E5%8F%96%E6%B6%88-cancel">9.  å–æ¶ˆ - cancel</a></li>
<li><a href="#10-%E9%A1%BA%E5%BA%8F%E5%90%88%E5%B9%B6">10. é¡ºåºåˆå¹¶</a>
<ul>
<li><a href="#1-thencombine">1. thenCombine</a></li>
<li><a href="#2-thenacceptboth">2. thenAcceptBoth</a></li>
<li><a href="#3-runafterboth">3. runAfterBoth</a></li>
<li><a href="#4-applytoeither">4. applyToEither</a></li>
<li><a href="#5-accepteither">5. acceptEither</a></li>
<li><a href="#6-runaftereither">6. runAfterEither</a></li>
</ul>
</li>
<li><a href="#11-%E5%B9%B6%E8%A1%8C%E5%90%88%E5%B9%B6">11. å¹¶è¡Œåˆå¹¶</a>
<ul>
<li><a href="#1-allof">1. allOf</a></li>
<li><a href="#2-anyof">2.  anyOf</a></li>
<li><a href="#3%E6%B5%8B%E8%AF%95%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C">3.æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3-%E6%80%BB%E7%BB%93">3. æ€»ç»“</a></li>
</ul>
</li>
</ul>
</div>
						</div>
						<div id="fullPage"><canvas id="canvas"></canvas></div>
				</article>
				<div id="eof"><span>EOF</span></div>
				<div class="round-shape-one"></div>
				<section>
					<div class="doc_comments">
							<div id="valine-container"></div>
					</div>
				</section>
			</div>
		</div>
	</div>
	<script>
		"use strict";
		! function () {
			for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
				n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
				for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
					n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
				}
			}
		}();
		let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
		window.addEventListener("scroll", event => {
			let fromTop = window.scrollY;
			mainNavLinks.forEach((link, index) => {
				let section = document.getElementById(decodeURI(link.hash).substring(1));
				let nextSection = null
				if (mainNavLinks[index + 1]) {
					nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
						1));
				}
				if (section.offsetTop <= fromTop) {
					if (nextSection) {
						if (nextSection.offsetTop > fromTop) {
							link.classList.add("currentToc");
						} else {
							link.classList.remove("currentToc");
						}
					} else {
						link.classList.add("currentToc");
					}
				} else {
					link.classList.remove("currentToc");
				}
			});
		});
		var list = document.querySelectorAll(".katex");
		for (var i = 0; i < list.length; i++) {
			list[i].style.display = "unset"
		};
		var h = document.documentElement,
			b = document.body,
			st = "scrollTop",
			sh = "scrollHeight",
			progress = document.querySelector(".progress"),
			scroll;
		document.addEventListener("scroll", function () {
			scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
			progress.style.setProperty("--scroll", scroll + "%")
		});
		var wxScale = new WxScale({
			fullPage: document.querySelector("#fullPage"),
			canvas: document.querySelector("#canvas")
		});
		var imgBox = document.querySelectorAll("#md_block img");
		for (var i = 0; i < imgBox.length; i++) {
			imgBox[i].onclick = function (e) {
				wxScale.start(this)
			}
		};
	</script>
	<style>
		#magnifyImg {
			position: fixed;
			left: 0;
			top: 0;
			text-align: center;
			width: 100%;
			display: none;
			z-index: 9999
		}

		#magnifyImg img {
			object-fit: contain;
			background: #eaecef;
			padding: 15px;
			border-radius: 10px;
			height: auto;
			width: auto;
			vertical-align: middle
		}
	</style>
	<a id="scrollUp"href="#top"style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Anthony-Dong"title="github"><i class="iconfont icon-github"></i></a><a href="fanhaodong516@gmail.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">You Are My Everything. <a href="mailto:574986060@qq.com" target="blank">Send Email</a>CopyrightÂ©2018-2020<a href="https://anthony-dong.github.io"style="margin:0;">Serence</a>.</div><span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="count-page">168271</span></strong></span><span id="busuanzi_container_page_pv"style="display: inline;"><span>ğŸ“š<strong>186</strong>posts</span></div></div><script>console.log("\n %c \u26a1Anthony-Dong's Blog:https://anthony-dong.gitee.io ,Github:https://github.com/Anthony-Dong ,Email:574986060@qq.com ,æœ‰äº‹æƒ…æ¬¢è¿è”ç³». \n\n","color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;",);</script>
	<script type="text/javascript" async src="https://anthony-dong.github.io/media/js/prism.js"></script>
</body>
</html>